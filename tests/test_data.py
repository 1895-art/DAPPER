"""Test data loading and presenting functionality."""
##
from dapper import *

import inspect
import io
from contextlib import redirect_stdout
import functools

##
if "--replace" in sys.argv:
    replacements = []

    import dataclasses as dc
    @dc.dataclass
    class Replacement:
        lines  : list
        nOpen  : int
        nClose : int

    with open(__file__,"r") as F:
        orig_code = [ln for ln in F]

    def backtrack_until_finding(substr,lineno):
        while True:
            lineno -= 1
            if substr in orig_code[lineno]:
                return lineno


# Test functions will be registering here.
test_register = locals()
test_ind = 0

@functools.wraps(xpSpace.print)
def _print_1d(xp_dict,*args,**kwargs):
    """Test xpSpace.print().

    sys.argv options:
        --replace : update this file (i.e. its data) 
        --print   : turn _print_1d into xpSpace.print().

    Features:
    - Enables re-use of ``old`` variable name (by capturing its value).
    - Parameterization -- pytest.mark.parametrize not used.
                          Avoids having to decorate an explicit function
                          (and thus enables naming functions through test_ind).
    - Capturing stdout -- The func xpSpace.print() is only called once for each ``old``
                          (unlike a pytest fixture with capsys),
                          and thus it's fast.
    - splitlines() included.

    Obsolete?:
        the strip() functionality is used to remove bothersome trailing whitespaces
        (usually not printed by terminal, and so not copied when doing it manually)
    """

    if "--print" in sys.argv:
        xp_dict.print(*args,**kwargs)
        return

    # Call xpSpace.print(). Capture stdout.
    F = io.StringIO()
    with redirect_stdout(F):
        xp_dict.print(*args,**kwargs)
    printed_lines = F.getvalue().splitlines(True)

    if "--replace" in sys.argv:
        caller_lineno = inspect.currentframe().f_back.f_lineno
        nClose = backtrack_until_finding('"""\n', caller_lineno)
        nOpen  = backtrack_until_finding('"""', nClose)
        replacements.append(Replacement(printed_lines,nOpen,nClose))

    else: # Generate & register tests
        global test_ind
        test_ind += 1

        # Capture ``old``
        _old = old.splitlines(True) # keepends

        # Loop over rows
        for lineno, (old_bound,new_bound) in enumerate(zip(_old,printed_lines)):

            # Define test function.
            def compare(old_line=old_bound,new_line=new_bound):
                assert old_line == new_line
                # assert old_line.strip() == new_line.strip()

            # Register test
            test_register[f'test_{test_ind}_line_{lineno}'] = compare


##
__file__ = "tests/test_data.py"
savepath = save_dir(__file__)
xps = load_xps(savepath)
xps = xpSpace.from_list(xps)

xps_shorter = xpSpace.from_list([xp for xp in xps.values()
    if getattr(xp,'da_method')!='LETKF'])

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 3.624 Â±0.006 0 3

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 0.941 Â±0.001 0 3

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed',).[0m
      |  ______N=10______  _______12_______  _______14_______
infl  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“
----  -  ----------------  ----------------  ----------------
1     |    4.55 Â±0.09 0 3   4.33  Â±0.07 0 3    4.19 Â±0.08 0 3
1.01  |    4.4  Â±0.04 0 3   4.24  Â±0.1  0 3    3.96 Â±0.1  0 3
1.02  |    4.36 Â±0.06 0 3   4.08  Â±0.2  0 3    3.76 Â±0.1  0 3
1.04  |    4.16 Â±0.1  0 3   3.88  Â±0.07 0 3    2.88 Â±0.3  0 3
1.07  |    3.92 Â±0.2  0 3   3.6   Â±0.2  0 3    2.7  Â±0.3  0 3
1.1   |    3.84 Â±0.1  0 3   3.462 Â±0.03 0 3    2.28 Â±0.3  0 3
1.2   |    3.58 Â±0.1  0 3   2.92  Â±0.05 0 3    1.28 Â±0.2  0 3
1.4   |    3.43 Â±0.06 0 3   2.52  Â±0.1  0 3    0.92 Â±0.2  0 3

[4mâ€¢Table for da_method='LETKF'. â€¢Averages Î£ over ('seed',).[0m
               |  _______N=10______  ________12_______  ________14_______
infl  loc_rad  |  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
----  -------  -  -----------------  -----------------  -----------------
1         0.1  |  3.758  Â±0.01  0 3  3.756  Â±0.01  0 3  3.755  Â±0.009 0 3
1         0.4  |  0.51   Â±0.03  0 3  0.53   Â±0.07  0 3  0.53   Â±0.08  0 3
1         2    |  1.3    Â±0.6   0 3  0.8    Â±0.5   0 3  0.9    Â±0.3   0 3
1.01      0.1  |  3.818  Â±0.01  0 3  3.806  Â±0.01  0 3  3.8    Â±0.01  0 3
1.01      0.4  |  0.41   Â±0.01  0 3  0.408  Â±0.02  0 3  0.396  Â±0.01  0 3
1.01      2    |  0.26   Â±0.007 0 3  0.251  Â±0.008 0 3  0.25   Â±0.009 0 3
1.02      0.1  |  3.892  Â±0.01  0 3  3.868  Â±0.01  0 3  3.86   Â±0.01  0 3
1.02      0.4  |  0.3752 Â±0.004 0 3  0.375  Â±0.005 0 3  0.3696 Â±0.004 0 3
1.02      2    |  0.245  Â±0.007 0 3  0.242  Â±0.006 0 3  0.24   Â±0.004 0 3
1.04      0.1  |  4.118  Â±0.01  0 3  4.08   Â±0.006 0 3  4.064  Â±0.02  0 3
1.04      0.4  |  0.3616 Â±0.004 0 3  0.36   Â±0.003 0 3  0.3594 Â±0.003 0 3
1.04      2    |  0.2454 Â±0.003 0 3  0.2454 Â±0.003 0 3  0.2448 Â±0.003 0 3
1.07      0.1  |  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
1.07      0.4  |  0.3726 Â±0.003 0 3  0.3732 Â±0.003 0 3  0.3702 Â±0.003 0 3
1.07      2    |  0.2664 Â±0.002 0 3  0.2664 Â±0.002 0 3  0.2664 Â±0.002 0 3
1.1       0.1  |  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
1.1       0.4  |  0.3932 Â±0.002 0 3  0.393  Â±0.003 0 3  0.3924 Â±0.002 0 3
1.1       2    |  0.2904 Â±0.001 0 3  0.2916 Â±0.001 0 3  0.2928 Â±0.002 0 3
1.2       0.1  |  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
1.2       0.4  |  0.468  Â±0.002 0 3  0.4692 Â±0.002 0 3  0.4694 Â±0.001 0 3
1.2       2    |  0.3716 Â±0.002 0 3  0.3744 Â±0.001 0 3  0.3762 Â±0.001 0 3
1.4       0.1  |  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
1.4       0.4  |  0.5872 Â±0.001 0 3  0.5884 Â±0.002 0 3  0.5892 Â±0.001 0 3
1.4       2    |  0.4978 Â±0.001 0 3  0.5022 Â±0.001 0 3  0.5052 Â±0.001 0 3
"""
_print_1d(xps, "rmse.a", dict(outer="da_method",inner="N",mean="seed",))

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    *('infl',)
------------------------
 3.624 Â±0.006 *(None,)  

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    *('infl',)
------------------------
 0.941 Â±0.001 *(None,)  

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed',).[0m
__________N=10_________  __________12__________  __________14__________
rmse.a Â±1Ïƒ   *('infl',)  rmse.a Â±1Ïƒ  *('infl',)  rmse.a Â±1Ïƒ  *('infl',)
-----------------------  ----------------------  ----------------------
  3.43 Â±0.06 *(1.4,)       2.52 Â±0.1 *(1.4,)       0.92 Â±0.2 *(1.4,)   

[4mâ€¢Table for da_method='LETKF'. â€¢Averages Î£ over ('seed',).[0m
         |  __________N=10__________  ___________12___________  ___________14___________
loc_rad  |  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)  rmse.a Â±1Ïƒ    *('infl',)
-------  -  ------------------------  ------------------------  ------------------------
    0.1  |  3.758  Â±0.01  *(1.0,)      3.756 Â±0.01  *(1.0,)     3.755  Â±0.009 *(1.0,)   
    0.4  |  0.3616 Â±0.004 *(1.04,)     0.36  Â±0.003 *(1.04,)    0.3594 Â±0.003 *(1.04,)  
    2    |  0.245  Â±0.007 *(1.02,)     0.242 Â±0.006 *(1.02,)    0.24   Â±0.004 *(1.02,)  
"""
_print_1d(xps, "rmse.a", dict(outer="da_method",inner="N",mean="seed",optim="infl"))

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed',).[0m
kurt.f Â±1Ïƒ  â˜  âœ“
---------------
nan    Â±nan 3 0

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed',).[0m
kurt.f Â±1Ïƒ  â˜  âœ“
---------------
nan    Â±nan 3 0

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed',).[0m
      |  ________N=10_______  _________12________  _________14________
infl  |   kurt.f Â±1Ïƒ     â˜  âœ“   kurt.f Â±1Ïƒ     â˜  âœ“   kurt.f Â±1Ïƒ     â˜  âœ“
----  -  -------------------  -------------------  -------------------
1     |  -1.0138 Â±0.001  0 3  -0.8604 Â±0.003  0 3  -0.7544 Â±0.002  0 3
1.01  |  -1.01   Â±0.0007 0 3  -0.8658 Â±0.001  0 3  -0.76   Â±0.0006 0 3
1.02  |  -1.0128 Â±0.002  0 3  -0.862  Â±0.002  0 3  -0.758  Â±0.002  0 3
1.04  |  -1.0122 Â±0.001  0 3  -0.8669 Â±0.0008 0 3  -0.758  Â±0.001  0 3
1.07  |  -1.01   Â±0.002  0 3  -0.8658 Â±0.001  0 3  -0.7576 Â±0.002  0 3
1.1   |  -1.013  Â±0.0008 0 3  -0.8646 Â±0.003  0 3  -0.7576 Â±0.002  0 3
1.2   |  -1.008  Â±0.003  0 3  -0.8704 Â±0.004  0 3  -0.7576 Â±0.004  0 3
1.4   |  -1.0104 Â±0.004  0 3  -0.8628 Â±0.003  0 3  -0.753  Â±0.001  0 3

[4mâ€¢Table for da_method='LETKF'. â€¢Averages Î£ over ('seed',).[0m
               |  ________N=10________  _________12_________  _________14_________
infl  loc_rad  |    kurt.f Â±1Ïƒ     â˜  âœ“    kurt.f Â±1Ïƒ     â˜  âœ“    kurt.f Â±1Ïƒ     â˜  âœ“
----  -------  -  --------------------  --------------------  --------------------
1         0.1  |  -1.0162  Â±0.001  0 3  -0.874   Â±0.0007 0 3  -0.7679  Â±0.0009 0 3
1         0.4  |  -1.008   Â±0.001  0 3  -0.86    Â±0.006  0 3  -0.75    Â±0.003  0 3
1         2    |  -1.0128  Â±0.002  0 3  -0.8664  Â±0.003  0 3  -0.7552  Â±0.004  0 3
1.01      0.1  |  -1.0158  Â±0.001  0 3  -0.8684  Â±0.001  0 3  -0.76266 Â±0.0003 0 3
1.01      0.4  |  -1.0094  Â±0.001  0 3  -0.8584  Â±0.002  0 3  -0.7555  Â±0.0006 0 3
1.01      2    |  -1.011   Â±0.003  0 3  -0.8632  Â±0.004  0 3  -0.7608  Â±0.003  0 3
1.02      0.1  |  -1.0108  Â±0.002  0 3  -0.8676  Â±0.0003 0 3  -0.762   Â±0.003  0 3
1.02      0.4  |  -1.0104  Â±0.0005 0 3  -0.866   Â±0.0004 0 3  -0.7542  Â±0.003  0 3
1.02      2    |  -1.011   Â±0.003  0 3  -0.864   Â±0.003  0 3  -0.758   Â±0.002  0 3
1.04      0.1  |  -1.012   Â±0.001  0 3  -0.86472 Â±0.0004 0 3  -0.7564  Â±0.0002 0 3
1.04      0.4  |  -1.0084  Â±0.002  0 3  -0.8592  Â±0.003  0 3  -0.7518  Â±0.003  0 3
1.04      2    |  -1.0086  Â±0.001  0 3  -0.864   Â±0.003  0 3  -0.7604  Â±0.002  0 3
1.07      0.1  |  nan      Â±nan    3 0  nan      Â±nan    3 0  nan      Â±nan    3 0
1.07      0.4  |  -1.0084  Â±0.002  0 3  -0.8636  Â±0.002  0 3  -0.7532  Â±0.002  0 3
1.07      2    |  -1.0083  Â±0.0007 0 3  -0.8699  Â±0.0009 0 3  -0.7588  Â±0.001  0 3
1.1       0.1  |  nan      Â±nan    3 0  nan      Â±nan    3 0  nan      Â±nan    3 0
1.1       0.4  |  -1.0098  Â±0.003  0 3  -0.8632  Â±0.001  0 3  -0.7548  Â±0.003  0 3
1.1       2    |  -1.0105  Â±0.0006 0 3  -0.8652  Â±0.001  0 3  -0.7576  Â±0.002  0 3
1.2       0.1  |  nan      Â±nan    3 0  nan      Â±nan    3 0  nan      Â±nan    3 0
1.2       0.4  |  -1.008   Â±0.001  0 3  -0.8632  Â±0.0006 0 3  -0.7536  Â±0.001  0 3
1.2       2    |  -1.0109  Â±0.0009 0 3  -0.8667  Â±0.0007 0 3  -0.75864 Â±0.0004 0 3
1.4       0.1  |  nan      Â±nan    3 0  nan      Â±nan    3 0  nan      Â±nan    3 0
1.4       0.4  |  -1.00992 Â±0.0004 0 3  -0.8632  Â±0.002  0 3  -0.7566  Â±0.003  0 3
1.4       2    |  -1.011   Â±0.001  0 3  -0.868   Â±0.002  0 3  -0.7596  Â±0.001  0 3
"""
_print_1d(xps, "kurt.f", dict(outer="da_method",inner="N",mean="seed",))

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 3.624 Â±0.006 0 3

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 0.941 Â±0.001 0 3

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed',).[0m
    |  ____infl=1.0____  ______1.01______  ______1.02______  ______1.04______  ______1.07_____  ______1.1_______  ______1.2_______  ______1.4_______
 N  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ  â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ   â˜  âœ“
--  -  ----------------  ----------------  ----------------  ----------------  ---------------  ----------------  ----------------  ----------------
10  |    4.55 Â±0.09 0 3    4.4  Â±0.04 0 3    4.36 Â±0.06 0 3    4.16 Â±0.1  0 3    3.92 Â±0.2 0 3   3.84  Â±0.1  0 3    3.58 Â±0.1  0 3    3.43 Â±0.06 0 3
12  |    4.33 Â±0.07 0 3    4.24 Â±0.1  0 3    4.08 Â±0.2  0 3    3.88 Â±0.07 0 3    3.6  Â±0.2 0 3   3.462 Â±0.03 0 3    2.92 Â±0.05 0 3    2.52 Â±0.1  0 3
14  |    4.19 Â±0.08 0 3    3.96 Â±0.1  0 3    3.76 Â±0.1  0 3    2.88 Â±0.3  0 3    2.7  Â±0.3 0 3   2.28  Â±0.3  0 3    1.28 Â±0.2  0 3    0.92 Â±0.2  0 3

[4mâ€¢Table for da_method='LETKF'. â€¢Averages Î£ over ('seed',).[0m
             |  _____infl=1.0____  _______1.01______  _______1.02______  _______1.04______  _______1.07______  _______1.1_______  _______1.2_______  _______1.4_______
 N  loc_rad  |  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
--  -------  -  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------
10      0.1  |   3.758 Â±0.01  0 3   3.818 Â±0.01  0 3  3.892  Â±0.01  0 3  4.118  Â±0.01  0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
10      0.4  |   0.51  Â±0.03  0 3   0.41  Â±0.01  0 3  0.3752 Â±0.004 0 3  0.3616 Â±0.004 0 3  0.3726 Â±0.003 0 3  0.3932 Â±0.002 0 3  0.468  Â±0.002 0 3  0.5872 Â±0.001 0 3
10      2    |   1.3   Â±0.6   0 3   0.26  Â±0.007 0 3  0.245  Â±0.007 0 3  0.2454 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2904 Â±0.001 0 3  0.3716 Â±0.002 0 3  0.4978 Â±0.001 0 3
12      0.1  |   3.756 Â±0.01  0 3   3.806 Â±0.01  0 3  3.868  Â±0.01  0 3  4.08   Â±0.006 0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
12      0.4  |   0.53  Â±0.07  0 3   0.408 Â±0.02  0 3  0.375  Â±0.005 0 3  0.36   Â±0.003 0 3  0.3732 Â±0.003 0 3  0.393  Â±0.003 0 3  0.4692 Â±0.002 0 3  0.5884 Â±0.002 0 3
12      2    |   0.8   Â±0.5   0 3   0.251 Â±0.008 0 3  0.242  Â±0.006 0 3  0.2454 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2916 Â±0.001 0 3  0.3744 Â±0.001 0 3  0.5022 Â±0.001 0 3
14      0.1  |   3.755 Â±0.009 0 3   3.8   Â±0.01  0 3  3.86   Â±0.01  0 3  4.064  Â±0.02  0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
14      0.4  |   0.53  Â±0.08  0 3   0.396 Â±0.01  0 3  0.3696 Â±0.004 0 3  0.3594 Â±0.003 0 3  0.3702 Â±0.003 0 3  0.3924 Â±0.002 0 3  0.4694 Â±0.001 0 3  0.5892 Â±0.001 0 3
14      2    |   0.9   Â±0.3   0 3   0.25  Â±0.009 0 3  0.24   Â±0.004 0 3  0.2448 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2928 Â±0.002 0 3  0.3762 Â±0.001 0 3  0.5052 Â±0.001 0 3
"""
_print_1d(xps, "rmse.a", dict(outer="da_method",inner="infl",mean="seed",))

##
old = """
[4mâ€¢Table for N=None. â€¢Averages Î£ over ('seed',).[0m
da_method    |  rmse.a Â±1Ïƒ    â˜  âœ“
-----------  -  -----------------
Climatology  |   3.624 Â±0.006 0 3
OptInterp    |   0.941 Â±0.001 0 3

[4mâ€¢Table for N=10. â€¢Averages Î£ over ('seed',).[0m
                    |  ____infl=1.0____  _______1.01______  _______1.02______  _______1.04______  _______1.07______  _______1.1_______  _______1.2_______  _______1.4_______
da_method  loc_rad  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  -------  -  ----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------
EnKF                |   4.55  Â±0.09 0 3   4.4   Â±0.04  0 3  4.36   Â±0.06  0 3  4.16   Â±0.1   0 3  3.92   Â±0.2   0 3  3.84   Â±0.1   0 3  3.58   Â±0.1   0 3  3.43   Â±0.06  0 3
LETKF          0.1  |   3.758 Â±0.01 0 3   3.818 Â±0.01  0 3  3.892  Â±0.01  0 3  4.118  Â±0.01  0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
LETKF          0.4  |   0.51  Â±0.03 0 3   0.41  Â±0.01  0 3  0.3752 Â±0.004 0 3  0.3616 Â±0.004 0 3  0.3726 Â±0.003 0 3  0.3932 Â±0.002 0 3  0.468  Â±0.002 0 3  0.5872 Â±0.001 0 3
LETKF          2    |   1.3   Â±0.6  0 3   0.26  Â±0.007 0 3  0.245  Â±0.007 0 3  0.2454 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2904 Â±0.001 0 3  0.3716 Â±0.002 0 3  0.4978 Â±0.001 0 3

[4mâ€¢Table for N=12. â€¢Averages Î£ over ('seed',).[0m
                    |  ____infl=1.0____  _______1.01______  _______1.02______  _______1.04______  _______1.07______  _______1.1_______  _______1.2_______  _______1.4_______
da_method  loc_rad  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  -------  -  ----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------
EnKF                |   4.33  Â±0.07 0 3   4.24  Â±0.1   0 3   4.08  Â±0.2   0 3  3.88   Â±0.07  0 3  3.6    Â±0.2   0 3  3.462  Â±0.03  0 3  2.92   Â±0.05  0 3  2.52   Â±0.1   0 3
LETKF          0.1  |   3.756 Â±0.01 0 3   3.806 Â±0.01  0 3   3.868 Â±0.01  0 3  4.08   Â±0.006 0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
LETKF          0.4  |   0.53  Â±0.07 0 3   0.408 Â±0.02  0 3   0.375 Â±0.005 0 3  0.36   Â±0.003 0 3  0.3732 Â±0.003 0 3  0.393  Â±0.003 0 3  0.4692 Â±0.002 0 3  0.5884 Â±0.002 0 3
LETKF          2    |   0.8   Â±0.5  0 3   0.251 Â±0.008 0 3   0.242 Â±0.006 0 3  0.2454 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2916 Â±0.001 0 3  0.3744 Â±0.001 0 3  0.5022 Â±0.001 0 3

[4mâ€¢Table for N=14. â€¢Averages Î£ over ('seed',).[0m
                    |  _____infl=1.0____  _______1.01______  _______1.02______  _______1.04______  _______1.07______  _______1.1_______  _______1.2_______  _______1.4_______
da_method  loc_rad  |  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
---------  -------  -  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------  -----------------
EnKF                |   4.19  Â±0.08  0 3   3.96  Â±0.1   0 3  3.76   Â±0.1   0 3  2.88   Â±0.3   0 3  2.7    Â±0.3   0 3  2.28   Â±0.3   0 3  1.28   Â±0.2   0 3  0.92   Â±0.2   0 3
LETKF          0.1  |   3.755 Â±0.009 0 3   3.8   Â±0.01  0 3  3.86   Â±0.01  0 3  4.064  Â±0.02  0 3  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0  nan    Â±nan   3 0
LETKF          0.4  |   0.53  Â±0.08  0 3   0.396 Â±0.01  0 3  0.3696 Â±0.004 0 3  0.3594 Â±0.003 0 3  0.3702 Â±0.003 0 3  0.3924 Â±0.002 0 3  0.4694 Â±0.001 0 3  0.5892 Â±0.001 0 3
LETKF          2    |   0.9   Â±0.3   0 3   0.25  Â±0.009 0 3  0.24   Â±0.004 0 3  0.2448 Â±0.003 0 3  0.2664 Â±0.002 0 3  0.2928 Â±0.002 0 3  0.3762 Â±0.001 0 3  0.5052 Â±0.001 0 3
"""
_print_1d(xps, "rmse.a", dict(outer="N",inner="infl",mean="seed",))

##
old = """
[4mâ€¢Table for N=None. â€¢Averages Î£ over ('seed',).[0m
da_method='Climatology'  ____OptInterp____
rmse.a Â±1Ïƒ    â˜  âœ“        rmse.a Â±1Ïƒ    â˜  âœ“
-----------------------  -----------------
 3.624 Â±0.006 0 3         0.941 Â±0.001 0 3

[4mâ€¢Table for N=10. â€¢Averages Î£ over ('seed',).[0m
               |  da_method='EnKF'  ______LETKF______
infl  loc_rad  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
----  -------  -  ----------------  -----------------
1              |  4.55   Â±0.09 0 3         Â±         
1         0.1  |         Â±          3.758  Â±0.01  0 3
1         0.4  |         Â±          0.51   Â±0.03  0 3
1         2    |         Â±          1.3    Â±0.6   0 3
1.01           |  4.4    Â±0.04 0 3         Â±         
1.01      0.1  |         Â±          3.818  Â±0.01  0 3
1.01      0.4  |         Â±          0.41   Â±0.01  0 3
1.01      2    |         Â±          0.26   Â±0.007 0 3
1.02           |  4.36   Â±0.06 0 3         Â±         
1.02      0.1  |         Â±          3.892  Â±0.01  0 3
1.02      0.4  |         Â±          0.3752 Â±0.004 0 3
1.02      2    |         Â±          0.245  Â±0.007 0 3
1.04           |  4.16   Â±0.1  0 3         Â±         
1.04      0.1  |         Â±          4.118  Â±0.01  0 3
1.04      0.4  |         Â±          0.3616 Â±0.004 0 3
1.04      2    |         Â±          0.2454 Â±0.003 0 3
1.07           |  3.92   Â±0.2  0 3         Â±         
1.07      0.1  |         Â±          nan    Â±nan   3 0
1.07      0.4  |         Â±          0.3726 Â±0.003 0 3
1.07      2    |         Â±          0.2664 Â±0.002 0 3
1.1            |  3.84   Â±0.1  0 3         Â±         
1.1       0.1  |         Â±          nan    Â±nan   3 0
1.1       0.4  |         Â±          0.3932 Â±0.002 0 3
1.1       2    |         Â±          0.2904 Â±0.001 0 3
1.2            |  3.58   Â±0.1  0 3         Â±         
1.2       0.1  |         Â±          nan    Â±nan   3 0
1.2       0.4  |         Â±          0.468  Â±0.002 0 3
1.2       2    |         Â±          0.3716 Â±0.002 0 3
1.4            |  3.43   Â±0.06 0 3         Â±         
1.4       0.1  |         Â±          nan    Â±nan   3 0
1.4       0.4  |         Â±          0.5872 Â±0.001 0 3
1.4       2    |         Â±          0.4978 Â±0.001 0 3

[4mâ€¢Table for N=12. â€¢Averages Î£ over ('seed',).[0m
               |  da_method='EnKF'  ______LETKF______
infl  loc_rad  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
----  -------  -  ----------------  -----------------
1              |  4.33   Â±0.07 0 3         Â±         
1         0.1  |         Â±          3.756  Â±0.01  0 3
1         0.4  |         Â±          0.53   Â±0.07  0 3
1         2    |         Â±          0.8    Â±0.5   0 3
1.01           |  4.24   Â±0.1  0 3         Â±         
1.01      0.1  |         Â±          3.806  Â±0.01  0 3
1.01      0.4  |         Â±          0.408  Â±0.02  0 3
1.01      2    |         Â±          0.251  Â±0.008 0 3
1.02           |  4.08   Â±0.2  0 3         Â±         
1.02      0.1  |         Â±          3.868  Â±0.01  0 3
1.02      0.4  |         Â±          0.375  Â±0.005 0 3
1.02      2    |         Â±          0.242  Â±0.006 0 3
1.04           |  3.88   Â±0.07 0 3         Â±         
1.04      0.1  |         Â±          4.08   Â±0.006 0 3
1.04      0.4  |         Â±          0.36   Â±0.003 0 3
1.04      2    |         Â±          0.2454 Â±0.003 0 3
1.07           |  3.6    Â±0.2  0 3         Â±         
1.07      0.1  |         Â±          nan    Â±nan   3 0
1.07      0.4  |         Â±          0.3732 Â±0.003 0 3
1.07      2    |         Â±          0.2664 Â±0.002 0 3
1.1            |  3.462  Â±0.03 0 3         Â±         
1.1       0.1  |         Â±          nan    Â±nan   3 0
1.1       0.4  |         Â±          0.393  Â±0.003 0 3
1.1       2    |         Â±          0.2916 Â±0.001 0 3
1.2            |  2.92   Â±0.05 0 3         Â±         
1.2       0.1  |         Â±          nan    Â±nan   3 0
1.2       0.4  |         Â±          0.4692 Â±0.002 0 3
1.2       2    |         Â±          0.3744 Â±0.001 0 3
1.4            |  2.52   Â±0.1  0 3         Â±         
1.4       0.1  |         Â±          nan    Â±nan   3 0
1.4       0.4  |         Â±          0.5884 Â±0.002 0 3
1.4       2    |         Â±          0.5022 Â±0.001 0 3

[4mâ€¢Table for N=14. â€¢Averages Î£ over ('seed',).[0m
               |  da_method='EnKF'  ______LETKF______
infl  loc_rad  |  rmse.a Â±1Ïƒ   â˜  âœ“  rmse.a Â±1Ïƒ    â˜  âœ“
----  -------  -  ----------------  -----------------
1              |  4.19   Â±0.08 0 3         Â±         
1         0.1  |         Â±          3.755  Â±0.009 0 3
1         0.4  |         Â±          0.53   Â±0.08  0 3
1         2    |         Â±          0.9    Â±0.3   0 3
1.01           |  3.96   Â±0.1  0 3         Â±         
1.01      0.1  |         Â±          3.8    Â±0.01  0 3
1.01      0.4  |         Â±          0.396  Â±0.01  0 3
1.01      2    |         Â±          0.25   Â±0.009 0 3
1.02           |  3.76   Â±0.1  0 3         Â±         
1.02      0.1  |         Â±          3.86   Â±0.01  0 3
1.02      0.4  |         Â±          0.3696 Â±0.004 0 3
1.02      2    |         Â±          0.24   Â±0.004 0 3
1.04           |  2.88   Â±0.3  0 3         Â±         
1.04      0.1  |         Â±          4.064  Â±0.02  0 3
1.04      0.4  |         Â±          0.3594 Â±0.003 0 3
1.04      2    |         Â±          0.2448 Â±0.003 0 3
1.07           |  2.7    Â±0.3  0 3         Â±         
1.07      0.1  |         Â±          nan    Â±nan   3 0
1.07      0.4  |         Â±          0.3702 Â±0.003 0 3
1.07      2    |         Â±          0.2664 Â±0.002 0 3
1.1            |  2.28   Â±0.3  0 3         Â±         
1.1       0.1  |         Â±          nan    Â±nan   3 0
1.1       0.4  |         Â±          0.3924 Â±0.002 0 3
1.1       2    |         Â±          0.2928 Â±0.002 0 3
1.2            |  1.28   Â±0.2  0 3         Â±         
1.2       0.1  |         Â±          nan    Â±nan   3 0
1.2       0.4  |         Â±          0.4694 Â±0.001 0 3
1.2       2    |         Â±          0.3762 Â±0.001 0 3
1.4            |  0.92   Â±0.2  0 3         Â±         
1.4       0.1  |         Â±          nan    Â±nan   3 0
1.4       0.4  |         Â±          0.5892 Â±0.001 0 3
1.4       2    |         Â±          0.5052 Â±0.001 0 3
"""
_print_1d(xps, "rmse.a", dict(outer="N",inner="da_method",mean="seed",))

##
old = """
[4mâ€¢Table for N=None.[0m
             |  ____seed=2___  ______3______  ______4______
da_method    |  rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ
-----------  -  -------------  -------------  -------------
Climatology  |   3.632 Â±0.02    3.612 Â±0.02   3.628  Â±0.02 
OptInterp    |   0.944 Â±0.004   0.939 Â±0.003  0.9396 Â±0.003

[4mâ€¢Table for N=10.[0m
                          |  ____seed=2___  ______3______  ______4______
da_method  infl  loc_rad  |  rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ
---------  ----  -------  -  -------------  -------------  -------------
EnKF       1              |  4.54   Â±0.09   4.4    Â±0.1    4.72   Â±0.07 
LETKF      1         0.1  |  3.776  Â±0.02   3.74   Â±0.02   3.76   Â±0.02 
LETKF      1         0.4  |  0.54   Â±0.08   0.52   Â±0.05   0.456  Â±0.03 
LETKF      1         2    |  2.22   Â±0.3    1.32   Â±0.3    0.312  Â±0.02 
EnKF       1.01           |  4.48   Â±0.08   4.34   Â±0.1    4.37   Â±0.08 
LETKF      1.01      0.1  |  3.84   Â±0.02   3.804  Â±0.02   3.808  Â±0.02 
LETKF      1.01      0.4  |  0.416  Â±0.01   0.432  Â±0.04   0.386  Â±0.01 
LETKF      1.01      2    |  0.275  Â±0.009  0.251  Â±0.008  0.254  Â±0.005
EnKF       1.02           |  4.35   Â±0.08   4.26   Â±0.1    4.45   Â±0.07 
LETKF      1.02      0.1  |  3.9    Â±0.02   3.872  Â±0.02   3.906  Â±0.03 
LETKF      1.02      0.4  |  0.382  Â±0.008  0.373  Â±0.008  0.37   Â±0.007
LETKF      1.02      2    |  0.257  Â±0.005  0.2336 Â±0.004  0.244  Â±0.004
EnKF       1.04           |  4.4    Â±0.07   3.92   Â±0.2    4.16   Â±0.09 
LETKF      1.04      0.1  |  4.136  Â±0.02   4.088  Â±0.02   4.128  Â±0.02 
LETKF      1.04      0.4  |  0.37   Â±0.006  0.355  Â±0.005  0.361  Â±0.005
LETKF      1.04      2    |  0.2508 Â±0.003  0.2406 Â±0.003  0.2436 Â±0.003
EnKF       1.07           |  4.0    Â±0.1    3.64   Â±0.2    4.16   Â±0.09 
LETKF      1.07      0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.07      0.4  |  0.3776 Â±0.004  0.3672 Â±0.003  0.3744 Â±0.003
LETKF      1.07      2    |  0.2694 Â±0.003  0.2624 Â±0.002  0.2664 Â±0.003
EnKF       1.1            |  3.9    Â±0.1    3.64   Â±0.2    4.01   Â±0.09 
LETKF      1.1       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.1       0.4  |  0.3944 Â±0.004  0.3882 Â±0.003  0.3966 Â±0.003
LETKF      1.1       2    |  0.2922 Â±0.003  0.2876 Â±0.002  0.2916 Â±0.003
EnKF       1.2            |  3.68   Â±0.08   3.38   Â±0.1    3.7    Â±0.1  
LETKF      1.2       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.2       0.4  |  0.4698 Â±0.003  0.4644 Â±0.003  0.47   Â±0.002
LETKF      1.2       2    |  0.3732 Â±0.003  0.3684 Â±0.002  0.3736 Â±0.002
EnKF       1.4            |  3.5    Â±0.1    3.32   Â±0.1    3.48   Â±0.1  
LETKF      1.4       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.4       0.4  |  0.5886 Â±0.003  0.585  Â±0.003  0.588  Â±0.002
LETKF      1.4       2    |  0.4992 Â±0.003  0.495  Â±0.003  0.4992 Â±0.002

[4mâ€¢Table for N=12.[0m
                          |  ____seed=2___  ______3______  ______4______
da_method  infl  loc_rad  |  rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ
---------  ----  -------  -  -------------  -------------  -------------
EnKF       1              |  4.26   Â±0.1    4.24   Â±0.2    4.47   Â±0.07 
LETKF      1         0.1  |  3.776  Â±0.02   3.74   Â±0.02   3.756  Â±0.02 
LETKF      1         0.4  |  0.492  Â±0.03   0.68   Â±0.1    0.428  Â±0.02 
LETKF      1         2    |  1.7    Â±0.6    0.304  Â±0.02   0.324  Â±0.03 
EnKF       1.01           |  4.41   Â±0.09   4.04   Â±0.2    4.27   Â±0.06 
LETKF      1.01      0.1  |  3.824  Â±0.02   3.784  Â±0.02   3.812  Â±0.02 
LETKF      1.01      0.4  |  0.416  Â±0.02   0.43   Â±0.05   0.376  Â±0.009
LETKF      1.01      2    |  0.266  Â±0.007  0.2408 Â±0.004  0.248  Â±0.005
EnKF       1.02           |  4.24   Â±0.08   3.76   Â±0.2    4.28   Â±0.07 
LETKF      1.02      0.1  |  3.888  Â±0.02   3.84   Â±0.02   3.872  Â±0.02 
LETKF      1.02      0.4  |  0.384  Â±0.008  0.376  Â±0.01   0.367  Â±0.007
LETKF      1.02      2    |  0.254  Â±0.006  0.234  Â±0.003  0.2392 Â±0.004
EnKF       1.04           |  3.94   Â±0.09   3.74   Â±0.1    3.94   Â±0.1  
LETKF      1.04      0.1  |  4.088  Â±0.02   4.08   Â±0.02   4.068  Â±0.02 
LETKF      1.04      0.4  |  0.365  Â±0.005  0.354  Â±0.005  0.3608 Â±0.004
LETKF      1.04      2    |  0.2512 Â±0.004  0.2406 Â±0.003  0.2442 Â±0.003
EnKF       1.07           |  3.8    Â±0.1    3.3    Â±0.3    3.72   Â±0.1  
LETKF      1.07      0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.07      0.4  |  0.376  Â±0.004  0.3672 Â±0.004  0.3756 Â±0.003
LETKF      1.07      2    |  0.2694 Â±0.003  0.2632 Â±0.002  0.267  Â±0.003
EnKF       1.1            |  3.44   Â±0.2    3.44   Â±0.2    3.52   Â±0.1  
LETKF      1.1       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.1       0.4  |  0.396  Â±0.003  0.3882 Â±0.003  0.396  Â±0.003
LETKF      1.1       2    |  0.2934 Â±0.003  0.2888 Â±0.002  0.2928 Â±0.002
EnKF       1.2            |  2.96   Â±0.2    2.84   Â±0.2    2.96   Â±0.2  
LETKF      1.2       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.2       0.4  |  0.471  Â±0.003  0.4656 Â±0.003  0.4712 Â±0.002
LETKF      1.2       2    |  0.3756 Â±0.003  0.3712 Â±0.002  0.376  Â±0.002
EnKF       1.4            |  2.34   Â±0.3    2.48   Â±0.2    2.76   Â±0.2  
LETKF      1.4       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.4       0.4  |  0.5898 Â±0.003  0.585  Â±0.003  0.59   Â±0.002
LETKF      1.4       2    |  0.5034 Â±0.003  0.4998 Â±0.003  0.5036 Â±0.002

[4mâ€¢Table for N=14.[0m
                          |  ____seed=2___  ______3______  ______4______
da_method  infl  loc_rad  |  rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ     rmse.a Â±1Ïƒ
---------  ----  -------  -  -------------  -------------  -------------
EnKF       1              |  4.08   Â±0.2    4.12   Â±0.2    4.36   Â±0.1  
LETKF      1         0.1  |  3.764  Â±0.02   3.736  Â±0.02   3.764  Â±0.02 
LETKF      1         0.4  |  0.464  Â±0.04   0.68   Â±0.1    0.424  Â±0.02 
LETKF      1         2    |  1.04   Â±0.4    0.292  Â±0.01   1.4    Â±0.6  
EnKF       1.01           |  4.04   Â±0.2    3.68   Â±0.2    4.16   Â±0.2  
LETKF      1.01      0.1  |  3.816  Â±0.02   3.776  Â±0.02   3.804  Â±0.02 
LETKF      1.01      0.4  |  0.412  Â±0.02   0.396  Â±0.01   0.376  Â±0.008
LETKF      1.01      2    |  0.267  Â±0.008  0.2352 Â±0.004  0.249  Â±0.005
EnKF       1.02           |  3.92   Â±0.2    3.88   Â±0.2    3.5    Â±0.5  
LETKF      1.02      0.1  |  3.868  Â±0.02   3.836  Â±0.02   3.872  Â±0.02 
LETKF      1.02      0.4  |  0.378  Â±0.008  0.368  Â±0.01   0.365  Â±0.006
LETKF      1.02      2    |  0.2472 Â±0.004  0.2334 Â±0.003  0.2392 Â±0.004
EnKF       1.04           |  3.4    Â±0.2    2.5    Â±0.6    2.6    Â±0.6  
LETKF      1.04      0.1  |  4.088  Â±0.02   4.028  Â±0.02   4.08   Â±0.03 
LETKF      1.04      0.4  |  0.365  Â±0.005  0.354  Â±0.005  0.3592 Â±0.004
LETKF      1.04      2    |  0.2496 Â±0.004  0.2406 Â±0.003  0.2448 Â±0.003
EnKF       1.07           |  3.16   Â±0.2    2.82   Â±0.3    2.2    Â±0.6  
LETKF      1.07      0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.07      0.4  |  0.3744 Â±0.004  0.3642 Â±0.003  0.3732 Â±0.003
LETKF      1.07      2    |  0.2688 Â±0.003  0.2628 Â±0.002  0.2682 Â±0.003
EnKF       1.1            |  2.76   Â±0.3    2.34   Â±0.3    1.6    Â±0.5  
LETKF      1.1       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.1       0.4  |  0.3954 Â±0.003  0.3876 Â±0.003  0.3948 Â±0.003
LETKF      1.1       2    |  0.2946 Â±0.003  0.2892 Â±0.002  0.294  Â±0.003
EnKF       1.2            |  1.28   Â±0.4    0.96   Â±0.3    1.62   Â±0.3  
LETKF      1.2       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.2       0.4  |  0.4704 Â±0.003  0.4662 Â±0.003  0.4712 Â±0.002
LETKF      1.2       2    |  0.3774 Â±0.003  0.3736 Â±0.002  0.3776 Â±0.002
EnKF       1.4            |  1.16   Â±0.2    0.55   Â±0.05   1.08   Â±0.3  
LETKF      1.4       0.1  |  nan    Â±nan    nan    Â±nan    nan    Â±nan  
LETKF      1.4       0.4  |  0.5904 Â±0.003  0.5868 Â±0.003  0.5908 Â±0.002
LETKF      1.4       2    |  0.507  Â±0.003  0.5028 Â±0.003  0.506  Â±0.002
"""
_print_1d(xps, "rmse.a", dict(outer="N",inner="seed"))

##
old = """
[4mâ€¢Table for da_method='Climatology'.[0m
seed  |  rmse.a Â±1Ïƒ
----  -  ------------
   2  |   3.632 Â±0.02
   3  |   3.612 Â±0.02
   4  |   3.628 Â±0.02

[4mâ€¢Table for da_method='OptInterp'.[0m
seed  |  rmse.a Â±1Ïƒ
----  -  -------------
   2  |  0.944  Â±0.004
   3  |  0.939  Â±0.003
   4  |  0.9396 Â±0.003

[4mâ€¢Table for da_method='EnKF'.[0m
            |  ____N=10____  _____12_____  _____14_____
seed  infl  |  rmse.a Â±1Ïƒ    rmse.a Â±1Ïƒ    rmse.a Â±1Ïƒ
----  ----  -  ------------  ------------  ------------
   2  1     |    4.54 Â±0.09    4.26 Â±0.1     4.08 Â±0.2 
   2  1.01  |    4.48 Â±0.08    4.41 Â±0.09    4.04 Â±0.2 
   2  1.02  |    4.35 Â±0.08    4.24 Â±0.08    3.92 Â±0.2 
   2  1.04  |    4.4  Â±0.07    3.94 Â±0.09    3.4  Â±0.2 
   2  1.07  |    4    Â±0.1     3.8  Â±0.1     3.16 Â±0.2 
   2  1.1   |    3.9  Â±0.1     3.44 Â±0.2     2.76 Â±0.3 
   2  1.2   |    3.68 Â±0.08    2.96 Â±0.2     1.28 Â±0.4 
   2  1.4   |    3.5  Â±0.1     2.34 Â±0.3     1.16 Â±0.2 
   3  1     |    4.4  Â±0.1     4.24 Â±0.2     4.12 Â±0.2 
   3  1.01  |    4.34 Â±0.1     4.04 Â±0.2     3.68 Â±0.2 
   3  1.02  |    4.26 Â±0.1     3.76 Â±0.2     3.88 Â±0.2 
   3  1.04  |    3.92 Â±0.2     3.74 Â±0.1     2.5  Â±0.6 
   3  1.07  |    3.64 Â±0.2     3.3  Â±0.3     2.82 Â±0.3 
   3  1.1   |    3.64 Â±0.2     3.44 Â±0.2     2.34 Â±0.3 
   3  1.2   |    3.38 Â±0.1     2.84 Â±0.2     0.96 Â±0.3 
   3  1.4   |    3.32 Â±0.1     2.48 Â±0.2     0.55 Â±0.05
   4  1     |    4.72 Â±0.07    4.47 Â±0.07    4.36 Â±0.1 
   4  1.01  |    4.37 Â±0.08    4.27 Â±0.06    4.16 Â±0.2 
   4  1.02  |    4.45 Â±0.07    4.28 Â±0.07    3.5  Â±0.5 
   4  1.04  |    4.16 Â±0.09    3.94 Â±0.1     2.6  Â±0.6 
   4  1.07  |    4.16 Â±0.09    3.72 Â±0.1     2.2  Â±0.6 
   4  1.1   |    4.01 Â±0.09    3.52 Â±0.1     1.6  Â±0.5 
   4  1.2   |    3.7  Â±0.1     2.96 Â±0.2     1.62 Â±0.3 
   4  1.4   |    3.48 Â±0.1     2.76 Â±0.2     1.08 Â±0.3 
"""
_print_1d(xps_shorter, "rmse.a", dict(outer="da_method",inner="N"))

##
old = """
[4mâ€¢Table for da_method='Climatology'.[0m
seed  |  rmse.a Â±1Ïƒ  â˜  âœ“
----  -  ---------------
   2  |   3.632 Â±nan 0 1
   3  |   3.611 Â±nan 0 1
   4  |   3.628 Â±nan 0 1

[4mâ€¢Table for da_method='OptInterp'.[0m
seed  |  rmse.a Â±1Ïƒ  â˜  âœ“
----  -  ---------------
   2  |  0.9436 Â±nan 0 1
   3  |  0.9393 Â±nan 0 1
   4  |  0.9398 Â±nan 0 1

[4mâ€¢Table for da_method='EnKF'.[0m
            |  ______N=10_____  _______12______  _______14______
seed  infl  |  rmse.a Â±1Ïƒ  â˜  âœ“  rmse.a Â±1Ïƒ  â˜  âœ“  rmse.a Â±1Ïƒ  â˜  âœ“
----  ----  -  ---------------  ---------------  ---------------
   2  1     |   4.531 Â±nan 0 1   4.259 Â±nan 0 1  4.098  Â±nan 0 1
   2  1.01  |   4.479 Â±nan 0 1   4.406 Â±nan 0 1  4.043  Â±nan 0 1
   2  1.02  |   4.351 Â±nan 0 1   4.241 Â±nan 0 1  3.911  Â±nan 0 1
   2  1.04  |   4.391 Â±nan 0 1   3.945 Â±nan 0 1  3.411  Â±nan 0 1
   2  1.07  |   3.997 Â±nan 0 1   3.794 Â±nan 0 1  3.157  Â±nan 0 1
   2  1.1   |   3.904 Â±nan 0 1   3.429 Â±nan 0 1  2.774  Â±nan 0 1
   2  1.2   |   3.68  Â±nan 0 1   2.97  Â±nan 0 1  1.273  Â±nan 0 1
   2  1.4   |   3.508 Â±nan 0 1   2.335 Â±nan 0 1  1.166  Â±nan 0 1
   3  1     |   4.393 Â±nan 0 1   4.238 Â±nan 0 1  4.119  Â±nan 0 1
   3  1.01  |   4.347 Â±nan 0 1   4.041 Â±nan 0 1  3.695  Â±nan 0 1
   3  1.02  |   4.254 Â±nan 0 1   3.772 Â±nan 0 1  3.884  Â±nan 0 1
   3  1.04  |   3.929 Â±nan 0 1   3.734 Â±nan 0 1  2.556  Â±nan 0 1
   3  1.07  |   3.626 Â±nan 0 1   3.289 Â±nan 0 1  2.839  Â±nan 0 1
   3  1.1   |   3.624 Â±nan 0 1   3.444 Â±nan 0 1  2.365  Â±nan 0 1
   3  1.2   |   3.377 Â±nan 0 1   2.823 Â±nan 0 1  0.9706 Â±nan 0 1
   3  1.4   |   3.316 Â±nan 0 1   2.47  Â±nan 0 1  0.5529 Â±nan 0 1
   4  1     |   4.712 Â±nan 0 1   4.468 Â±nan 0 1  4.356  Â±nan 0 1
   4  1.01  |   4.369 Â±nan 0 1   4.266 Â±nan 0 1  4.163  Â±nan 0 1
   4  1.02  |   4.454 Â±nan 0 1   4.284 Â±nan 0 1  3.49   Â±nan 0 1
   4  1.04  |   4.166 Â±nan 0 1   3.939 Â±nan 0 1  2.634  Â±nan 0 1
   4  1.07  |   4.166 Â±nan 0 1   3.723 Â±nan 0 1  2.162  Â±nan 0 1
   4  1.1   |   4.019 Â±nan 0 1   3.511 Â±nan 0 1  1.65   Â±nan 0 1
   4  1.2   |   3.707 Â±nan 0 1   2.979 Â±nan 0 1  1.6    Â±nan 0 1
   4  1.4   |   3.478 Â±nan 0 1   2.776 Â±nan 0 1  1.051  Â±nan 0 1
"""
_print_1d(xps_shorter, "rmse.a", dict(outer="da_method",inner="N",mean=()))

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed', 'infl').[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 3.624 Â±0.006 0 3

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed', 'infl').[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 0.941 Â±0.001 0 3

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed', 'infl').[0m
_______N=10______  _______12_______  _______14_______
rmse.a Â±1Ïƒ   â˜   âœ“  rmse.a Â±1Ïƒ  â˜   âœ“  rmse.a Â±1Ïƒ  â˜   âœ“
-----------------  ----------------  ----------------
  4.03 Â±0.08 0 24    3.64 Â±0.1 0 24    2.76 Â±0.2 0 24
"""
_print_1d(xps_shorter, "rmse.a", dict(outer="da_method",inner="N",mean=("seed","infl")))

##
old = """
[4mâ€¢Table for da_method='Climatology'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 3.624 Â±0.006 0 3

[4mâ€¢Table for da_method='OptInterp'. â€¢Averages Î£ over ('seed',).[0m
rmse.a Â±1Ïƒ    â˜  âœ“
-----------------
 0.941 Â±0.001 0 3

[4mâ€¢Table for da_method='EnKF'. â€¢Averages Î£ over ('seed',).[0m
 N  infl  |  rmse.a Â±1Ïƒ   â˜  âœ“
--  ----  -  ----------------
10  1     |   4.55  Â±0.09 0 3
10  1.01  |   4.4   Â±0.04 0 3
10  1.02  |   4.36  Â±0.06 0 3
10  1.04  |   4.16  Â±0.1  0 3
10  1.07  |   3.92  Â±0.2  0 3
10  1.1   |   3.84  Â±0.1  0 3
10  1.2   |   3.58  Â±0.1  0 3
10  1.4   |   3.43  Â±0.06 0 3
12  1     |   4.33  Â±0.07 0 3
12  1.01  |   4.24  Â±0.1  0 3
12  1.02  |   4.08  Â±0.2  0 3
12  1.04  |   3.88  Â±0.07 0 3
12  1.07  |   3.6   Â±0.2  0 3
12  1.1   |   3.462 Â±0.03 0 3
12  1.2   |   2.92  Â±0.05 0 3
12  1.4   |   2.52  Â±0.1  0 3
14  1     |   4.19  Â±0.08 0 3
14  1.01  |   3.96  Â±0.1  0 3
14  1.02  |   3.76  Â±0.1  0 3
14  1.04  |   2.88  Â±0.3  0 3
14  1.07  |   2.7   Â±0.3  0 3
14  1.1   |   2.28  Â±0.3  0 3
14  1.2   |   1.28  Â±0.2  0 3
14  1.4   |   0.92  Â±0.2  0 3
"""
_print_1d(xps_shorter, "rmse.a", dict(outer="da_method",mean=("seed")))

##
old = """
[4mâ€¢Table for da_method='Climatology'.[0m
seed  |  rmse.a Â±1Ïƒ
----  -  ------------
   2  |   3.632 Â±0.02
   3  |   3.612 Â±0.02
   4  |   3.628 Â±0.02

[4mâ€¢Table for da_method='OptInterp'.[0m
seed  |  rmse.a Â±1Ïƒ
----  -  -------------
   2  |  0.944  Â±0.004
   3  |  0.939  Â±0.003
   4  |  0.9396 Â±0.003

[4mâ€¢Table for da_method='EnKF'.[0m
seed   N  infl  |  rmse.a Â±1Ïƒ
----  --  ----  -  ------------
   2  10  1     |    4.54 Â±0.09
   2  10  1.01  |    4.48 Â±0.08
   2  10  1.02  |    4.35 Â±0.08
   2  10  1.04  |    4.4  Â±0.07
   2  10  1.07  |    4    Â±0.1 
   2  10  1.1   |    3.9  Â±0.1 
   2  10  1.2   |    3.68 Â±0.08
   2  10  1.4   |    3.5  Â±0.1 
   2  12  1     |    4.26 Â±0.1 
   2  12  1.01  |    4.41 Â±0.09
   2  12  1.02  |    4.24 Â±0.08
   2  12  1.04  |    3.94 Â±0.09
   2  12  1.07  |    3.8  Â±0.1 
   2  12  1.1   |    3.44 Â±0.2 
   2  12  1.2   |    2.96 Â±0.2 
   2  12  1.4   |    2.34 Â±0.3 
   2  14  1     |    4.08 Â±0.2 
   2  14  1.01  |    4.04 Â±0.2 
   2  14  1.02  |    3.92 Â±0.2 
   2  14  1.04  |    3.4  Â±0.2 
   2  14  1.07  |    3.16 Â±0.2 
   2  14  1.1   |    2.76 Â±0.3 
   2  14  1.2   |    1.28 Â±0.4 
   2  14  1.4   |    1.16 Â±0.2 
   3  10  1     |    4.4  Â±0.1 
   3  10  1.01  |    4.34 Â±0.1 
   3  10  1.02  |    4.26 Â±0.1 
   3  10  1.04  |    3.92 Â±0.2 
   3  10  1.07  |    3.64 Â±0.2 
   3  10  1.1   |    3.64 Â±0.2 
   3  10  1.2   |    3.38 Â±0.1 
   3  10  1.4   |    3.32 Â±0.1 
   3  12  1     |    4.24 Â±0.2 
   3  12  1.01  |    4.04 Â±0.2 
   3  12  1.02  |    3.76 Â±0.2 
   3  12  1.04  |    3.74 Â±0.1 
   3  12  1.07  |    3.3  Â±0.3 
   3  12  1.1   |    3.44 Â±0.2 
   3  12  1.2   |    2.84 Â±0.2 
   3  12  1.4   |    2.48 Â±0.2 
   3  14  1     |    4.12 Â±0.2 
   3  14  1.01  |    3.68 Â±0.2 
   3  14  1.02  |    3.88 Â±0.2 
   3  14  1.04  |    2.5  Â±0.6 
   3  14  1.07  |    2.82 Â±0.3 
   3  14  1.1   |    2.34 Â±0.3 
   3  14  1.2   |    0.96 Â±0.3 
   3  14  1.4   |    0.55 Â±0.05
   4  10  1     |    4.72 Â±0.07
   4  10  1.01  |    4.37 Â±0.08
   4  10  1.02  |    4.45 Â±0.07
   4  10  1.04  |    4.16 Â±0.09
   4  10  1.07  |    4.16 Â±0.09
   4  10  1.1   |    4.01 Â±0.09
   4  10  1.2   |    3.7  Â±0.1 
   4  10  1.4   |    3.48 Â±0.1 
   4  12  1     |    4.47 Â±0.07
   4  12  1.01  |    4.27 Â±0.06
   4  12  1.02  |    4.28 Â±0.07
   4  12  1.04  |    3.94 Â±0.1 
   4  12  1.07  |    3.72 Â±0.1 
   4  12  1.1   |    3.52 Â±0.1 
   4  12  1.2   |    2.96 Â±0.2 
   4  12  1.4   |    2.76 Â±0.2 
   4  14  1     |    4.36 Â±0.1 
   4  14  1.01  |    4.16 Â±0.2 
   4  14  1.02  |    3.5  Â±0.5 
   4  14  1.04  |    2.6  Â±0.6 
   4  14  1.07  |    2.2  Â±0.6 
   4  14  1.1   |    1.6  Â±0.5 
   4  14  1.2   |    1.62 Â±0.3 
   4  14  1.4   |    1.08 Â±0.3 
"""
_print_1d(xps_shorter, "rmse.a", dict(outer="da_method"))

##
old = """
      |  da_method='Climatology',N=None  OptInterp,None  EnKF,10  EnKF,12  EnKF,14
infl  |  rmse.a                          rmse.a          rmse.a   rmse.a   rmse.a
----  -  ------------------------------  --------------  -------  -------  -------
      |  3.624                           0.941                                   
1     |                                                  4.55     4.33     4.19  
1.01  |                                                  4.4      4.24     3.96  
1.02  |                                                  4.36     4.08     3.76  
1.04  |                                                  4.16     3.88     2.88  
1.07  |                                                  3.92     3.6      2.7   
1.1   |                                                  3.84     3.462    2.28  
1.2   |                                                  3.58     2.92     1.28  
1.4   |                                                  3.43     2.52     0.92  
"""
_print_1d(xps_shorter, "rmse.a", dict(inner=("da_method","N"),mean="seed"), subcols=False)

##
old = """
[4mâ€¢Table for da_method='Climatology',seed=2.[0m
rmse.a
------
 3.632

[4mâ€¢Table for da_method='OptInterp',seed=2.[0m
rmse.a
------
 0.944

[4mâ€¢Table for da_method='EnKF',seed=2.[0m
      |  _N=10_  __12__  __14__
infl  |  rmse.a  rmse.a  rmse.a
----  -  ------  ------  ------
1     |    4.54    4.26    4.08
1.01  |    4.48    4.41    4.04
1.02  |    4.35    4.24    3.92
1.04  |    4.4     3.94    3.4 
1.07  |    4       3.8     3.16
1.1   |    3.9     3.44    2.76
1.2   |    3.68    2.96    1.28
1.4   |    3.5     2.34    1.16

[4mâ€¢Table for da_method='Climatology',seed=3.[0m
rmse.a
------
 3.612

[4mâ€¢Table for da_method='OptInterp',seed=3.[0m
rmse.a
------
 0.939

[4mâ€¢Table for da_method='EnKF',seed=3.[0m
      |  _N=10_  __12__  __14__
infl  |  rmse.a  rmse.a  rmse.a
----  -  ------  ------  ------
1     |    4.4     4.24    4.12
1.01  |    4.34    4.04    3.68
1.02  |    4.26    3.76    3.88
1.04  |    3.92    3.74    2.5 
1.07  |    3.64    3.3     2.82
1.1   |    3.64    3.44    2.34
1.2   |    3.38    2.84    0.96
1.4   |    3.32    2.48    0.55

[4mâ€¢Table for da_method='Climatology',seed=4.[0m
rmse.a
------
 3.628

[4mâ€¢Table for da_method='OptInterp',seed=4.[0m
rmse.a
------
0.9396

[4mâ€¢Table for da_method='EnKF',seed=4.[0m
      |  _N=10_  __12__  __14__
infl  |  rmse.a  rmse.a  rmse.a
----  -  ------  ------  ------
1     |    4.72    4.47    4.36
1.01  |    4.37    4.27    4.16
1.02  |    4.45    4.28    3.5 
1.04  |    4.16    3.94    2.6 
1.07  |    4.16    3.72    2.2 
1.1   |    4.01    3.52    1.6 
1.2   |    3.7     2.96    1.62
1.4   |    3.48    2.76    1.08
"""
_print_1d(xps_shorter, "rmse.a", dict(outer=("da_method","seed"),inner="N"), subcols=False)


##
if "--replace" in sys.argv:
    new_code = orig_code[0:replacements[0].nOpen]

    for i,replacement in enumerate(replacements):

        replacement.lines[0] = 'old = """' + replacement.lines[0]
        new_code += replacement.lines

        try:
            nEnd = replacements[i+1].nOpen
        except IndexError:
            nEnd = len(orig_code)
        new_code += orig_code[replacement.nClose : nEnd]

    # Don't overwrite! This allows for diffing.
    with open(__file__+".new", "w") as F:
        for line in new_code:
            # F.write(line.rstrip()+"\n")
            F.write(line)

##
