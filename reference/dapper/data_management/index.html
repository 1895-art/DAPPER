



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Data Management - DAPPER</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#4cae4f">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-dapperdata_management" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="DAPPER" class="md-header-nav__button md-logo" aria-label="DAPPER">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            DAPPER
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Data Management
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/nansencenter/DAPPER/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DAPPER
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DAPPER" class="md-nav__button md-logo" aria-label="DAPPER">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DAPPER
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/nansencenter/DAPPER/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DAPPER
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Dapper
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Dapper" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon"></span>
        Dapper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../admin/" title="Admin" class="md-nav__link">
      Admin
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data Management
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Data Management" class="md-nav__link md-nav__link--active">
      Data Management
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cm_bond" class="md-nav__link">
    cm_bond
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default_fig_adjustments" class="md-nav__link">
    default_fig_adjustments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default_styles" class="md-nav__link">
    default_styles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discretize_cmap" class="md-nav__link">
    discretize_cmap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in_idx" class="md-nav__link">
    in_idx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load_hmm" class="md-nav__link">
    load_HMM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load_xps" class="md-nav__link">
    load_xps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_label" class="md-nav__link">
    make_label
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overwrite_xps" class="md-nav__link">
    overwrite_xps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce_inodes" class="md-nav__link">
    reduce_inodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rel_index" class="md-nav__link">
    rel_index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_xps" class="md-nav__link">
    save_xps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sparsespace" class="md-nav__link">
    SparseSpace
  </a>
  
    <nav class="md-nav" aria-label="SparseSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add_axis" class="md-nav__link">
    add_axis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coords" class="md-nav__link">
    coords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_for" class="md-nav__link">
    get_for
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect_axes" class="md-nav__link">
    intersect_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label_xsection" class="md-nav__link">
    label_xSection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nest" class="md-nav__link">
    nest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xpspace" class="md-nav__link">
    xpSpace
  </a>
  
    <nav class="md-nav" aria-label="xpSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
    <nav class="md-nav" aria-label="Static methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from_list" class="md-nav__link">
    from_list
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add_axis_1" class="md-nav__link">
    add_axis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear_1" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coords_1" class="md-nav__link">
    coords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_1" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field" class="md-nav__link">
    field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys_1" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_1" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_for_1" class="md-nav__link">
    get_for
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect_axes_1" class="md-nav__link">
    intersect_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items_1" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys_1" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label_xsection_1" class="md-nav__link">
    label_xSection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nest_1" class="md-nav__link">
    nest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop_1" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem_1" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print" class="md-nav__link">
    print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault_1" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_tree" class="md-nav__link">
    table_tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tickz" class="md-nav__link">
    tickz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tune" class="md-nav__link">
    tune
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_1" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate_axes" class="md-nav__link">
    validate_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values_1" class="md-nav__link">
    values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dict_tools/" title="Dict Tools" class="md-nav__link">
      Dict Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dpr_config/" title="Dpr Config" class="md-nav__link">
      Dpr Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stats/" title="Stats" class="md-nav__link">
      Stats
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cm_bond" class="md-nav__link">
    cm_bond
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default_fig_adjustments" class="md-nav__link">
    default_fig_adjustments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default_styles" class="md-nav__link">
    default_styles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discretize_cmap" class="md-nav__link">
    discretize_cmap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in_idx" class="md-nav__link">
    in_idx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load_hmm" class="md-nav__link">
    load_HMM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load_xps" class="md-nav__link">
    load_xps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_label" class="md-nav__link">
    make_label
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overwrite_xps" class="md-nav__link">
    overwrite_xps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce_inodes" class="md-nav__link">
    reduce_inodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rel_index" class="md-nav__link">
    rel_index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_xps" class="md-nav__link">
    save_xps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sparsespace" class="md-nav__link">
    SparseSpace
  </a>
  
    <nav class="md-nav" aria-label="SparseSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add_axis" class="md-nav__link">
    add_axis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coords" class="md-nav__link">
    coords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_for" class="md-nav__link">
    get_for
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect_axes" class="md-nav__link">
    intersect_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label_xsection" class="md-nav__link">
    label_xSection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nest" class="md-nav__link">
    nest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xpspace" class="md-nav__link">
    xpSpace
  </a>
  
    <nav class="md-nav" aria-label="xpSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
    <nav class="md-nav" aria-label="Static methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from_list" class="md-nav__link">
    from_list
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add_axis_1" class="md-nav__link">
    add_axis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear_1" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coords_1" class="md-nav__link">
    coords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy_1" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field" class="md-nav__link">
    field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fromkeys_1" class="md-nav__link">
    fromkeys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_1" class="md-nav__link">
    get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_for_1" class="md-nav__link">
    get_for
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect_axes_1" class="md-nav__link">
    intersect_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#items_1" class="md-nav__link">
    items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys_1" class="md-nav__link">
    keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label_xsection_1" class="md-nav__link">
    label_xSection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nest_1" class="md-nav__link">
    nest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop_1" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popitem_1" class="md-nav__link">
    popitem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print" class="md-nav__link">
    print
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault_1" class="md-nav__link">
    setdefault
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_tree" class="md-nav__link">
    table_tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tickz" class="md-nav__link">
    tickz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tune" class="md-nav__link">
    tune
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_1" class="md-nav__link">
    update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate_axes" class="md-nav__link">
    validate_axes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values_1" class="md-nav__link">
    values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nansencenter/DAPPER/edit/master/reference/dapper/data_management.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="module-dapperdata_management">Module dapper.data_management</h1>
<p>Define xpSpace (subclasses SparseSpace (subclasses dict)),</p>
<p>which is handles the <strong>presentation</strong> of experiment (xp) results.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Define xpSpace (subclasses SparseSpace (subclasses dict)),</span>

<span class="sd">which is handles the **presentation** of experiment (xp) results.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span><span class="p">,</span> <span class="n">ticker</span>

<span class="kn">import</span> <span class="nn">colorama</span>

<span class="kn">import</span> <span class="nn">dill</span>

<span class="kn">from</span> <span class="nn">dapper.tools.colors</span> <span class="kn">import</span> <span class="n">color_text</span>

<span class="kn">from</span> <span class="nn">dapper.tools.viz</span> <span class="kn">import</span> <span class="n">axis_scale_by_array</span><span class="p">,</span> <span class="n">freshfig</span>

<span class="kn">from</span> <span class="nn">dapper.tools.series</span> <span class="kn">import</span> <span class="n">UncertainQtty</span>

<span class="kn">from</span> <span class="nn">dapper.stats</span> <span class="kn">import</span> <span class="n">tabulate_column</span><span class="p">,</span> <span class="n">unpack_uqs</span>

<span class="kn">from</span> <span class="nn">dapper.admin</span> <span class="kn">import</span> <span class="n">xpList</span>

<span class="kn">import</span> <span class="nn">dapper.dict_tools</span> <span class="k">as</span> <span class="nn">dict_tools</span>

<span class="kn">import</span> <span class="nn">dapper.tools.remote.uplink</span> <span class="k">as</span> <span class="nn">uplink</span>

<span class="kn">import</span> <span class="nn">dapper.tools.utils</span> <span class="k">as</span> <span class="nn">utils</span>

<span class="n">mpl_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">)</span>

<span class="n">NO_KEY</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;da_method&quot;</span><span class="p">,</span> <span class="s2">&quot;Const&quot;</span><span class="p">,</span> <span class="s2">&quot;upd_a&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_label</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">no_key</span><span class="o">=</span><span class="n">NO_KEY</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">()):</span>

    <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coord</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">}</span>

    <span class="n">lbl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">no_key</span><span class="p">):</span>

                <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">utils</span><span class="o">.</span><span class="n">collapse_str</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">return</span> <span class="n">lbl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">default_styles</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">baseline_legends</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Quick and dirty (but somewhat robust) styling.&quot;&quot;&quot;</span>

    <span class="n">style</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">DotDict</span><span class="p">(</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">make_label</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;Climatology&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;OptInterp&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Opt. Interp.&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;Var3D&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;3D-Var&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;EnKF&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;PartFilt&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;C2&quot;</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">style</span>

<span class="k">def</span> <span class="nf">rel_index</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;``lst.index(elem) / len(lst)`` with fallback.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">lst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">default</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">discretize_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">val0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Discretize cmap so that it partitions [0,1] into N segments.</span>

<span class="sd">    I.e. cmap(k/N) == cmap(k/N + eps).</span>

<span class="sd">    Also provide the ScalarMappable ``sm``</span>

<span class="sd">    that maps range(N) to the segment centers,</span>

<span class="sd">    as will be reflected by ``cb = fig.colorbar(sm)``.</span>

<span class="sd">    You can then re-label the ticks using</span>

<span class="sd">    ``cb.set_ticks(np.arange(N)); cb.set_ticklabels([&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,...])``.&quot;&quot;&quot;</span>

    <span class="c1"># cmap(k/N)</span>

    <span class="n">from_list</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">linspace</span><span class="p">(</span><span class="n">val0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">from_list</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># sm</span>

    <span class="n">cNorm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-.</span><span class="mi">5</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">sm</span>

<span class="k">def</span> <span class="nf">cm_bond</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">xp_dict</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Map cmap for coord.axis ∈ [0, len(ticks)].&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Essentially: cmap(ticks.index(coord.axis))&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

            <span class="n">ticks</span> <span class="o">=</span> <span class="n">xp_dict</span><span class="o">.</span><span class="n">ticks</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>

            <span class="n">cNorm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span>

            <span class="n">ScMap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span><span class="o">.</span><span class="n">to_rgba</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">ScMap</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">cmap</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">link</span>

<span class="k">def</span> <span class="nf">in_idx</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="kp">indices</span><span class="p">,</span> <span class="n">xp_dict</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Essentially: coord.axis in ticks[indices]&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">(</span><span class="n">xp_dict</span><span class="o">.</span><span class="n">ticks</span><span class="p">[</span><span class="n">axis</span><span class="p">])[</span><span class="kp">indices</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ticks</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">load_HMM</span><span class="p">(</span><span class="n">save_as</span><span class="p">):</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">HMM</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="kp">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))[</span><span class="s2">&quot;HMM&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HMM</span>

<span class="k">def</span> <span class="nf">load_xps</span><span class="p">(</span><span class="n">save_as</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Load ``xps`` (as a simple list) from dir.&quot;&quot;&quot;</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">uplink</span><span class="o">.</span><span class="n">list_job_dirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">load_any</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Load any/all ``xp&#39;s`` from ``filepath``.&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>

            <span class="c1"># If experiment crashed, then xp will be empty</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="kp">load</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Always return list</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;xps&quot;</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;xp&quot;</span><span class="p">]]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading </span><span class="si">%d</span><span class="s2"> files from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">save_as</span><span class="p">))</span>

    <span class="n">xps</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># NB: progbar wont clean up properly w/ list compr.</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">progbar</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loading&quot;</span><span class="p">):</span>

        <span class="n">xps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">load_any</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">xps</span><span class="p">)</span><span class="si">}</span><span class="s2"> files could not be loaded.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xps</span>

<span class="k">def</span> <span class="nf">save_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Split xps and save in save_as/i for i in range(nDir).</span>

<span class="sd">    Example: rename attr n_iter to nIter:</span>

<span class="sd">    &gt;&gt;&gt; proj_name = &quot;Stein&quot;</span>

<span class="sd">    &gt;&gt;&gt; dd = dpr.rc.dirs.data / proj_name</span>

<span class="sd">    &gt;&gt;&gt; save_as = dd / &quot;run_2020-09-22__19:36:13&quot;</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt; for save_as in os.listdir(dd):</span>

<span class="sd">    &gt;&gt;&gt;     save_as = dd / save_as</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     xps = load_xps(save_as)</span>

<span class="sd">    &gt;&gt;&gt;     HMM = load_HMM(save_as)</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     for xp in xps:</span>

<span class="sd">    &gt;&gt;&gt;         if hasattr(xp,&quot;n_iter&quot;):</span>

<span class="sd">    &gt;&gt;&gt;             xp.nIter = xp.n_iter</span>

<span class="sd">    &gt;&gt;&gt;             del xp.n_iter</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     overwrite_xps(xps, save_as)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">save_as</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">splitting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array_split</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sub_xps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">splitting</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Saving&quot;</span><span class="p">)):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_xps</span><span class="p">):</span>

            <span class="n">iDir</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">iDir</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">iDir</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>

                <span class="n">dill</span><span class="o">.</span><span class="kp">dump</span><span class="p">({</span><span class="s1">&#39;xps&#39;</span><span class="p">:</span> <span class="n">sub_xps</span><span class="p">},</span> <span class="n">F</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">overwrite_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Save xps in save_as, but safely (by first saving to tmp).&quot;&quot;&quot;</span>

    <span class="n">save_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>

    <span class="c1"># Delete</span>

    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">uplink</span><span class="o">.</span><span class="n">list_job_dirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">),</span>

                             <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Deleting old&quot;</span><span class="p">):</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="c1"># Mv up from tmp/ -- goes quick, coz there are not many.</span>

    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;tmp&quot;</span><span class="p">):</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;tmp&quot;</span><span class="o">/</span><span class="n">d</span><span class="p">,</span> <span class="n">save_as</span><span class="o">/</span><span class="n">d</span><span class="p">)</span>

    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;tmp&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reduce_inodes</span><span class="p">(</span><span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Reduce the number of ``xp`` dirs</span>

<span class="sd">    by packing multiple ``xp``s into lists (``xps``).</span>

<span class="sd">    This reduces the **number** of files (inodes) on the system,</span>

<span class="sd">    which limits storage capacity (along with **size**).</span>

<span class="sd">    It also deletes files &quot;xp.var&quot; and &quot;out&quot;</span>

<span class="sd">    (which tends to be relatively large coz of the progbar).</span>

<span class="sd">    This is probably also the reason that the loading time is sometimes reduced.&quot;&quot;&quot;</span>

    <span class="n">overwrite_xps</span><span class="p">(</span><span class="n">load_xps</span><span class="p">(</span><span class="n">save_as</span><span class="p">),</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SparseSpace</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Dict, subclassed enforce key conformity (to a coord. sys, i.e. a space).</span>

<span class="sd">    The coordinate system is specified by its &quot;axes&quot;,</span>

<span class="sd">    which is used to produce self.Coord (a namedtuple class).</span>

<span class="sd">    As a normal dict, it can hold any type of objects.</span>

<span class="sd">    In normal use, this space is highly sparse,</span>

<span class="sd">    coz there are many coordinates with no matching experiment,</span>

<span class="sd">    eg. coord(da_method=Climatology, rot=True, ...).</span>

<span class="sd">    Indeed, operations across (potentially multiple simultaneous) axes,</span>

<span class="sd">    such as optimization or averaging, should be carried out by iterating</span>

<span class="sd">    -- not over the axis -- but over the the list of items.</span>

<span class="sd">    The most important method is ``nest()``,</span>

<span class="sd">    which is used (by xpSpace.table_tree) to separate tables/columns,</span>

<span class="sd">    and also to carry out the mean/optim operations.</span>

<span class="sd">    In addition, __getitem__() is very flexible, allowing accessing by:</span>

<span class="sd">    - The actual key, a self.Coord object. Returns single item.</span>

<span class="sd">    - A dict match against (part of) the coordinates. Returns subspace.</span>

<span class="sd">    - An int. Returns list(self)[key].</span>

<span class="sd">    - A list of any of the above. Returns list.</span>

<span class="sd">    This flexibility can cause bugs, but it&#39;s probably still worth it).</span>

<span class="sd">    Also see __call__(), get_for(), and coords(), for further convenience.</span>

<span class="sd">    Inspired by https://stackoverflow.com/a/7728830</span>

<span class="sd">    Also see https://stackoverflow.com/q/3387691 &quot;&quot;&quot;</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="o">.</span><span class="n">_fields</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Define coordinate system</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Coord&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="c1"># Write dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Add repr/str</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>

            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">!r}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="o">.</span><span class="fm">__str__</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Update using custom __setitem__().&quot;&quot;&quot;</span>

        <span class="c1"># See https://stackoverflow.com/a/2588648</span>

        <span class="c1"># and https://stackoverflow.com/a/2390997</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Setitem ensuring coordinate conforms.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>

                <span class="sa">f</span><span class="s2">&quot;The key </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> did not fit the coord. system &quot;</span>

                <span class="sa">f</span><span class="s2">&quot;which has axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Flexible indexing.&quot;&quot;&quot;</span>

        <span class="c1"># List of items (by a list of indices).</span>

        <span class="c1"># Also see get_for().</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]</span>

        <span class="c1"># Single (by integer) or list (by Slice)</span>

        <span class="c1"># Note: NOT validating np.int64 here catches quite a few bugs.</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()][</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Subspace (by dict, ie. an informal, partial coordinate)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

            <span class="kp">outer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">outer_axes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>  <span class="c1"># nest</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="kp">outer</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>      <span class="c1"># create coord</span>

            <span class="kp">inner</span> <span class="o">=</span> <span class="kp">outer</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>                    <span class="c1"># chose subspace</span>

            <span class="k">return</span> <span class="kp">inner</span>

        <span class="c1"># Single item (by Coord object, coz an integer (eg)</span>

        <span class="c1"># gets interpreted (above) as a list index)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># NB: Dont&#39;t use isinstance(key, self.Coord)</span>

            <span class="c1"># coz it fails when the namedtuple (Coord) has been</span>

            <span class="c1"># instantiated in different places (but with equal params).</span>

            <span class="c1"># Also see bugs.python.org/issue7796</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getkey__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Inverse of dict.__getitem__(), but also works on coords.</span>

<span class="sd">        Note: This dunder method is not a &quot;builtin&quot; naming convention.&quot;&quot;&quot;</span>

        <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Convenience, that enables, eg.:</span>

<span class="sd">        &gt;&gt;&gt; xp_dict(da_method=&quot;EnKF&quot;, infl=1, seed=3)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Almost ``[self.get(Coord(x)) for x in ticks]``.</span>

<span class="sd">        NB: using the &quot;naive&quot; thing: ``[self[x] for x in ticks]``</span>

<span class="sd">        would probably be a BUG coz x gets interpreted as indices</span>

<span class="sd">        for the internal list.&quot;&quot;&quot;</span>

        <span class="n">singleton</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">coord</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">xyz</span> <span class="k">if</span> <span class="n">singleton</span> <span class="k">else</span> <span class="n">xyz</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">coord</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get all ``coord``s matching kwargs.</span>

<span class="sd">        Unlike ``__getitem__(kwargs)``,</span>

<span class="sd">        - A list is returned, not a subspace.</span>

<span class="sd">        - This list constains keys (coords), not values.</span>

<span class="sd">        - The coords refer to the original space, not the subspace.</span>

<span class="sd">        The last point is especially useful for label_xSection().</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">embed</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span> <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">coord</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()}</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">**</span><span class="n">embed</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">kwargs</span><span class="p">]]</span>

        <span class="c1"># Old implementation.</span>

        <span class="c1"># - I prefer the new version for its re-use of __getitem__&#39;s</span>

        <span class="c1">#   nesting, evidencing their mutual relationship)</span>

        <span class="c1"># - Note that unlike xpList.inds(): missingval shenanigans</span>

        <span class="c1">#   are here unnecessary coz each coordinate is complete.</span>

        <span class="c1"># match  = lambda x: all(getattr(x,k)==kwargs[k] for k in kwargs)</span>

        <span class="c1"># return [x for x in self if match(x)]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Note: print(xpList(self)) produces more human-readable key listing,</span>

        <span class="c1"># but we don&#39;t want to implement it here, coz it requires split_attrs(),</span>

        <span class="c1"># which we don&#39;t really want to call again.</span>

        <span class="n">L</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

        <span class="k">if</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>

            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[:</span><span class="n">L</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">:]</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">]&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> keys: </span><span class="si">{</span><span class="n">keys</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># txt += &quot; befitting the coord. sys. with axes &quot;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">placed in a coord-sys with axes &quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;(and ticks):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">AlignedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">txt</span>

    <span class="k">def</span> <span class="nf">nest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outer_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return a new xpSpace with axes ``outer_axes``,</span>

<span class="sd">        obtained by projecting along the ``inner_axes``.</span>

<span class="sd">        The entries of this ``xpSpace`` are themselves ``xpSpace``s,</span>

<span class="sd">        with axes ``inner_axes``,</span>

<span class="sd">        each one regrouping the entries with the same (projected) coordinate.</span>

<span class="sd">        Note: is also called by ``__getitem__(key)`` if ``key`` is dict.&quot;&quot;&quot;</span>

        <span class="c1"># Default: a singleton outer space,</span>

        <span class="c1"># with everything contained in the inner (projection) space.</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outer_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c1"># Validate axes</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">assert</span> <span class="n">outer_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="n">inner_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">assert</span> <span class="n">outer_axes</span> <span class="ow">is</span> <span class="kc">None</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">inner_axes</span><span class="p">)</span>

        <span class="c1"># Fill spaces</span>

        <span class="n">outer_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">outer_coord</span> <span class="o">=</span> <span class="n">outer_space</span><span class="o">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="n">outer_space</span><span class="p">[</span><span class="n">outer_coord</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">inner_axes</span><span class="p">)</span>

                <span class="n">outer_space</span><span class="p">[</span><span class="n">outer_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_space</span>

            <span class="n">inner_space</span><span class="p">[</span><span class="n">inner_space</span><span class="o">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">return</span> <span class="n">outer_space</span>

    <span class="k">def</span> <span class="nf">add_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">+</span><span class="p">(</span><span class="n">axis</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">coord</span> <span class="o">+</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">intersect_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Rm those a in attrs that are not in self.axes.</span>

<span class="sd">        This allows errors in the axes allotment, for ease-of-use.&quot;&quot;&quot;</span>

        <span class="n">absent</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">absent</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="s2">&quot;Warning:&quot;</span><span class="p">,</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="s2">&quot;The requested attributes&quot;</span><span class="p">,</span>

                  <span class="n">color_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">absent</span><span class="p">),</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="p">(</span><span class="s2">&quot;were not found among the&quot;</span>

                   <span class="s2">&quot; xpSpace axes (attrs. used as coordinates&quot;</span>

                   <span class="s2">&quot; for the set of experiments).&quot;</span>

                   <span class="s2">&quot; This may be no problem if the attr. is redundant&quot;</span>

                   <span class="s2">&quot; for the coord-sys.&quot;</span>

                   <span class="s2">&quot; However, if it is caused by confusion or mis-spelling,&quot;</span>

                   <span class="s2">&quot; then it is likely to cause mis-interpretation&quot;</span>

                   <span class="s2">&quot; of the shown results.&quot;</span><span class="p">))</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">absent</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">label_xSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span> <span class="o">**</span><span class="n">sub_coord</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Insert duplicate entries for the cross section</span>

<span class="sd">        whose ``coord``s match ``sub_coord``,</span>

<span class="sd">        adding the attr ``Const=label`` to their ``coord``,</span>

<span class="sd">        reflecting the &quot;constance/constraint/fixation&quot; this represents.</span>

<span class="sd">        This distinguishes the entries in this fixed-affine subspace,</span>

<span class="sd">        preventing them from being gobbled up in ``nest()``.</span>

<span class="sd">        If you wish, you can specify the ``NoneAttrs``,</span>

<span class="sd">        which are consequently set to None for the duplicated entries,</span>

<span class="sd">        preventing them from getting plotted in tuning panels.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;Const&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_axis</span><span class="p">(</span><span class="s1">&#39;Const&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">sub_coord</span><span class="p">)):</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="kp">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">coord</span><span class="p">])</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">Const</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">NoneAttrs</span><span class="p">})</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

<span class="n">AXES_ROLES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="kp">outer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="kp">inner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="kp">mean</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optim</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">xpSpace</span><span class="p">(</span><span class="n">SparseSpace</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Functionality to facilitate working with ``xps`` and their results.</span>

<span class="sd">    The function ``from_list()`` initializes a ``SparseSpace`` from a list</span>

<span class="sd">    of objects, typically experiments referred to as ``xps``, by</span>

<span class="sd">    (1) computing the relevant axes from the attributes, and</span>

<span class="sd">    (2) filling the dict by ``xps``.</span>

<span class="sd">    The main use of xpSpace is through its ``print()`` &amp; ``plot()``,</span>

<span class="sd">    both of which call ``table_tree()`` to nest the axes of the SparseSpace.</span>

<span class="sd">    For custom plotting, you will likely want to start with ``table_tree()``.</span>

<span class="sd">    Using ``from_list(xps)`` creates a SparseSpace holding ``xps``.</span>

<span class="sd">    However, the nested ``xpSpace``s output by ``table_tree()``, will hold</span>

<span class="sd">    objects of type ``UncertainQtty``,</span>

<span class="sd">    coz ``table_tree()`` calls ``mean()`` calls ``field(statkey)``.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>

    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xps</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Init xpSpace from xpList.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">make_ticks</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">ordering</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>

                    <span class="n">N</span>         <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>

                    <span class="kp">seed</span>      <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>

                    <span class="n">infl</span>      <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>

                    <span class="n">loc_rad</span>   <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>

                    <span class="n">rot</span>       <span class="o">=</span> <span class="s1">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="n">da_method</span> <span class="o">=</span> <span class="s1">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="p">)):</span>

            <span class="sd">&quot;&quot;&quot;Unique &amp; sort, for each axis (individually) in axes.&quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">ax_name</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">ticks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>  <span class="c1"># unique (jumbles order)</span>

                <span class="c1"># Sort</span>

                <span class="n">order</span> <span class="o">=</span> <span class="n">ordering</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ax_name</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>  <span class="c1"># eg. mylist.index</span>

                    <span class="n">ticks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;as_found&#39;</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>

                    <span class="n">ticks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># default sorting, with None placed at the end</span>

                    <span class="n">ticks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">order</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span> <span class="s1">&#39;inv&#39;</span><span class="p">]):</span>

                    <span class="n">ticks</span> <span class="o">=</span> <span class="n">ticks</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">axes</span><span class="p">[</span><span class="n">ax_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticks</span>

        <span class="c1"># Define axes</span>

        <span class="n">xp_list</span> <span class="o">=</span> <span class="n">xpList</span><span class="p">(</span><span class="n">xps</span><span class="p">)</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">xp_list</span><span class="o">.</span><span class="n">split_attrs</span><span class="p">(</span><span class="n">nomerge</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Const&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">make_ticks</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Note: this attr (ticks) will not be propagated through nest().</span>

        <span class="c1"># That is fine. Otherwise we should have to prune the ticks</span>

        <span class="c1"># (if they are to be useful), which we don&#39;t want to do.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="c1"># Fill</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">xp</span><span class="p">):</span> <span class="n">xp</span> <span class="k">for</span> <span class="n">xp</span> <span class="ow">in</span> <span class="n">xps</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Extract ``statkey`` for each item in ``self``.&quot;&quot;&quot;</span>

        <span class="c1"># Init a new xpDict to hold field</span>

        <span class="n">avrgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="n">found_anything</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">avrgs</span><span class="p">,</span> <span class="n">statkey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">avrgs</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">found_anything</span> <span class="o">=</span> <span class="n">found_anything</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_anything</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>

                <span class="sa">f</span><span class="s2">&quot;The stat. field &#39;</span><span class="si">{</span><span class="n">statkey</span><span class="si">}</span><span class="s2">&#39; was not found&quot;</span>

                <span class="s2">&quot; among any of the xp&#39;s.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avrgs</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Note: The case ``axes=()`` should work w/o special treatment.</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">nested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">nested</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">def</span> <span class="nf">getval</span><span class="p">(</span><span class="n">uq</span><span class="p">):</span> <span class="k">return</span> <span class="n">uq</span><span class="o">.</span><span class="n">val</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uq</span><span class="p">,</span> <span class="n">UncertainQtty</span><span class="p">)</span> <span class="k">else</span> <span class="n">uq</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">getval</span><span class="p">(</span><span class="n">uq</span><span class="p">)</span> <span class="k">for</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">space</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

            <span class="c1"># Don&#39;t use nanmean! It would give false impressions.</span>

            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>

                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

                <span class="c1"># Don&#39;t print warnings caused by N=1.</span>

                <span class="c1"># It already correctly yield nan&#39;s.</span>

                <span class="kp">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">var</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">uq</span> <span class="o">=</span> <span class="n">UncertainQtty</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">var</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>

            <span class="n">uq</span><span class="o">.</span><span class="n">nTotal</span>   <span class="o">=</span> <span class="n">N</span>

            <span class="n">uq</span><span class="o">.</span><span class="n">nFail</span>    <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="kp">isfinite</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">.</span><span class="kp">sum</span><span class="p">()</span>

            <span class="n">uq</span><span class="o">.</span><span class="n">nSuccess</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">uq</span><span class="o">.</span><span class="n">nFail</span>

            <span class="n">nested</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">uq</span>

        <span class="k">return</span> <span class="n">nested</span>

    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">costfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get (compile/tabulate) a stat field optimised wrt. tuning params.&quot;&quot;&quot;</span>

        <span class="c1"># Define cost-function</span>

        <span class="n">costfun</span> <span class="o">=</span> <span class="p">(</span><span class="n">costfun</span> <span class="ow">or</span> <span class="s1">&#39;increasing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;increas&#39;</span> <span class="ow">in</span> <span class="n">costfun</span><span class="p">:</span>

            <span class="n">costfun</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">+</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s1">&#39;decreas&#39;</span> <span class="ow">in</span> <span class="n">costfun</span><span class="p">:</span>

            <span class="n">costfun</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">costfun</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span>  <span class="c1"># custom</span>

        <span class="c1"># Note: The case ``axes=()`` should work w/o special treatment.</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">nested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">nested</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Find optimal value and coord within space</span>

            <span class="n">MIN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">inf</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">inner_coord</span><span class="p">,</span> <span class="n">uq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">space</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

                <span class="n">cost</span> <span class="o">=</span> <span class="n">costfun</span><span class="p">(</span><span class="n">uq</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">cost</span> <span class="o">&lt;=</span> <span class="n">MIN</span><span class="p">:</span>

                    <span class="n">MIN</span>                <span class="o">=</span> <span class="n">cost</span>

                    <span class="n">uq_opt</span>             <span class="o">=</span> <span class="n">uq</span>

                    <span class="n">uq_opt</span><span class="o">.</span><span class="n">tuned_coord</span> <span class="o">=</span> <span class="n">inner_coord</span>

            <span class="n">nested</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">uq_opt</span>

        <span class="k">return</span> <span class="n">nested</span>

    <span class="k">def</span> <span class="nf">validate_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Validate axes.</span>

<span class="sd">        Note: This does not convert None to (),</span>

<span class="sd">              allowing None to remain special.</span>

<span class="sd">              Use ``axis or ()`` wherever tuples are required.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">roles</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;inv&quot;</span>

        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">AXES_ROLES</span><span class="p">):</span>

            <span class="k">assert</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">AXES_ROLES</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid role </span><span class="si">{</span><span class="n">role</span><span class="si">!r}</span><span class="s2">&quot;</span>

            <span class="n">aa</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">AXES_ROLES</span><span class="p">[</span><span class="n">role</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">aa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">pass</span>  <span class="c1"># Purposely special</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Ensure iterable</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>

                    <span class="n">aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">aa</span><span class="p">,)</span>

                <span class="n">aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">aa</span><span class="p">:</span>

                    <span class="c1"># Ensure unique</span>

                    <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>

                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>

                            <span class="sa">f</span><span class="s2">&quot;An axis (here </span><span class="si">{</span><span class="n">axis</span><span class="si">!r}</span><span class="s2">) cannot be assigned to 2&quot;</span>

                            <span class="sa">f</span><span class="s2">&quot; roles (here </span><span class="si">{</span><span class="n">role</span><span class="si">!r}</span><span class="s2"> and </span><span class="si">{</span><span class="n">roles</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="si">!r}</span><span class="s2">).&quot;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">roles</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">role</span>

            <span class="n">axes</span><span class="p">[</span><span class="n">role</span><span class="p">]</span> <span class="o">=</span> <span class="n">aa</span>

        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">table_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Hierarchical nest(): xp_dict&gt;outer&gt;inner&gt;mean&gt;optim.</span>

<span class="sd">        as specified by ``axes``. Returns this new xpSpace.</span>

<span class="sd">        - print_1d / plot_1d (respectively) separate</span>

<span class="sd">          tables / panel(row)s for ``axes[&#39;outer&#39;]``, and</span>

<span class="sd">          columns/ x-axis      for ``axes[&#39;inner&#39;]``.</span>

<span class="sd">        - The ``axes[&#39;mean&#39;]`` and ``axes[&#39;optim&#39;]`` get eliminated</span>

<span class="sd">          by the mean()/tune() operations.</span>

<span class="sd">        Note: cannot support multiple statkeys</span>

<span class="sd">              because it&#39;s not (obviously) meaningful</span>

<span class="sd">              when optimizing over tuning_axes.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mean_tune</span><span class="p">(</span><span class="n">xp_dict</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Take mean, then tune.</span>

<span class="sd">            Note: the SparseDict implementation should be sufficiently</span>

<span class="sd">            &quot;uncluttered&quot; that mean_tune() (or a few of its code lines)</span>

<span class="sd">            could be called anywhere above/between/below</span>

<span class="sd">            the ``nest()``ing of ``outer`` or ``inner``.</span>

<span class="sd">            These possibile call locations are commented in the code.&quot;&quot;&quot;</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">xp_dict</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">statkey</span><span class="p">)</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">uq_dict</span><span class="o">.</span><span class="kp">mean</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">uq_dict</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">uq_dict</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="n">mean_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Prefer calling mean_tune() [also see its docstring]</span>

        <span class="c1"># before doing outer/inner nesting. This is because then the axes of</span>

        <span class="c1"># a row (xpSpace) should not include mean&amp;optim, and thus:</span>

        <span class="c1">#  - Column header/coords may be had directly as row.keys(),</span>

        <span class="c1">#    without extraction by __getkey__() from (e.g.) row[0].</span>

        <span class="c1">#  - Don&#39;t need to propagate mean&amp;optim axes down to the row level.</span>

        <span class="c1">#    which would require defining rows by the nesting:</span>

        <span class="c1">#    rows = table.nest(outer_axes=dict_tools.complement(table.axes,</span>

        <span class="c1">#        *(axes[&#39;inner&#39;] or ()),</span>

        <span class="c1">#        *(axes[&#39;mean&#39;]  or ()),</span>

        <span class="c1">#        *(axes[&#39;optim&#39;] or ()) ))</span>

        <span class="c1">#  - Each level of the output from table_tree</span>

        <span class="c1">#    is a smaller (and more manageable) dict.</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">outer_axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;outer&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># table = mean_tune(table)</span>

            <span class="c1"># Should not be used (nesting as rows is more natural,</span>

            <span class="c1"># and is required for getting distinct/row_keys).</span>

            <span class="c1"># cols = table.nest(outer_axes=axes[&#39;inner&#39;])</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">inner_axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;inner&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">())</span>

            <span class="c1"># Overwrite table by its nesting as rows</span>

            <span class="n">tables</span><span class="p">[</span><span class="n">table_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">rows</span>

            <span class="c1"># for row_coord, row in rows.items():</span>

            <span class="c1"># rows[row_coord] = mean_tune(row)</span>

        <span class="k">return</span> <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span>

    <span class="k">def</span> <span class="nf">tickz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Axis ticks without None&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="p">[</span><span class="n">axis_name</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">AXES_ROLES</span><span class="p">,</span>

              <span class="n">subcols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Print tables of results.</span>

<span class="sd">        - statkey: The statistical field from the experiments to report.</span>

<span class="sd">        - subcols: If True, then subcolumns are added to indicate the</span>

<span class="sd">                   1σ confidence interval, and potentially some other stuff.</span>

<span class="sd">        - axes: Allots (maps) each role to a set of axis of the xp_dict.</span>

<span class="sd">          Suggestion:</span>

<span class="sd">          &gt;&gt;&gt; dict(</span>

<span class="sd">          &gt;&gt;&gt;    outer=&#39;da_method&#39;, inner=&#39;N&#39;, mean=&#39;seed&#39;,</span>

<span class="sd">          &gt;&gt;&gt;    optim=(&#39;infl&#39;,&#39;loc_rad&#39;))</span>

<span class="sd">          Example: If ``mean`` is assigned to:</span>

<span class="sd">          - (&quot;seed&quot;,): Experiments are averaged accross seeds,</span>

<span class="sd">                       and the 1σ (sub)col is computed as sqrt(var(xps)/N),</span>

<span class="sd">                       where xps is a set of experiments.</span>

<span class="sd">          - ()       : Experiments are averaged across nothing</span>

<span class="sd">                       (i.e. this is an edge case).</span>

<span class="sd">          - None     : Experiments are not averaged</span>

<span class="sd">                       (i.e. the values are the same as above),</span>

<span class="sd">                       and the 1σ (sub)col is computed from</span>

<span class="sd">                       the time series of that single experiment.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

        <span class="k">def</span> <span class="nf">align_subcols</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">subcols</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Subcolumns: align, justify, join.&quot;&quot;&quot;</span>

            <span class="c1"># Define subcol formats</span>

            <span class="n">subc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[</span><span class="n">statkey</span><span class="p">,</span> <span class="s1">&#39;1σ&#39;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;frmts&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; ±&#39;</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># last one gets appended below.</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;aligns&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">]</span>  <span class="c1"># 4 header -- matter gets decimal-aligned.</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>    <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;tuned_coord&quot;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">]]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;frmts&#39;</span><span class="p">]</span>   <span class="o">+=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39; *&#39;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;aligns&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&lt;&#39;</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">axes</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>    <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;nFail&quot;</span><span class="p">,</span> <span class="s2">&quot;nSuccess&quot;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;☠&#39;</span><span class="p">,</span> <span class="s1">&#39;✓&#39;</span><span class="p">]</span>  <span class="c1"># use width-1 symbols!</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;frmts&#39;</span><span class="p">]</span>   <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;aligns&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># no space after last subcol</span>

            <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subc</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">])</span>

            <span class="c1"># Transpose</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rows</span><span class="p">)]</span>

            <span class="c1"># Iterate over columns.</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">col_coord</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">columns</span><span class="p">)):</span>

                <span class="c1"># Tabulate columns</span>

                <span class="k">if</span> <span class="n">subcols</span><span class="p">:</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">unpack_uqs</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">subc</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">])</span>

                    <span class="c1"># Tabulate subcolumns</span>

                    <span class="n">subheaders</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">frmt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">align</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">subc</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>

                        <span class="n">column</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabulate_column</span><span class="p">(</span>

                            <span class="n">column</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">header</span><span class="p">,</span> <span class="n">frmt</span><span class="o">=</span><span class="n">frmt</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

                        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>

                            <span class="n">subheaders</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">subheaders</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>

                    <span class="c1"># Join subcolumns:</span>

                    <span class="n">matter</span> <span class="o">=</span> <span class="p">[</span>

                        <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">subc</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]])</span>

                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">column</span>

                    <span class="p">]</span>

                    <span class="n">header</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">subheaders</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">unpack_uqs</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">tabulate_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">statkey</span><span class="p">)</span>

                    <span class="n">header</span><span class="p">,</span> <span class="n">matter</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="k">if</span> <span class="n">h2</span><span class="p">:</span>  <span class="c1"># Do super_header</span>

                    <span class="k">if</span> <span class="n">j</span><span class="p">:</span>

                        <span class="n">super_header</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_coord</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">super_header</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">col_coord</span><span class="p">)</span>

                    <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>  <span class="c1"># += 1 if using unicode chars like ✔️</span>

                    <span class="n">super_header</span> <span class="o">=</span> <span class="n">super_header</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

                    <span class="n">header</span> <span class="o">=</span> <span class="n">super_header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">header</span>

                <span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span><span class="o">+</span><span class="n">matter</span>

            <span class="c1"># Un-transpose</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">)]</span>

            <span class="k">return</span> <span class="n">rows</span>

        <span class="c1"># Inform axes[&quot;mean&quot;]</span>

        <span class="k">if</span> <span class="n">axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Averages (in time and) over </span><span class="si">{</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Averages in time only&quot;</span>

                  <span class="s2">&quot; (=&gt; the 1σ estimates may be unreliable).&quot;</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_tree</span><span class="p">(</span><span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Get this table&#39;s column coords (cc). Use dict for sorted&amp;unique.</span>

            <span class="c1"># cc = xp_dict.ticks[axes[&quot;inner&quot;]] # May be larger than needed.</span>

            <span class="c1"># cc = table[0].keys()              # May be too small a set.</span>

            <span class="n">cc</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">row</span><span class="p">}</span>

            <span class="c1"># Convert table (rows) into rows (lists) of equal length</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cc</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

            <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># ****************** Simple (for debugging) table</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">row_coord</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">rows</span><span class="p">)):</span>

                    <span class="n">row_key</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row_coord</span><span class="p">)</span>

                    <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row_key</span><span class="p">]</span>         <span class="o">+</span> <span class="n">row</span>

                <span class="n">rows</span><span class="o">.</span><span class="kp">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cc</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># ********************** Elegant table.</span>

                <span class="n">h2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># do column-super-header</span>

                <span class="n">rows</span> <span class="o">=</span> <span class="n">align_subcols</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">subcols</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>

                <span class="c1"># Make and prepend left-side table</span>

                <span class="c1"># - It&#39;s prettier if row_keys don&#39;t have unnecessary cols.</span>

                <span class="c1">#   For example, the table of Climatology should not have an</span>

                <span class="c1">#   entire column repeatedly displaying &quot;infl=None&quot;.</span>

                <span class="c1">#   =&gt; split_attrs().</span>

                <span class="c1"># - Why didn&#39;t we do this for the column attrs?</span>

                <span class="c1">#   Coz there we have no ambition to split the attrs,</span>

                <span class="c1">#   which would also require excessive processing:</span>

                <span class="c1">#   nesting the table as cols, and then split_attrs() on cols.</span>

                <span class="n">row_keys</span> <span class="o">=</span> <span class="n">xpList</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">split_attrs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">row_keys</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>

                    <span class="n">row_keys</span><span class="p">,</span> <span class="kp">dtype</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>  <span class="c1"># allow storing None</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_keys</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>

                    <span class="c1"># Header</span>

                    <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h2</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">h2</span><span class="o">+</span><span class="s1">&#39;⑊&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Matter</span>

                    <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">row_keys</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>

                        <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span>

            <span class="c1"># Print</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s1">&#39;outer&#39;</span><span class="p">]:</span>

                <span class="n">table_title</span> <span class="o">=</span> <span class="s2">&quot;Table for &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">table_coord</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="n">table_title</span><span class="p">,</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Back</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">))</span>

            <span class="n">headers</span><span class="p">,</span> <span class="o">*</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;␣&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">AXES_ROLES</span><span class="p">,</span> <span class="n">get_style</span><span class="o">=</span><span class="n">default_styles</span><span class="p">,</span>

             <span class="n">fignum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">panels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

             <span class="n">title2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">costfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unique_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Plot the avrgs of ``statkey`` as a function of ``axis[&quot;inner&quot;]``.</span>

<span class="sd">        Firs of all, though, mean and optimum computations are done for</span>

<span class="sd">        ``axis[&quot;mean&quot;]`` and ``axis[&quot;optim&quot;]``.</span>

<span class="sd">        The optimal parameters are plotted in panels below the main plot.</span>

<span class="sd">        This can be prevented by providing the figure axes in ``panels``.</span>

<span class="sd">        Optionally, the experiments can be grouped by ``axis[&quot;outer&quot;]``,</span>

<span class="sd">        producing a figure with columns of panels.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">plot1</span><span class="p">(</span><span class="n">panelcol</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Plot a given line (row) in the main panel and the optim panels.</span>

<span class="sd">            Involves: Sort, insert None&#39;s, handle constant lines.&quot;&quot;&quot;</span>

            <span class="c1"># Make a full row (yy) of vals, whether is_constant or not.</span>

            <span class="c1"># row.is_constant = (len(row)==1 and next(iter(row))==row.Coord(None))</span>

            <span class="n">row</span><span class="o">.</span><span class="n">is_constant</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>

            <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">is_constant</span> <span class="k">else</span> <span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">get_for</span><span class="p">(</span><span class="n">xticks</span><span class="p">)]</span>

            <span class="c1"># Plot main</span>

            <span class="n">row</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">]</span>

            <span class="n">row</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">row</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="s2">&quot;main_panel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelcol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Plot tuning params</span>

            <span class="n">row</span><span class="o">.</span><span class="n">tuned_coords</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store ordered, &quot;transposed&quot; argmins</span>

            <span class="n">argmins</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;tuned_coord&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">],</span> <span class="n">panelcol</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

                <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">argmins</span><span class="p">]</span>

                <span class="n">row</span><span class="o">.</span><span class="n">tuned_coords</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span>

                <span class="c1"># Plotting all None&#39;s sets axes units (like any plotting call)</span>

                <span class="c1"># which can cause trouble if the axes units were actually supposed</span>

                <span class="c1"># to be categorical (eg upd_a), but this is only revealed later.</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">):</span>

                    <span class="n">row</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>

        <span class="c1"># Nest axes through table_tree()</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;You must chose the abscissa.&quot;</span>

        <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_tree</span><span class="p">(</span><span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="n">xticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickz</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Figure panels</span>

        <span class="k">if</span> <span class="n">panels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">nrows</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">ncols</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

            <span class="n">maxW</span>    <span class="o">=</span> <span class="mf">12.7</span>  <span class="c1"># my mac screen</span>

            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">ncols</span><span class="p">,</span> <span class="n">maxW</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>

            <span class="n">gs</span>      <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>

                <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>

                <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>

                <span class="c1"># eyeballed:</span>

                <span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="kp">log</span><span class="p">(</span><span class="n">ncols</span><span class="p">)),</span>

                <span class="n">right</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

            <span class="c1"># Create</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">panels</span> <span class="o">=</span> <span class="n">freshfig</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>

                                 <span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

                                 <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>

                                 <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gs</span><span class="p">)</span>

            <span class="n">panels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">ravel</span><span class="p">(</span><span class="n">panels</span><span class="p">)</span><span class="o">.</span><span class="kp">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">panels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">atleast_2d</span><span class="p">(</span><span class="n">panels</span><span class="p">)</span>

        <span class="c1"># Title</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">fig_title</span> <span class="o">=</span> <span class="s2">&quot;Average wrt. time&quot;</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">fig_title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">title2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">fig_title</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">title2</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">fig_title</span><span class="p">)</span>

        <span class="c1"># Loop outer</span>

        <span class="n">label_register</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># mv inside loop to get legend on each panel</span>

        <span class="k">for</span> <span class="n">table_panels</span><span class="p">,</span> <span class="p">(</span><span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">panels</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="n">table</span><span class="o">.</span><span class="n">panels</span> <span class="o">=</span> <span class="n">table_panels</span>

            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s2">&quot;outer&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">repr</span><span class="p">(</span><span class="n">table_coord</span><span class="p">)</span>

            <span class="c1"># Plot</span>

            <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">style</span> <span class="o">=</span> <span class="n">get_style</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

                <span class="c1"># Rm duplicate labels (contrary to coords, labels can</span>

                <span class="c1"># be &quot;tampered&quot; with, and so can be duplicate)</span>

                <span class="k">if</span> <span class="n">unique_labels</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">label_register</span><span class="p">:</span>

                        <span class="k">del</span> <span class="n">style</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">label_register</span><span class="o">.</span><span class="kp">add</span><span class="p">(</span><span class="n">style</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>

                <span class="n">plot1</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>

            <span class="c1"># Beautify</span>

            <span class="n">panel0</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">panel0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">panel0</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>

                <span class="n">panel0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">statkey</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">set_tmp</span><span class="p">(</span><span class="n">mpl_logger</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>  <span class="c1"># silence &quot;no label&quot; msg</span>

                <span class="n">panel0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Tuning panels:</span>

            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(),</span> <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

                <span class="k">if</span> <span class="n">panel</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>

                    <span class="n">panel</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optim.</span><span class="se">\n</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">xp_dict</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">axes_roles</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">return</span> <span class="n">tables</span>

<span class="k">def</span> <span class="nf">default_fig_adjustments</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Beautify. These settings do not generalize well.&quot;&quot;&quot;</span>

    <span class="c1"># Get axs as 2d-array</span>

    <span class="n">axs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">([</span><span class="n">table</span><span class="o">.</span><span class="n">panels</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Main panels (top row) only:</span>

    <span class="n">sensible_f</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]:</span>

        <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">nPanel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">axs</span><span class="o">.</span><span class="kp">shape</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">nPanel</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>

                <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ax.set_</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">scale(&#39;log&#39;)&quot;</span><span class="p">)</span>

                <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ax.</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">axis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">sensible_f</span><span class="p">)</span>

            <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ax.</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">axis&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">sensible_f</span><span class="p">)</span>

    <span class="c1"># Tuning panels only</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">axes_roles</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(),</span> <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

        <span class="n">yy</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">xp_dict</span><span class="o">.</span><span class="n">tickz</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">axis_scale_by_array</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>

        <span class="c1"># set_ymargin doesn&#39;t work for wonky scales. Do so manually:</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>

        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">panel</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="p">),</span> <span class="n">y3</span><span class="o">+</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y2</span><span class="p">))</span>

    <span class="c1"># All panels</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="kp">ravel</span><span class="p">():</span>

        <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">nPanel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">axs</span><span class="o">.</span><span class="kp">shape</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">nPanel</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>

    <span class="c1"># Not strictly compatible with gridspec height_ratios,</span>

    <span class="c1"># (throws warning), but still works ok.</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div>

</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><code><span class="n">AXES_ROLES</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">NO_KEY</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">mpl_logger</span>
</code></pre></div>

<h2 id="functions">Functions</h2>
<h3 id="cm_bond">cm_bond</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">cm_bond</span><span class="p">(</span>
    <span class="n">cmap</span><span class="p">,</span>
    <span class="n">xp_dict</span><span class="p">,</span>
    <span class="n">axis</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>

<p>Map cmap for coord.axis ∈ [0, len(ticks)].</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">cm_bond</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="w"> </span><span class="n">xp_dict</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">,</span><span class="w"> </span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Map cmap for coord.axis ∈ [0, len(ticks)].&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">link</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Essentially: cmap(ticks.index(coord.axis))&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xp_dict</span><span class="p">.</span><span class="n">ticks</span><span class="o">[</span><span class="n">axis</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">cNorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpl</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="k">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="w"> </span><span class="n">vmax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="n">ScMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cNorm</span><span class="p">,</span><span class="w"> </span><span class="n">cmap</span><span class="p">).</span><span class="n">to_rgba</span><span class="w"></span>

<span class="w">            </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ticks</span><span class="p">.</span><span class="k">index</span><span class="p">(</span><span class="n">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ScMap</span><span class="p">(</span><span class="k">index</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">link</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="default_fig_adjustments">default_fig_adjustments</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">default_fig_adjustments</span><span class="p">(</span>
    <span class="n">tables</span>
<span class="p">)</span>
</code></pre></div>

<p>Beautify. These settings do not generalize well.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">default_fig_adjustments</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;Beautify. These settings do not generalize well.&quot;&quot;&quot;</span>

    <span class="o">#</span> <span class="k">Get</span> <span class="n">axs</span> <span class="k">as</span> <span class="mi">2</span><span class="n">d</span><span class="o">-</span><span class="nb">array</span>

    <span class="n">axs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">array</span><span class="p">([</span><span class="k">table</span><span class="p">.</span><span class="n">panels</span> <span class="k">for</span> <span class="k">table</span> <span class="k">in</span> <span class="n">tables</span><span class="p">.</span><span class="k">values</span><span class="p">()]).</span><span class="n">T</span>

    <span class="o">#</span> <span class="n">Main</span> <span class="n">panels</span> <span class="p">(</span><span class="n">top</span> <span class="k">row</span><span class="p">)</span> <span class="k">only</span><span class="p">:</span>

    <span class="n">sensible_f</span> <span class="o">=</span> <span class="n">ticker</span><span class="p">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;%g&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="k">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]:</span>

        <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">nPanel</span> <span class="k">in</span> <span class="n">zip</span><span class="p">([</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">axs</span><span class="p">.</span><span class="n">shape</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">nPanel</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>

                <span class="n">eval</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;ax.set_{direction}scale(&#39;log&#39;)&quot;</span><span class="p">)</span>

                <span class="n">eval</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;ax.{direction}axis&quot;</span><span class="p">).</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">sensible_f</span><span class="p">)</span>

            <span class="n">eval</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;ax.{direction}axis&quot;</span><span class="p">).</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">sensible_f</span><span class="p">)</span>

    <span class="o">#</span> <span class="n">Tuning</span> <span class="n">panels</span> <span class="k">only</span>

    <span class="k">table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">tables</span><span class="p">.</span><span class="n">axes_roles</span><span class="p">[</span><span class="ss">&quot;optim&quot;</span><span class="p">]</span> <span class="k">or</span> <span class="p">(),</span> <span class="k">table</span><span class="p">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

        <span class="n">yy</span> <span class="o">=</span> <span class="n">tables</span><span class="p">.</span><span class="n">xp_dict</span><span class="p">.</span><span class="n">tickz</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">axis_scale_by_array</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="ss">&quot;y&quot;</span><span class="p">)</span>

        <span class="o">#</span> <span class="n">set_ymargin</span> <span class="n">doesn</span><span class="s1">&#39;t work for wonky scales. Do so manually:</span>

<span class="s1">        alpha = len(yy)/10</span>

<span class="s1">        y0, y1, y2, y3 = yy[0], yy[1], yy[-2], yy[-1]</span>

<span class="s1">        panel.set_ylim(y0-alpha*(y1-y0), y3+alpha*(y3-y2))</span>

<span class="s1">    # All panels</span>

<span class="s1">    for ax in axs.ravel():</span>

<span class="s1">        for direction, nPanel in zip([&#39;</span><span class="n">y</span><span class="s1">&#39;, &#39;</span><span class="n">x</span><span class="err">&#39;</span><span class="p">],</span> <span class="n">axs</span><span class="p">.</span><span class="n">shape</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">nPanel</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>

                <span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="k">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="ss">&quot;minor&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>

    <span class="o">#</span> <span class="k">Not</span> <span class="n">strictly</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">gridspec</span> <span class="n">height_ratios</span><span class="p">,</span>

    <span class="o">#</span> <span class="p">(</span><span class="n">throws</span> <span class="n">warning</span><span class="p">),</span> <span class="n">but</span> <span class="n">still</span> <span class="n">works</span> <span class="n">ok</span><span class="p">.</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="p">.</span><span class="n">catch_warnings</span><span class="p">():</span>

        <span class="n">warnings</span><span class="p">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="ss">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">UserWarning</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="n">figure</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div>

</details>
<h3 id="default_styles">default_styles</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">default_styles</span><span class="p">(</span>
    <span class="n">coord</span><span class="p">,</span>
    <span class="n">baseline_legends</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>Quick and dirty (but somewhat robust) styling.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">default_styles</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">baseline_legends</span><span class="o">=</span><span class="n">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Quick and dirty (but somewhat robust) styling.&quot;&quot;&quot;</span>

    <span class="n">style</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">DotDict</span><span class="p">(</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">make_label</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

    <span class="n">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;Climatology&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;OptInterp&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Opt. Interp.&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;Var3D&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;3D-Var&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">baseline_legends</span><span class="p">:</span>

                <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">None</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;EnKF&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span>

        <span class="k">elif</span> <span class="n">coord</span><span class="o">.</span><span class="n">da_method</span> <span class="o">==</span> <span class="s2">&quot;PartFilt&quot;</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>

            <span class="n">style</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;C2&quot;</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">style</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="n">except</span> <span class="n">AttributeError</span><span class="p">:</span>

        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">style</span>
</code></pre></div>

</details>
<h3 id="discretize_cmap">discretize_cmap</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">discretize_cmap</span><span class="p">(</span>
    <span class="n">cmap</span><span class="p">,</span>
    <span class="n">N</span><span class="p">,</span>
    <span class="n">val0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">val1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Discretize cmap so that it partitions [0,1] into N segments.</p>
<p>I.e. cmap(k/N) == cmap(k/N + eps).</p>
<p>Also provide the ScalarMappable <code>sm</code>
that maps range(N) to the segment centers,
as will be reflected by <code>cb = fig.colorbar(sm)</code>.
You can then re-label the ticks using
<code>cb.set_ticks(np.arange(N)); cb.set_ticklabels(["A","B","C",...])</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">discretize_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">val0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="k">name</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="o">:</span>

    <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Discretize cmap so that it partitions [0,1] into N segments.</span>

<span class="s2">    I.e. cmap(k/N) == cmap(k/N + eps).</span>

<span class="s2">    Also provide the ScalarMappable ``sm``</span>

<span class="s2">    that maps range(N) to the segment centers,</span>

<span class="s2">    as will be reflected by ``cb = fig.colorbar(sm)``.</span>

<span class="s2">    You can then re-label the ticks using</span>

<span class="s2">    ``cb.set_ticks(np.arange(N)); cb.set_ticklabels([&quot;</span><span class="n">A</span><span class="s2">&quot;,&quot;</span><span class="n">B</span><span class="s2">&quot;,&quot;</span><span class="n">C</span><span class="s2">&quot;,...])``.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

    <span class="c1"># cmap(k/N)</span>

    <span class="n">from_list</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">LinearSegmentedColormap</span><span class="p">.</span><span class="n">from_list</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">val0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">from_list</span><span class="p">(</span><span class="k">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># sm</span>

    <span class="n">cNorm</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">.5</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">sm</span>
</code></pre></div>

</details>
<h3 id="in_idx">in_idx</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">in_idx</span><span class="p">(</span>
    <span class="n">coord</span><span class="p">,</span>
    <span class="n">indices</span><span class="p">,</span>
    <span class="n">xp_dict</span><span class="p">,</span>
    <span class="n">axis</span>
<span class="p">)</span>
</code></pre></div>

<p>Essentially: coord.axis in ticks[indices]</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">in_idx</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="n">xp_dict</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Essentially: coord.axis in ticks[indices]&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">xp_dict</span><span class="p">.</span><span class="n">ticks</span><span class="o">[</span><span class="n">axis</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="n">indices</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">ticks</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">True</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="load_hmm">load_HMM</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">load_HMM</span><span class="p">(</span>
    <span class="n">save_as</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">load_HMM</span><span class="p">(</span><span class="n">save_as</span><span class="p">):</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">HMM</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">open</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))[</span><span class="s2">&quot;HMM&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HMM</span>
</code></pre></div>

</details>
<h3 id="load_xps">load_xps</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">load_xps</span><span class="p">(</span>
    <span class="n">save_as</span>
<span class="p">)</span>
</code></pre></div>

<p>Load <code>xps</code> (as a simple list) from dir.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">load_xps</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">:</span>

    <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Load ``xps`` (as a simple list) from dir.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="k">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">).</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">files</span> <span class="o">=</span> <span class="err">[</span><span class="n">d</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="k">in</span> <span class="n">uplink</span><span class="p">.</span><span class="n">list_job_dirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="err">]</span>

    <span class="n">def</span> <span class="n">load_any</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Load any/all ``xp&#39;s`` from ``filepath``.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="k">with</span> <span class="k">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="o">:</span>

            <span class="c1"># If experiment crashed, then xp will be empty</span>

            <span class="n">try</span><span class="o">:</span>

                <span class="k">data</span> <span class="o">=</span> <span class="n">dill</span><span class="p">.</span><span class="k">load</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">EOFError</span><span class="o">:</span>

                <span class="k">return</span> <span class="err">[]</span>

            <span class="c1"># Always return list</span>

            <span class="n">try</span><span class="o">:</span>

                <span class="k">return</span> <span class="k">data</span><span class="err">[</span><span class="s2">&quot;xps&quot;</span><span class="err">]</span>

            <span class="k">except</span> <span class="n">KeyError</span><span class="o">:</span>

                <span class="k">return</span> <span class="err">[</span><span class="k">data</span><span class="err">[</span><span class="s2">&quot;xp&quot;</span><span class="err">]]</span>

    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;Loading %d files from %s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">save_as</span><span class="p">))</span>

    <span class="n">xps</span> <span class="o">=</span> <span class="err">[]</span>  <span class="c1"># NB: progbar wont clean up properly w/ list compr.</span>

    <span class="k">for</span> <span class="n">f</span> <span class="k">in</span> <span class="n">utils</span><span class="p">.</span><span class="n">progbar</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="k">desc</span><span class="o">=</span><span class="s2">&quot;Loading&quot;</span><span class="p">)</span><span class="o">:</span>

        <span class="n">xps</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">load_any</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">xps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">:</span>

        <span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{len(files)-len(xps)} files could not be loaded.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xps</span>
</code></pre></div>

</details>
<h3 id="make_label">make_label</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">make_label</span><span class="p">(</span>
    <span class="n">coord</span><span class="p">,</span>
    <span class="n">no_key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;da_method&#39;</span><span class="p">,</span> <span class="s1">&#39;Const&#39;</span><span class="p">,</span> <span class="s1">&#39;upd_a&#39;</span><span class="p">),</span>
    <span class="n">exclude</span><span class="o">=</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">make_label</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">no_key</span><span class="o">=</span><span class="n">NO_KEY</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">()):</span>

    <span class="n">dct</span> <span class="o">=</span> <span class="err">{</span><span class="n">a</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">coord</span><span class="p">.</span><span class="n">_asdict</span><span class="p">().</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="k">None</span><span class="err">}</span>

    <span class="n">lbl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">dct</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>

        <span class="k">if</span> <span class="n">k</span> <span class="k">not</span> <span class="k">in</span> <span class="n">exclude</span><span class="p">:</span>

            <span class="k">if</span> <span class="k">any</span><span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">no_key</span><span class="p">):</span>

                <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39; {v}&#39;</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39; {utils.collapse_str(k,7)}:{v}&#39;</span>

    <span class="k">return</span> <span class="n">lbl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div>

</details>
<h3 id="overwrite_xps">overwrite_xps</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">overwrite_xps</span><span class="p">(</span>
    <span class="n">xps</span><span class="p">,</span>
    <span class="n">save_as</span><span class="p">,</span>
    <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</code></pre></div>

<p>Save xps in save_as, but safely (by first saving to tmp).</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">overwrite_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;Save xps in save_as, but safely (by first saving to tmp).&quot;&quot;&quot;</span>

    <span class="n">save_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="o">/</span><span class="ss">&quot;tmp&quot;</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>

    <span class="o">#</span> <span class="k">Delete</span>

    <span class="k">for</span> <span class="n">d</span> <span class="k">in</span> <span class="n">utils</span><span class="p">.</span><span class="n">tqdm</span><span class="p">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">uplink</span><span class="p">.</span><span class="n">list_job_dirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">),</span>

                             <span class="k">desc</span><span class="o">=</span><span class="ss">&quot;Deleting old&quot;</span><span class="p">):</span>

        <span class="n">shutil</span><span class="p">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="o">#</span> <span class="n">Mv</span> <span class="n">up</span> <span class="k">from</span> <span class="n">tmp</span><span class="o">/</span> <span class="c1">-- goes quick, coz there are not many.</span>

    <span class="k">for</span> <span class="n">d</span> <span class="k">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="ss">&quot;tmp&quot;</span><span class="p">):</span>

        <span class="n">shutil</span><span class="p">.</span><span class="k">move</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="ss">&quot;tmp&quot;</span><span class="o">/</span><span class="n">d</span><span class="p">,</span> <span class="n">save_as</span><span class="o">/</span><span class="n">d</span><span class="p">)</span>

    <span class="n">shutil</span><span class="p">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="ss">&quot;tmp&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="reduce_inodes">reduce_inodes</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_inodes</span><span class="p">(</span>
    <span class="n">save_as</span><span class="p">,</span>
    <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</code></pre></div>

<p>Reduce the number of <code>xp</code> dirs</p>
<p>by packing multiple <code>xp</code>s into lists (<code>xps</code>).</p>
<p>This reduces the <strong>number</strong> of files (inodes) on the system,
which limits storage capacity (along with <strong>size</strong>).</p>
<p>It also deletes files "xp.var" and "out"
(which tends to be relatively large coz of the progbar).
This is probably also the reason that the loading time is sometimes reduced.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">reduce_inodes</span><span class="p">(</span><span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Reduce the number of ``xp`` dirs</span>

<span class="sd">    by packing multiple ``xp``s into lists (``xps``).</span>

<span class="sd">    This reduces the **number** of files (inodes) on the system,</span>

<span class="sd">    which limits storage capacity (along with **size**).</span>

<span class="sd">    It also deletes files &quot;xp.var&quot; and &quot;out&quot;</span>

<span class="sd">    (which tends to be relatively large coz of the progbar).</span>

<span class="sd">    This is probably also the reason that the loading time is sometimes reduced.&quot;&quot;&quot;</span>

    <span class="n">overwrite_xps</span><span class="p">(</span><span class="n">load_xps</span><span class="p">(</span><span class="n">save_as</span><span class="p">),</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="rel_index">rel_index</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rel_index</span><span class="p">(</span>
    <span class="n">elem</span><span class="p">,</span>
    <span class="n">lst</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p><code>lst.index(elem) / len(lst)</code> with fallback.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">rel_index</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="k">default</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;``lst.index(elem) / len(lst)`` with fallback.&quot;&quot;&quot;</span>

    <span class="n">try</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">lst</span><span class="p">.</span><span class="k">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">/</span> <span class="n">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">ValueError</span><span class="p">:</span>

        <span class="k">if</span> <span class="k">default</span> <span class="o">==</span> <span class="k">None</span><span class="p">:</span>

            <span class="n">raise</span>

        <span class="k">return</span> <span class="k">default</span>
</code></pre></div>

</details>
<h3 id="save_xps">save_xps</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">save_xps</span><span class="p">(</span>
    <span class="n">xps</span><span class="p">,</span>
    <span class="n">save_as</span><span class="p">,</span>
    <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</code></pre></div>

<p>Split xps and save in save_as/i for i in range(nDir).</p>
<p>Example: rename attr n_iter to nIter:</p>
<blockquote>
<blockquote>
<blockquote>
<p>proj_name = "Stein"
dd = dpr.rc.dirs.data / proj_name
save_as = dd / "run_2020-09-22__19:36:13"</p>
<p>for save_as in os.listdir(dd):
    save_as = dd / save_as</p>
<div class="codehilite"><pre><span></span><code><span class="n">xps</span> <span class="o">=</span> <span class="n">load_xps</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>
<span class="n">HMM</span> <span class="o">=</span> <span class="n">load_HMM</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

<span class="k">for</span> <span class="n">xp</span> <span class="ow">in</span> <span class="n">xps</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">hasattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="s2">&quot;n_iter&quot;</span><span class="p">):</span>
        <span class="n">xp</span><span class="o">.</span><span class="n">nIter</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">n_iter</span>
        <span class="n">del</span> <span class="n">xp</span><span class="o">.</span><span class="n">n_iter</span>

<span class="n">overwrite_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="p">)</span>
</code></pre></div>

</blockquote>
</blockquote>
</blockquote>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">save_xps</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">save_as</span><span class="p">,</span> <span class="n">nDir</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Split xps and save in save_as/i for i in range(nDir).</span>

<span class="sd">    Example: rename attr n_iter to nIter:</span>

<span class="sd">    &gt;&gt;&gt; proj_name = &quot;Stein&quot;</span>

<span class="sd">    &gt;&gt;&gt; dd = dpr.rc.dirs.data / proj_name</span>

<span class="sd">    &gt;&gt;&gt; save_as = dd / &quot;run_2020-09-22__19:36:13&quot;</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt; for save_as in os.listdir(dd):</span>

<span class="sd">    &gt;&gt;&gt;     save_as = dd / save_as</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     xps = load_xps(save_as)</span>

<span class="sd">    &gt;&gt;&gt;     HMM = load_HMM(save_as)</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     for xp in xps:</span>

<span class="sd">    &gt;&gt;&gt;         if hasattr(xp,&quot;n_iter&quot;):</span>

<span class="sd">    &gt;&gt;&gt;             xp.nIter = xp.n_iter</span>

<span class="sd">    &gt;&gt;&gt;             del xp.n_iter</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     overwrite_xps(xps, save_as)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">save_as</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">save_as</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>

    <span class="n">splitting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span> <span class="n">nDir</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sub_xps</span> <span class="ow">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">splitting</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Saving&quot;</span><span class="p">)):</span>

        <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">sub_xps</span><span class="p">):</span>

            <span class="n">iDir</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">iDir</span><span class="p">)</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">iDir</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>

                <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s1">&#39;xps&#39;</span><span class="p">:</span> <span class="n">sub_xps</span><span class="p">},</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="sparsespace">SparseSpace</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SparseSpace</span><span class="p">(</span>
    <span class="n">axes</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Dict, subclassed enforce key conformity (to a coord. sys, i.e. a space).</p>
<p>The coordinate system is specified by its "axes",
which is used to produce self.Coord (a namedtuple class).</p>
<p>As a normal dict, it can hold any type of objects.</p>
<p>In normal use, this space is highly sparse,
coz there are many coordinates with no matching experiment,
eg. coord(da_method=Climatology, rot=True, ...).</p>
<p>Indeed, operations across (potentially multiple simultaneous) axes,
such as optimization or averaging, should be carried out by iterating
-- not over the axis -- but over the the list of items.</p>
<p>The most important method is <code>nest()</code>,
which is used (by xpSpace.table_tree) to separate tables/columns,
and also to carry out the mean/optim operations.</p>
<p>In addition, <strong>getitem</strong>() is very flexible, allowing accessing by:
- The actual key, a self.Coord object. Returns single item.
- A dict match against (part of) the coordinates. Returns subspace.
- An int. Returns list(self)[key].
- A list of any of the above. Returns list.
This flexibility can cause bugs, but it's probably still worth it).
Also see <strong>call</strong>(), get_for(), and coords(), for further convenience.</p>
<p>Inspired by https://stackoverflow.com/a/7728830
Also see https://stackoverflow.com/q/3387691 </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">SparseSpace</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Dict, subclassed enforce key conformity (to a coord. sys, i.e. a space).</span>

<span class="ss">    The coordinate system is specified by its &quot;</span><span class="n">axes</span><span class="ss">&quot;,</span>

<span class="ss">    which is used to produce self.Coord (a namedtuple class).</span>

<span class="ss">    As a normal dict, it can hold any type of objects.</span>

<span class="ss">    In normal use, this space is highly sparse,</span>

<span class="ss">    coz there are many coordinates with no matching experiment,</span>

<span class="ss">    eg. coord(da_method=Climatology, rot=True, ...).</span>

<span class="ss">    Indeed, operations across (potentially multiple simultaneous) axes,</span>

<span class="ss">    such as optimization or averaging, should be carried out by iterating</span>

<span class="ss">    -- not over the axis -- but over the the list of items.</span>

<span class="ss">    The most important method is ``nest()``,</span>

<span class="ss">    which is used (by xpSpace.table_tree) to separate tables/columns,</span>

<span class="ss">    and also to carry out the mean/optim operations.</span>

<span class="ss">    In addition, __getitem__() is very flexible, allowing accessing by:</span>

<span class="ss">    - The actual key, a self.Coord object. Returns single item.</span>

<span class="ss">    - A dict match against (part of) the coordinates. Returns subspace.</span>

<span class="ss">    - An int. Returns list(self)[key].</span>

<span class="ss">    - A list of any of the above. Returns list.</span>

<span class="ss">    This flexibility can cause bugs, but it&#39;s probably still worth it).</span>

<span class="ss">    Also see __call__(), get_for(), and coords(), for further convenience.</span>

<span class="ss">    Inspired by https://stackoverflow.com/a/7728830</span>

<span class="ss">    Also see https://stackoverflow.com/q/3387691 &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="nv">@property</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">axes</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">.</span><span class="n">_fields</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">coordinate</span><span class="w"> </span><span class="k">system</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collections</span><span class="p">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Coord&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Write</span><span class="w"> </span><span class="n">dict</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">repr</span><span class="o">/</span><span class="nf">str</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">.</span><span class="n">__repr__</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">c</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;,&quot;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="ss">&quot;{k}={v!r}&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">zip</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">_fields</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">.</span><span class="n">__str__</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">c</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;,&quot;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Update using custom __setitem__().&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2588648</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2390997</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">).</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__setitem__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Setitem ensuring coordinate conforms.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">*</span><span class="k">key</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">TypeError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">TypeError</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="n">f</span><span class="ss">&quot;The key {key!r} did not fit the coord. system &quot;</span><span class="w"></span>

<span class="w">                </span><span class="n">f</span><span class="ss">&quot;which has axes {self.axes}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">super</span><span class="p">().</span><span class="n">__setitem__</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__getitem__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Flexible indexing.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">indices</span><span class="p">).</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Also</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">get_for</span><span class="p">().</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">self[k</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">key</span><span class="err">]</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="k">integer</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="n">Slice</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="n">validating</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">int64</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">catches</span><span class="w"> </span><span class="n">quite</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">bugs</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">slice</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">*self.values()</span><span class="o">][</span><span class="n">key</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Subspace</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="n">dict</span><span class="p">,</span><span class="w"> </span><span class="n">ie</span><span class="p">.</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">informal</span><span class="p">,</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="n">coordinate</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">nest</span><span class="p">(</span><span class="n">outer_axes</span><span class="o">=</span><span class="n">list</span><span class="p">(</span><span class="k">key</span><span class="p">))</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">nest</span><span class="w"></span>

<span class="w">            </span><span class="n">coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">outer</span><span class="p">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">*</span><span class="k">key</span><span class="p">.</span><span class="k">values</span><span class="p">())</span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">coord</span><span class="w"></span>

<span class="w">            </span><span class="k">inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">outer</span><span class="o">[</span><span class="n">coord</span><span class="o">]</span><span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">chose</span><span class="w"> </span><span class="n">subspace</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">inner</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="n">Coord</span><span class="w"> </span><span class="k">object</span><span class="p">,</span><span class="w"> </span><span class="n">coz</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">integer</span><span class="w"> </span><span class="p">(</span><span class="n">eg</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">interpreted</span><span class="w"> </span><span class="p">(</span><span class="n">above</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">index</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nl">NB</span><span class="p">:</span><span class="w"> </span><span class="n">Dont</span><span class="s1">&#39;t use isinstance(key, self.Coord)</span>

<span class="s1">            # coz it fails when the namedtuple (Coord) has been</span>

<span class="s1">            # instantiated in different places (but with equal params).</span>

<span class="s1">            # Also see bugs.python.org/issue7796</span>

<span class="s1">            return super().__getitem__(key)</span>

<span class="s1">    def __getkey__(self, entry):</span>

<span class="s1">        &quot;&quot;&quot;Inverse of dict.__getitem__(), but also works on coords.</span>

<span class="s1">        Note: This dunder method is not a &quot;builtin&quot; naming convention.&quot;&quot;&quot;</span>

<span class="s1">        coord = (getattr(entry, a, None) for a in self.axes)</span>

<span class="s1">        return self.Coord(*coord)</span>

<span class="s1">    def __call__(self, **kwargs):</span>

<span class="s1">        &quot;&quot;&quot;Convenience, that enables, eg.:</span>

<span class="s1">        &gt;&gt;&gt; xp_dict(da_method=&quot;EnKF&quot;, infl=1, seed=3)</span>

<span class="s1">        &quot;&quot;&quot;</span>

<span class="s1">        return self.__getitem__(kwargs)</span>

<span class="s1">    def get_for(self, ticks, default=None):</span>

<span class="s1">        &quot;&quot;&quot;Almost ``[self.get(Coord(x)) for x in ticks]``.</span>

<span class="s1">        NB: using the &quot;naive&quot; thing: ``[self[x] for x in ticks]``</span>

<span class="s1">        would probably be a BUG coz x gets interpreted as indices</span>

<span class="s1">        for the internal list.&quot;&quot;&quot;</span>

<span class="s1">        singleton = not hasattr(ticks[0], &quot;__iter__&quot;)</span>

<span class="s1">        def coord(xyz): return self.Coord(xyz if singleton else xyz)</span>

<span class="s1">        return [self.get(coord(x), default) for x in ticks]</span>

<span class="s1">    def coords(self, **kwargs):</span>

<span class="s1">        &quot;&quot;&quot;Get all ``coord``s matching kwargs.</span>

<span class="s1">        Unlike ``__getitem__(kwargs)``,</span>

<span class="s1">        - A list is returned, not a subspace.</span>

<span class="s1">        - This list constains keys (coords), not values.</span>

<span class="s1">        - The coords refer to the original space, not the subspace.</span>

<span class="s1">        The last point is especially useful for label_xSection().</span>

<span class="s1">        &quot;&quot;&quot;</span>

<span class="s1">        def embed(coord): return {**kwargs, **coord._asdict()}</span>

<span class="s1">        return [self.Coord(**embed(x)) for x in self[kwargs]]</span>

<span class="s1">        # Old implementation.</span>

<span class="s1">        # - I prefer the new version for its re-use of __getitem__&#39;</span><span class="n">s</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">   </span><span class="n">nesting</span><span class="p">,</span><span class="w"> </span><span class="n">evidencing</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">mutual</span><span class="w"> </span><span class="n">relationship</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">unlike</span><span class="w"> </span><span class="n">xpList</span><span class="p">.</span><span class="n">inds</span><span class="p">()</span><span class="err">:</span><span class="w"> </span><span class="n">missingval</span><span class="w"> </span><span class="n">shenanigans</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">   </span><span class="k">are</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">unnecessary</span><span class="w"> </span><span class="n">coz</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">coordinate</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">complete</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">match</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="ow">all</span><span class="p">(</span><span class="n">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">kwargs</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">x for x in self if match(x)</span><span class="o">]</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="k">print</span><span class="p">(</span><span class="n">xpList</span><span class="p">(</span><span class="n">self</span><span class="p">))</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">human</span><span class="o">-</span><span class="n">readable</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">listing</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t want to implement it here, coz it requires split_attrs(),</span>

<span class="s1">        # which we don&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">again</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">str(k) for k in self</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">:L</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;...&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">-L:</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;[\n  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ss">&quot;,\n  &quot;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ss">&quot;\n]&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">txt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;&lt;{self.__class__.__name__}&gt; with {len(self)} keys: {keys}&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">txt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot; befitting the coord. sys. with axes &quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">txt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;\nplaced in a coord-sys with axes &quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">txt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;(and ticks):&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">dict_tools</span><span class="p">.</span><span class="n">AlignedDict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">ticks</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">AttributeError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">txt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="ss">&quot;:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">txt</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">nest</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">inner_axes</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">outer_axes</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Return a new xpSpace with axes ``outer_axes``,</span>

<span class="ss">        obtained by projecting along the ``inner_axes``.</span>

<span class="ss">        The entries of this ``xpSpace`` are themselves ``xpSpace``s,</span>

<span class="ss">        with axes ``inner_axes``,</span>

<span class="ss">        each one regrouping the entries with the same (projected) coordinate.</span>

<span class="ss">        Note: is also called by ``__getitem__(key)`` if ``key`` is dict.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Default</span><span class="err">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">singleton</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="nf">space</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">everything</span><span class="w"> </span><span class="n">contained</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="p">(</span><span class="n">projection</span><span class="p">)</span><span class="w"> </span><span class="nf">space</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">inner_axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">outer_axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">outer_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Validate</span><span class="w"> </span><span class="n">axes</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">inner_axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">            </span><span class="n">inner_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span><span class="w"> </span><span class="n">outer_axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">            </span><span class="n">outer_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span><span class="w"> </span><span class="n">inner_axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Fill</span><span class="w"> </span><span class="n">spaces</span><span class="w"></span>

<span class="w">        </span><span class="n">outer_space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">outer_axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">outer_coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outer_space</span><span class="p">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">inner_space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outer_space</span><span class="o">[</span><span class="n">outer_coord</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">inner_space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">inner_axes</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">outer_space</span><span class="o">[</span><span class="n">outer_coord</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inner_space</span><span class="w"></span>

<span class="w">            </span><span class="n">inner_space</span><span class="o">[</span><span class="n">inner_space.__getkey__(coord)</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">outer_space</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_axis</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="o">+</span><span class="p">(</span><span class="n">axis</span><span class="p">,))</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">coord</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="o">[</span><span class="n">coord + (None,)</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Rm those a in attrs that are not in self.axes.</span>

<span class="ss">        This allows errors in the axes allotment, for ease-of-use.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">absent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">absent</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="ss">&quot;Warning:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colorama</span><span class="p">.</span><span class="n">Fore</span><span class="p">.</span><span class="n">RED</span><span class="p">),</span><span class="w"></span>

<span class="w">                  </span><span class="ss">&quot;The requested attributes&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">                  </span><span class="n">color_text</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">absent</span><span class="p">),</span><span class="w"> </span><span class="n">colorama</span><span class="p">.</span><span class="n">Fore</span><span class="p">.</span><span class="n">RED</span><span class="p">),</span><span class="w"></span>

<span class="w">                  </span><span class="p">(</span><span class="ss">&quot;were not found among the&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; xpSpace axes (attrs. used as coordinates&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; for the set of experiments).&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; This may be no problem if the attr. is redundant&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; for the coord-sys.&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; However, if it is caused by confusion or mis-spelling,&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; then it is likely to cause mis-interpretation&quot;</span><span class="w"></span>

<span class="w">                   </span><span class="ss">&quot; of the shown results.&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">absent</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">attrs</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">label_xSection</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">sub_coord</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Insert duplicate entries for the cross section</span>

<span class="ss">        whose ``coord``s match ``sub_coord``,</span>

<span class="ss">        adding the attr ``Const=label`` to their ``coord``,</span>

<span class="ss">        reflecting the &quot;</span><span class="n">constance</span><span class="o">/</span><span class="k">constraint</span><span class="o">/</span><span class="n">fixation</span><span class="ss">&quot; this represents.</span>

<span class="ss">        This distinguishes the entries in this fixed-affine subspace,</span>

<span class="ss">        preventing them from being gobbled up in ``nest()``.</span>

<span class="ss">        If you wish, you can specify the ``NoneAttrs``,</span>

<span class="ss">        which are consequently set to None for the duplicated entries,</span>

<span class="ss">        preventing them from getting plotted in tuning panels.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;Const&quot;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">axes</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">add_axis</span><span class="p">(</span><span class="s1">&#39;Const&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">coord</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">coords</span><span class="p">(</span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">sub_coord</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">self</span><span class="o">[</span><span class="n">coord</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">Const</span><span class="o">=</span><span class="n">label</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="err">{</span><span class="nl">a</span><span class="p">:</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">NoneAttrs</span><span class="err">}</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="o">[</span><span class="n">coord</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>builtins.dict</li>
</ul>
<h4 id="descendants">Descendants</h4>
<ul>
<li>dapper.data_management.xpSpace</li>
</ul>
<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">axes</span>
</code></pre></div>

<h4 id="methods">Methods</h4>
<h5 id="add_axis">add_axis</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">add_axis</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axis</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">add_axis</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

        <span class="k">self</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">axes</span><span class="o">+</span><span class="p">(</span><span class="n">axis</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="k">in</span> <span class="n">list</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="k">self</span><span class="p">[</span><span class="n">coord</span> <span class="o">+</span> <span class="p">(</span><span class="k">None</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">entry</span>
</code></pre></div>

</details>
<h5 id="clear">clear</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.clear() -&gt; None.  Remove all items from D.</p>
<h5 id="coords">coords</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">coords</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Get all <code>coord</code>s matching kwargs.</p>
<p>Unlike <code>__getitem__(kwargs)</code>,
- A list is returned, not a subspace.
- This list constains keys (coords), not values.
- The coords refer to the original space, not the subspace.</p>
<p>The last point is especially useful for label_xSection().</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get all ``coord``s matching kwargs.</span>

<span class="sd">        Unlike ``__getitem__(kwargs)``,</span>

<span class="sd">        - A list is returned, not a subspace.</span>

<span class="sd">        - This list constains keys (coords), not values.</span>

<span class="sd">        - The coords refer to the original space, not the subspace.</span>

<span class="sd">        The last point is especially useful for label_xSection().</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="n">embed</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span> <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">coord</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()}</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">**</span><span class="n">embed</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">kwargs</span><span class="p">]]</span>
</code></pre></div>

</details>
<h5 id="copy">copy</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.copy() -&gt; a shallow copy of D</p>
<h5 id="fromkeys">fromkeys</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span>
    <span class="n">iterable</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Create a new dictionary with keys from iterable and values set to value.</p>
<h5 id="get">get</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Return the value for key if key is in the dictionary, else default.</p>
<h5 id="get_for">get_for</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_for</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ticks</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Almost <code>[self.get(Coord(x)) for x in ticks]</code>.</p>
<p>NB: using the "naive" thing: <code>[self[x] for x in ticks]</code>
would probably be a BUG coz x gets interpreted as indices
for the internal list.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_for</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">ticks</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Almost ``[self.get(Coord(x)) for x in ticks]``.</span>

<span class="ss">        NB: using the &quot;</span><span class="n">naive</span><span class="ss">&quot; thing: ``[self[x] for x in ticks]``</span>

<span class="ss">        would probably be a BUG coz x gets interpreted as indices</span>

<span class="ss">        for the internal list.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">singleton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">ticks</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;__iter__&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">coord</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">xyz</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">singleton</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">xyz</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">self.get(coord(x), default) for x in ticks</span><span class="o">]</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="intersect_axes">intersect_axes</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">intersect_axes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">attrs</span>
<span class="p">)</span>
</code></pre></div>

<p>Rm those a in attrs that are not in self.axes.</p>
<p>This allows errors in the axes allotment, for ease-of-use.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">intersect_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Rm those a in attrs that are not in self.axes.</span>

<span class="sd">        This allows errors in the axes allotment, for ease-of-use.&quot;&quot;&quot;</span>

        <span class="n">absent</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">absent</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="s2">&quot;Warning:&quot;</span><span class="p">,</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="s2">&quot;The requested attributes&quot;</span><span class="p">,</span>

                  <span class="n">color_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">absent</span><span class="p">),</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="p">(</span><span class="s2">&quot;were not found among the&quot;</span>

                   <span class="s2">&quot; xpSpace axes (attrs. used as coordinates&quot;</span>

                   <span class="s2">&quot; for the set of experiments).&quot;</span>

                   <span class="s2">&quot; This may be no problem if the attr. is redundant&quot;</span>

                   <span class="s2">&quot; for the coord-sys.&quot;</span>

                   <span class="s2">&quot; However, if it is caused by confusion or mis-spelling,&quot;</span>

                   <span class="s2">&quot; then it is likely to cause mis-interpretation&quot;</span>

                   <span class="s2">&quot; of the shown results.&quot;</span><span class="p">))</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">absent</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attrs</span>
</code></pre></div>

</details>
<h5 id="items">items</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.items() -&gt; a set-like object providing a view on D's items</p>
<h5 id="keys">keys</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">keys</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.keys() -&gt; a set-like object providing a view on D's keys</p>
<h5 id="label_xsection">label_xSection</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">label_xSection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">label</span><span class="p">,</span>
    <span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span>
    <span class="o">**</span><span class="n">sub_coord</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert duplicate entries for the cross section</p>
<p>whose <code>coord</code>s match <code>sub_coord</code>,
adding the attr <code>Const=label</code> to their <code>coord</code>,
reflecting the "constance/constraint/fixation" this represents.</p>
<p>This distinguishes the entries in this fixed-affine subspace,
preventing them from being gobbled up in <code>nest()</code>.</p>
<p>If you wish, you can specify the <code>NoneAttrs</code>,
which are consequently set to None for the duplicated entries,
preventing them from getting plotted in tuning panels.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">label_xSection</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span> <span class="o">**</span><span class="n">sub_coord</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Insert duplicate entries for the cross section</span>

<span class="s2">        whose ``coord``s match ``sub_coord``,</span>

<span class="s2">        adding the attr ``Const=label`` to their ``coord``,</span>

<span class="s2">        reflecting the &quot;</span><span class="n">constance</span><span class="o">/</span><span class="k">constraint</span><span class="o">/</span><span class="n">fixation</span><span class="s2">&quot; this represents.</span>

<span class="s2">        This distinguishes the entries in this fixed-affine subspace,</span>

<span class="s2">        preventing them from being gobbled up in ``nest()``.</span>

<span class="s2">        If you wish, you can specify the ``NoneAttrs``,</span>

<span class="s2">        which are consequently set to None for the duplicated entries,</span>

<span class="s2">        preventing them from getting plotted in tuning panels.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;Const&quot;</span> <span class="k">not</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="o">:</span>

            <span class="n">self</span><span class="p">.</span><span class="n">add_axis</span><span class="p">(</span><span class="s1">&#39;Const&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">coords</span><span class="p">(</span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">sub_coord</span><span class="p">))</span><span class="o">:</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="n">copy</span><span class="p">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">self</span><span class="err">[</span><span class="n">coord</span><span class="err">]</span><span class="p">)</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">Const</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="err">{</span><span class="n">a</span><span class="o">:</span> <span class="k">None</span> <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="n">NoneAttrs</span><span class="err">}</span><span class="p">)</span>

            <span class="n">self</span><span class="err">[</span><span class="n">coord</span><span class="err">]</span> <span class="o">=</span> <span class="n">entry</span>
</code></pre></div>

</details>
<h5 id="nest">nest</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">nest</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">inner_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outer_axes</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Return a new xpSpace with axes <code>outer_axes</code>,</p>
<p>obtained by projecting along the <code>inner_axes</code>.
The entries of this <code>xpSpace</code> are themselves <code>xpSpace</code>s,
with axes <code>inner_axes</code>,
each one regrouping the entries with the same (projected) coordinate.</p>
<p>Note: is also called by <code>__getitem__(key)</code> if <code>key</code> is dict.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">nest</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inner_axes</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">outer_axes</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Return a new xpSpace with axes ``outer_axes``,</span>

<span class="s2">        obtained by projecting along the ``inner_axes``.</span>

<span class="s2">        The entries of this ``xpSpace`` are themselves ``xpSpace``s,</span>

<span class="s2">        with axes ``inner_axes``,</span>

<span class="s2">        each one regrouping the entries with the same (projected) coordinate.</span>

<span class="s2">        Note: is also called by ``__getitem__(key)`` if ``key`` is dict.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="c1"># Default: a singleton outer space,</span>

        <span class="c1"># with everything contained in the inner (projection) space.</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="k">is</span> <span class="k">None</span> <span class="k">and</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">None</span><span class="o">:</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c1"># Validate axes</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="k">is</span> <span class="k">None</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span>

            <span class="n">inner_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">None</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">inner_axes</span><span class="p">)</span>

        <span class="c1"># Fill spaces</span>

        <span class="n">outer_space</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="o">:</span>

            <span class="n">outer_coord</span> <span class="o">=</span> <span class="n">outer_space</span><span class="p">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="n">try</span><span class="o">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="n">outer_space</span><span class="err">[</span><span class="n">outer_coord</span><span class="err">]</span>

            <span class="k">except</span> <span class="n">KeyError</span><span class="o">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">inner_axes</span><span class="p">)</span>

                <span class="n">outer_space</span><span class="err">[</span><span class="n">outer_coord</span><span class="err">]</span> <span class="o">=</span> <span class="n">inner_space</span>

            <span class="n">inner_space</span><span class="err">[</span><span class="n">inner_space</span><span class="p">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="err">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">return</span> <span class="n">outer_space</span>
</code></pre></div>

</details>
<h5 id="pop">pop</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.pop(k[,d]) -&gt; v, remove specified key and return the corresponding value.
If key is not found, d is returned if given, otherwise KeyError is raised</p>
<h5 id="popitem">popitem</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove and return a (key, value) pair as a 2-tuple.</p>
<p>Pairs are returned in LIFO (last-in, first-out) order.
Raises KeyError if the dict is empty.</p>
<h5 id="setdefault">setdefault</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert key with a value of default if key is not in the dictionary.</p>
<p>Return the value for key if key is in the dictionary, else default.</p>
<h5 id="update">update</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Update using custom <strong>setitem</strong>().</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Update using custom __setitem__().&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2588648</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2390997</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">).</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="values">values</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">values</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.values() -&gt; an object providing a view on D's values</p>
<h3 id="xpspace">xpSpace</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">xpSpace</span><span class="p">(</span>
    <span class="n">axes</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Functionality to facilitate working with <code>xps</code> and their results.</p>
<p>The function <code>from_list()</code> initializes a <code>SparseSpace</code> from a list
of objects, typically experiments referred to as <code>xps</code>, by
(1) computing the relevant axes from the attributes, and
(2) filling the dict by <code>xps</code>.</p>
<p>The main use of xpSpace is through its <code>print()</code> &amp; <code>plot()</code>,
both of which call <code>table_tree()</code> to nest the axes of the SparseSpace.
For custom plotting, you will likely want to start with <code>table_tree()</code>.</p>
<p>Using <code>from_list(xps)</code> creates a SparseSpace holding <code>xps</code>.
However, the nested <code>xpSpace</code>s output by <code>table_tree()</code>, will hold
objects of type <code>UncertainQtty</code>,
coz <code>table_tree()</code> calls <code>mean()</code> calls <code>field(statkey)</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="s s-Atom">class</span> <span class="nf">xpSpace</span><span class="p">(</span><span class="nv">SparseSpace</span><span class="p">)</span><span class="s s-Atom">:</span>

    <span class="s2">&quot;&quot;&quot;Functionality to facilitate working with ``xps`` and their results.</span>

<span class="s2">    The function ``from_list()`` initializes a ``SparseSpace`` from a list</span>

<span class="s2">    of objects, typically experiments referred to as ``xps``, by</span>

<span class="s2">    (1) computing the relevant axes from the attributes, and</span>

<span class="s2">    (2) filling the dict by ``xps``.</span>

<span class="s2">    The main use of xpSpace is through its ``print()`` &amp; ``plot()``,</span>

<span class="s2">    both of which call ``table_tree()`` to nest the axes of the SparseSpace.</span>

<span class="s2">    For custom plotting, you will likely want to start with ``table_tree()``.</span>

<span class="s2">    Using ``from_list(xps)`` creates a SparseSpace holding ``xps``.</span>

<span class="s2">    However, the nested ``xpSpace``s output by ``table_tree()``, will hold</span>

<span class="s2">    objects of type ``UncertainQtty``,</span>

<span class="s2">    coz ``table_tree()`` calls ``mean()`` calls ``field(statkey)``.&quot;&quot;&quot;</span>

    <span class="s s-Atom">@classmethod</span>

    <span class="s s-Atom">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="s s-Atom">cls</span><span class="p">,</span> <span class="s s-Atom">xps</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Init xpSpace from xpList.&quot;&quot;&quot;</span>

        <span class="s s-Atom">def</span> <span class="nf">make_ticks</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">,</span> <span class="s s-Atom">ordering</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span>

                    <span class="nv">N</span>         <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">seed</span>      <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">infl</span>      <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">loc_rad</span>   <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">rot</span>       <span class="o">=</span> <span class="s s-Atom">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">da_method</span> <span class="o">=</span> <span class="s s-Atom">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="p">))</span><span class="s s-Atom">:</span>

            <span class="s2">&quot;&quot;&quot;Unique &amp; sort, for each axis (individually) in axes.&quot;&quot;&quot;</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">ax_name</span><span class="p">,</span> <span class="s s-Atom">arr</span> <span class="s s-Atom">in</span> <span class="s s-Atom">axes</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="s s-Atom">arr</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="nf">unique</span> <span class="p">(</span><span class="s s-Atom">jumbles</span> <span class="s s-Atom">order</span><span class="p">)</span>

                <span class="s s-Atom">#</span> <span class="nv">Sort</span>

                <span class="s s-Atom">order</span> <span class="o">=</span> <span class="s s-Atom">ordering</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s s-Atom">ax_name</span><span class="p">,</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span>

                <span class="s s-Atom">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">order</span><span class="p">,</span> <span class="s s-Atom">&#39;__call__&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">eg</span><span class="p">.</span> <span class="s s-Atom">mylist</span><span class="p">.</span><span class="s s-Atom">index</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span><span class="s s-Atom">order</span><span class="p">)</span>

                <span class="s s-Atom">elif</span> <span class="s s-Atom">&#39;as_found&#39;</span> <span class="s s-Atom">in</span> <span class="nn">order</span><span class="p">:</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span><span class="s s-Atom">arr</span><span class="p">.</span><span class="s s-Atom">index</span><span class="p">)</span>

                <span class="nn">else</span><span class="p">:</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">default</span> <span class="s s-Atom">sorting</span><span class="p">,</span> <span class="s s-Atom">with</span> <span class="nv">None</span> <span class="s s-Atom">placed</span> <span class="s s-Atom">at</span> <span class="s s-Atom">the</span> <span class="s s-Atom">end</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span> <span class="s s-Atom">lambda</span> <span class="nn">x</span><span class="p">:</span> <span class="p">(</span><span class="s s-Atom">x</span> <span class="o">is</span> <span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">x</span><span class="p">))</span>

                <span class="s s-Atom">if</span> <span class="nf">any</span><span class="p">(</span><span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">order</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="p">[</span><span class="s s-Atom">&#39;rev&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;inv&#39;</span><span class="p">])</span><span class="s s-Atom">:</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="s s-Atom">ticks</span><span class="p">[</span><span class="s s-Atom">::-</span><span class="mi">1</span><span class="p">]</span>

                <span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">ax_name</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">ticks</span>

        <span class="s s-Atom">#</span> <span class="nv">Define</span> <span class="s s-Atom">axes</span>

        <span class="s s-Atom">xp_list</span> <span class="o">=</span> <span class="nf">xpList</span><span class="p">(</span><span class="s s-Atom">xps</span><span class="p">)</span>

        <span class="s s-Atom">axes</span> <span class="o">=</span> <span class="s s-Atom">xp_list</span><span class="p">.</span><span class="nf">split_attrs</span><span class="p">(</span><span class="s s-Atom">nomerge</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">&#39;Const&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nf">make_ticks</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">)</span>

        <span class="s s-Atom">self</span> <span class="o">=</span> <span class="nf">cls</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span>

        <span class="s s-Atom">#</span> <span class="nv">Note</span><span class="s s-Atom">:</span> <span class="s s-Atom">this</span> <span class="nf">attr</span> <span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">)</span> <span class="s s-Atom">will</span> <span class="o">not</span> <span class="s s-Atom">be</span> <span class="s s-Atom">propagated</span> <span class="s s-Atom">through</span> <span class="nf">nest</span><span class="p">().</span>

        <span class="s s-Atom">#</span> <span class="nv">That</span> <span class="o">is</span> <span class="s s-Atom">fine</span><span class="p">.</span> <span class="nv">Otherwise</span> <span class="s s-Atom">we</span> <span class="s s-Atom">should</span> <span class="s s-Atom">have</span> <span class="s s-Atom">to</span> <span class="s s-Atom">prune</span> <span class="s s-Atom">the</span> <span class="s s-Atom">ticks</span>

        <span class="s s-Atom">#</span> <span class="p">(</span><span class="s s-Atom">if</span> <span class="s s-Atom">they</span> <span class="s s-Atom">are</span> <span class="s s-Atom">to</span> <span class="s s-Atom">be</span> <span class="s s-Atom">useful</span><span class="p">),</span> <span class="s s-Atom">which</span> <span class="s s-Atom">we</span> <span class="s s-Atom">don&#39;t want to do.</span>

<span class="s s-Atom">        self.ticks = axes</span>

<span class="s s-Atom">        # Fill</span>

<span class="s s-Atom">        self.update({self.__getkey__(xp): xp for xp in xps})</span>

<span class="s s-Atom">        return self</span>

<span class="s s-Atom">    def field(self, statkey=&quot;rmse.a&quot;):</span>

<span class="s s-Atom">        &quot;&quot;&quot;Extract ``statkey`` for each item in ``self``.&quot;&quot;&quot;</span>

<span class="s s-Atom">        # Init a new xpDict to hold field</span>

<span class="s s-Atom">        avrgs = self.__class__(self.axes)</span>

<span class="s s-Atom">        found_anything = False</span>

<span class="s s-Atom">        for coord, xp in self.items():</span>

<span class="s s-Atom">            val = getattr(xp.avrgs, statkey, None)</span>

<span class="s s-Atom">            avrgs[coord] = val</span>

<span class="s s-Atom">            found_anything = found_anything or (val is not None)</span>

<span class="s s-Atom">        if not found_anything:</span>

<span class="s s-Atom">            raise AttributeError(</span>

<span class="s s-Atom">                f&quot;The stat. field &#39;</span><span class="p">{</span><span class="s s-Atom">statkey</span><span class="p">}</span><span class="s s-Atom">&#39; was not found&quot;</span>

<span class="s s-Atom">                &quot; among any of the xp&#39;s</span><span class="p">.</span><span class="s2">&quot;)</span>

<span class="s2">        return avrgs</span>

<span class="s2">    def mean(self, axes=None):</span>

<span class="s2">        # Note: The case ``axes=()`` should work w/o special treatment.</span>

<span class="s2">        if axes is None:</span>

<span class="s2">            return self</span>

<span class="s2">        nested = self.nest(axes)</span>

<span class="s2">        for coord, space in nested.items():</span>

<span class="s2">            def getval(uq): return uq.val if isinstance(uq, UncertainQtty) else uq</span>

<span class="s2">            vals = [getval(uq) for uq in space.values()]</span>

<span class="s2">            # Don&#39;t use nanmean! It would give false impressions.</span>

<span class="s2">            mu = np.mean(vals)</span>

<span class="s2">            with warnings.catch_warnings():</span>

<span class="s2">                warnings.simplefilter(&quot;</span><span class="s s-Atom">ignore</span><span class="s2">&quot;, category=RuntimeWarning)</span>

<span class="s2">                # Don&#39;t print warnings caused by N=1.</span>

<span class="s2">                # It already correctly yield nan&#39;s.</span>

<span class="s2">                var = np.var(vals, ddof=1)</span>

<span class="s2">            N = len(vals)</span>

<span class="s2">            uq = UncertainQtty(mu, np.sqrt(var/N))</span>

<span class="s2">            uq.nTotal   = N</span>

<span class="s2">            uq.nFail    = N - np.isfinite(vals).sum()</span>

<span class="s2">            uq.nSuccess = N - uq.nFail</span>

<span class="s2">            nested[coord] = uq</span>

<span class="s2">        return nested</span>

<span class="s2">    def tune(self, axes=None, costfun=None):</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="nv">Get</span> <span class="p">(</span><span class="s s-Atom">compile</span><span class="o">/</span><span class="s s-Atom">tabulate</span><span class="p">)</span> <span class="s s-Atom">a</span> <span class="s s-Atom">stat</span> <span class="s s-Atom">field</span> <span class="s s-Atom">optimised</span> <span class="s s-Atom">wrt</span><span class="p">.</span> <span class="s s-Atom">tuning</span> <span class="s s-Atom">params</span><span class="p">.</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        # Define cost-function</span>

<span class="s2">        costfun = (costfun or &#39;increasing&#39;).lower()</span>

<span class="s2">        if &#39;increas&#39; in costfun:</span>

<span class="s2">            costfun = (lambda x: +x)</span>

<span class="s2">        elif &#39;decreas&#39; in costfun:</span>

<span class="s2">            costfun = (lambda x: -x)</span>

<span class="s2">        else:</span>

<span class="s2">            assert hasattr(costfun, &#39;__call__&#39;)  # custom</span>

<span class="s2">        # Note: The case ``axes=()`` should work w/o special treatment.</span>

<span class="s2">        if axes is None:</span>

<span class="s2">            return self</span>

<span class="s2">        nested = self.nest(axes)</span>

<span class="s2">        for coord, space in nested.items():</span>

<span class="s2">            # Find optimal value and coord within space</span>

<span class="s2">            MIN = np.inf</span>

<span class="s2">            for i, (inner_coord, uq) in enumerate(space.items()):</span>

<span class="s2">                cost = costfun(uq.val)</span>

<span class="s2">                if cost &lt;= MIN:</span>

<span class="s2">                    MIN                = cost</span>

<span class="s2">                    uq_opt             = uq</span>

<span class="s2">                    uq_opt.tuned_coord = inner_coord</span>

<span class="s2">            nested[coord] = uq_opt</span>

<span class="s2">        return nested</span>

<span class="s2">    def validate_axes(self, axes):</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="nv">Validate</span> <span class="s s-Atom">axes</span><span class="p">.</span>

        <span class="nv">Note</span><span class="s s-Atom">:</span> <span class="nv">This</span> <span class="s s-Atom">does</span> <span class="o">not</span> <span class="s s-Atom">convert</span> <span class="nv">None</span> <span class="nf">to</span> <span class="p">(),</span>

              <span class="s s-Atom">allowing</span> <span class="nv">None</span> <span class="s s-Atom">to</span> <span class="s s-Atom">remain</span> <span class="s s-Atom">special</span><span class="p">.</span>

              <span class="nv">Use</span> <span class="err">``</span><span class="s s-Atom">axis</span> <span class="nf">or</span> <span class="p">()</span><span class="err">``</span> <span class="s s-Atom">wherever</span> <span class="s s-Atom">tuples</span> <span class="s s-Atom">are</span> <span class="s s-Atom">required</span><span class="p">.</span>

        <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        roles = {}  # &quot;</span><span class="s s-Atom">inv</span><span class="s2">&quot;</span>

<span class="s2">        for role in set(axes) | set(AXES_ROLES):</span>

<span class="s2">            assert role in AXES_ROLES, f&quot;</span><span class="nv">Invalid</span> <span class="s s-Atom">role</span> <span class="p">{</span><span class="s s-Atom">role</span><span class="p">!</span><span class="s s-Atom">r</span><span class="p">}</span><span class="s2">&quot;</span>

<span class="s2">            aa = axes.get(role, AXES_ROLES[role])</span>

<span class="s2">            if aa is None:</span>

<span class="s2">                pass  # Purposely special</span>

<span class="s2">            else:</span>

<span class="s2">                # Ensure iterable</span>

<span class="s2">                if isinstance(aa, str) or not hasattr(aa, &quot;</span><span class="k">__</span><span class="s s-Atom">iter__</span><span class="s2">&quot;):</span>

<span class="s2">                    aa = (aa,)</span>

<span class="s2">                aa = self.intersect_axes(aa)</span>

<span class="s2">                for axis in aa:</span>

<span class="s2">                    # Ensure unique</span>

<span class="s2">                    if axis in roles:</span>

<span class="s2">                        raise TypeError(</span>

<span class="s2">                            f&quot;</span><span class="nv">An</span> <span class="nf">axis</span> <span class="p">(</span><span class="s s-Atom">here</span> <span class="p">{</span><span class="s s-Atom">axis</span><span class="p">!</span><span class="s s-Atom">r</span><span class="p">})</span> <span class="s s-Atom">cannot</span> <span class="s s-Atom">be</span> <span class="s s-Atom">assigned</span> <span class="s s-Atom">to</span> <span class="mi">2</span><span class="s2">&quot;</span>

<span class="s2">                            f&quot;</span> <span class="nf">roles</span> <span class="p">(</span><span class="s s-Atom">here</span> <span class="p">{</span><span class="s s-Atom">role</span><span class="p">!</span><span class="s s-Atom">r</span><span class="p">}</span> <span class="s s-Atom">and</span> <span class="p">{</span><span class="s s-Atom">roles</span><span class="p">[</span><span class="s s-Atom">axis</span><span class="p">]!</span><span class="s s-Atom">r</span><span class="p">}).</span><span class="s2">&quot;)</span>

<span class="s2">                    else:</span>

<span class="s2">                        roles[axis] = role</span>

<span class="s2">            axes[role] = aa</span>

<span class="s2">        return axes</span>

<span class="s2">    def table_tree(self, statkey, axes):</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="nv">Hierarchical</span> <span class="nf">nest</span><span class="p">()</span><span class="s s-Atom">:</span> <span class="s s-Atom">xp_dict</span><span class="o">&gt;</span><span class="s s-Atom">outer</span><span class="o">&gt;</span><span class="s s-Atom">inner</span><span class="o">&gt;</span><span class="s s-Atom">mean</span><span class="o">&gt;</span><span class="s s-Atom">optim</span><span class="p">.</span>

        <span class="s s-Atom">as</span> <span class="s s-Atom">specified</span> <span class="s s-Atom">by</span> <span class="err">``</span><span class="s s-Atom">axes</span><span class="err">``</span><span class="p">.</span> <span class="nv">Returns</span> <span class="s s-Atom">this</span> <span class="s s-Atom">new</span> <span class="s s-Atom">xpSpace</span><span class="p">.</span>

        <span class="o">-</span> <span class="s s-Atom">print_1d</span> <span class="o">/</span> <span class="nf">plot_1d</span> <span class="p">(</span><span class="s s-Atom">respectively</span><span class="p">)</span> <span class="s s-Atom">separate</span>

          <span class="s s-Atom">tables</span> <span class="o">/</span> <span class="nf">panel</span><span class="p">(</span><span class="s s-Atom">row</span><span class="p">)</span><span class="s s-Atom">s</span> <span class="s s-Atom">for</span> <span class="err">``</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;outer&#39;</span><span class="p">]</span><span class="err">``</span><span class="p">,</span> <span class="s s-Atom">and</span>

          <span class="s s-Atom">columns</span><span class="o">/</span> <span class="s s-Atom">x</span><span class="o">-</span><span class="s s-Atom">axis</span>      <span class="s s-Atom">for</span> <span class="err">``</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;inner&#39;</span><span class="p">]</span><span class="err">``</span><span class="p">.</span>

        <span class="o">-</span> <span class="nv">The</span> <span class="err">``</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;mean&#39;</span><span class="p">]</span><span class="err">``</span> <span class="s s-Atom">and</span> <span class="err">``</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;optim&#39;</span><span class="p">]</span><span class="err">``</span> <span class="s s-Atom">get</span> <span class="s s-Atom">eliminated</span>

          <span class="s s-Atom">by</span> <span class="s s-Atom">the</span> <span class="nf">mean</span><span class="p">()</span><span class="o">/</span><span class="nf">tune</span><span class="p">()</span> <span class="s s-Atom">operations</span><span class="p">.</span>

        <span class="nv">Note</span><span class="s s-Atom">:</span> <span class="s s-Atom">cannot</span> <span class="s s-Atom">support</span> <span class="s s-Atom">multiple</span> <span class="s s-Atom">statkeys</span>

              <span class="s s-Atom">because</span> <span class="s s-Atom">it&#39;s not (obviously) meaningful</span>

<span class="s s-Atom">              when optimizing over tuning_axes.</span>

<span class="s s-Atom">        &quot;&quot;&quot;</span>

<span class="s s-Atom">        axes = self.validate_axes(axes)</span>

<span class="s s-Atom">        def mean_tune(xp_dict):</span>

<span class="s s-Atom">            &quot;&quot;&quot;Take mean, then tune.</span>

<span class="s s-Atom">            Note: the SparseDict implementation should be sufficiently</span>

<span class="s s-Atom">            &quot;uncluttered&quot; that mean_tune() (or a few of its code lines)</span>

<span class="s s-Atom">            could be called anywhere above/between/below</span>

<span class="s s-Atom">            the ``nest()``ing of ``outer`` or ``inner``.</span>

<span class="s s-Atom">            These possibile call locations are commented in the code.&quot;&quot;&quot;</span>

<span class="s s-Atom">            uq_dict = xp_dict.field(statkey)</span>

<span class="s s-Atom">            uq_dict = uq_dict.mean(axes[&#39;mean&#39;])</span>

<span class="s s-Atom">            uq_dict = uq_dict.tune(axes[&#39;optim&#39;])</span>

<span class="s s-Atom">            return uq_dict</span>

<span class="s s-Atom">        self = mean_tune(self)</span>

<span class="s s-Atom">        # Prefer calling mean_tune() [also see its docstring]</span>

<span class="s s-Atom">        # before doing outer/inner nesting. This is because then the axes of</span>

<span class="s s-Atom">        # a row (xpSpace) should not include mean&amp;optim, and thus:</span>

<span class="s s-Atom">        #  - Column header/coords may be had directly as row.keys(),</span>

<span class="s s-Atom">        #    without extraction by __getkey__() from (e.g.) row[0].</span>

<span class="s s-Atom">        #  - Don&#39;t</span> <span class="s s-Atom">need</span> <span class="s s-Atom">to</span> <span class="s s-Atom">propagate</span> <span class="s s-Atom">mean&amp;optim</span> <span class="s s-Atom">axes</span> <span class="s s-Atom">down</span> <span class="s s-Atom">to</span> <span class="s s-Atom">the</span> <span class="s s-Atom">row</span> <span class="s s-Atom">level</span><span class="p">.</span>

        <span class="s s-Atom">#</span>    <span class="s s-Atom">which</span> <span class="s s-Atom">would</span> <span class="s s-Atom">require</span> <span class="s s-Atom">defining</span> <span class="s s-Atom">rows</span> <span class="s s-Atom">by</span> <span class="s s-Atom">the</span> <span class="nn">nesting</span><span class="p">:</span>

        <span class="s s-Atom">#</span>    <span class="s s-Atom">rows</span> <span class="o">=</span> <span class="s s-Atom">table</span><span class="p">.</span><span class="nf">nest</span><span class="p">(</span><span class="s s-Atom">outer_axes</span><span class="o">=</span><span class="s s-Atom">dict_tools</span><span class="p">.</span><span class="nf">complement</span><span class="p">(</span><span class="s s-Atom">table</span><span class="p">.</span><span class="s s-Atom">axes</span><span class="p">,</span>

        <span class="s s-Atom">#</span>        <span class="s s-Atom">*</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;inner&#39;</span><span class="p">]</span> <span class="nf">or</span> <span class="p">()),</span>

        <span class="s s-Atom">#</span>        <span class="s s-Atom">*</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;mean&#39;</span><span class="p">]</span>  <span class="nf">or</span> <span class="p">()),</span>

        <span class="s s-Atom">#</span>        <span class="s s-Atom">*</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;optim&#39;</span><span class="p">]</span> <span class="nf">or</span> <span class="p">())</span> <span class="p">))</span>

        <span class="s s-Atom">#</span>  <span class="o">-</span> <span class="nv">Each</span> <span class="s s-Atom">level</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">output</span> <span class="s s-Atom">from</span> <span class="s s-Atom">table_tree</span>

        <span class="s s-Atom">#</span>    <span class="o">is</span> <span class="s s-Atom">a</span> <span class="nf">smaller</span> <span class="p">(</span><span class="s s-Atom">and</span> <span class="s s-Atom">more</span> <span class="s s-Atom">manageable</span><span class="p">)</span> <span class="s s-Atom">dict</span><span class="p">.</span>

        <span class="s s-Atom">tables</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">nest</span><span class="p">(</span><span class="s s-Atom">outer_axes</span><span class="o">=</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;outer&#39;</span><span class="p">])</span>

        <span class="s s-Atom">for</span> <span class="s s-Atom">table_coord</span><span class="p">,</span> <span class="s s-Atom">table</span> <span class="s s-Atom">in</span> <span class="s s-Atom">tables</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">table</span> <span class="o">=</span> <span class="nf">mean_tune</span><span class="p">(</span><span class="s s-Atom">table</span><span class="p">)</span>

            <span class="s s-Atom">#</span> <span class="nv">Should</span> <span class="o">not</span> <span class="s s-Atom">be</span> <span class="nf">used</span> <span class="p">(</span><span class="s s-Atom">nesting</span> <span class="s s-Atom">as</span> <span class="s s-Atom">rows</span> <span class="o">is</span> <span class="s s-Atom">more</span> <span class="s s-Atom">natural</span><span class="p">,</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">and</span> <span class="o">is</span> <span class="s s-Atom">required</span> <span class="s s-Atom">for</span> <span class="s s-Atom">getting</span> <span class="s s-Atom">distinct</span><span class="o">/</span><span class="s s-Atom">row_keys</span><span class="p">).</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">cols</span> <span class="o">=</span> <span class="s s-Atom">table</span><span class="p">.</span><span class="nf">nest</span><span class="p">(</span><span class="s s-Atom">outer_axes</span><span class="o">=</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;inner&#39;</span><span class="p">])</span>

            <span class="s s-Atom">rows</span> <span class="o">=</span> <span class="s s-Atom">table</span><span class="p">.</span><span class="nf">nest</span><span class="p">(</span><span class="s s-Atom">inner_axes</span><span class="o">=</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;inner&#39;</span><span class="p">]</span> <span class="nf">or</span> <span class="p">())</span>

            <span class="s s-Atom">#</span> <span class="nv">Overwrite</span> <span class="s s-Atom">table</span> <span class="s s-Atom">by</span> <span class="s s-Atom">its</span> <span class="s s-Atom">nesting</span> <span class="s s-Atom">as</span> <span class="s s-Atom">rows</span>

            <span class="s s-Atom">tables</span><span class="p">[</span><span class="s s-Atom">table_coord</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">rows</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">for</span> <span class="s s-Atom">row_coord</span><span class="p">,</span> <span class="s s-Atom">row</span> <span class="s s-Atom">in</span> <span class="s s-Atom">rows</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">rows</span><span class="p">[</span><span class="s s-Atom">row_coord</span><span class="p">]</span> <span class="o">=</span> <span class="nf">mean_tune</span><span class="p">(</span><span class="s s-Atom">row</span><span class="p">)</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">axes</span><span class="p">,</span> <span class="s s-Atom">tables</span>

    <span class="s s-Atom">def</span> <span class="nf">tickz</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">axis_name</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Axis ticks without None&quot;&quot;&quot;</span>

        <span class="s s-Atom">return</span> <span class="p">[</span><span class="s s-Atom">x</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">ticks</span><span class="p">[</span><span class="s s-Atom">axis_name</span><span class="p">]</span> <span class="s s-Atom">if</span> <span class="s s-Atom">x</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span><span class="p">]</span>

    <span class="s s-Atom">def</span> <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">statkey=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="s s-Atom">axes</span><span class="o">=</span><span class="nv">AXES_ROLES</span><span class="p">,</span>

              <span class="s s-Atom">subcols</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">decimals</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Print tables of results.</span>

<span class="s2">        - statkey: The statistical field from the experiments to report.</span>

<span class="s2">        - subcols: If True, then subcolumns are added to indicate the</span>

<span class="s2">                   1σ confidence interval, and potentially some other stuff.</span>

<span class="s2">        - axes: Allots (maps) each role to a set of axis of the xp_dict.</span>

<span class="s2">          Suggestion:</span>

<span class="s2">          &gt;&gt;&gt; dict(</span>

<span class="s2">          &gt;&gt;&gt;    outer=&#39;da_method&#39;, inner=&#39;N&#39;, mean=&#39;seed&#39;,</span>

<span class="s2">          &gt;&gt;&gt;    optim=(&#39;infl&#39;,&#39;loc_rad&#39;))</span>

<span class="s2">          Example: If ``mean`` is assigned to:</span>

<span class="s2">          - (&quot;</span><span class="s s-Atom">seed</span><span class="s2">&quot;,): Experiments are averaged accross seeds,</span>

<span class="s2">                       and the 1σ (sub)col is computed as sqrt(var(xps)/N),</span>

<span class="s2">                       where xps is a set of experiments.</span>

<span class="s2">          - ()       : Experiments are averaged across nothing</span>

<span class="s2">                       (i.e. this is an edge case).</span>

<span class="s2">          - None     : Experiments are not averaged</span>

<span class="s2">                       (i.e. the values are the same as above),</span>

<span class="s2">                       and the 1σ (sub)col is computed from</span>

<span class="s2">                       the time series of that single experiment.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="s s-Atom">import</span> <span class="s s-Atom">pandas</span> <span class="s s-Atom">as</span> <span class="s s-Atom">pd</span>

        <span class="s s-Atom">def</span> <span class="nf">align_subcols</span><span class="p">(</span><span class="s s-Atom">rows</span><span class="p">,</span> <span class="s s-Atom">cc</span><span class="p">,</span> <span class="s s-Atom">subcols</span><span class="p">,</span> <span class="s s-Atom">h2</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s2">&quot;&quot;&quot;Subcolumns: align, justify, join.&quot;&quot;&quot;</span>

            <span class="s s-Atom">#</span> <span class="nv">Define</span> <span class="s s-Atom">subcol</span> <span class="s s-Atom">formats</span>

            <span class="s s-Atom">subc</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;keys&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">]</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;headers&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">statkey</span><span class="p">,</span> <span class="s s-Atom">&#39;1σ&#39;</span><span class="p">]</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;frmts&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="nv">None</span><span class="p">,</span> <span class="nv">None</span><span class="p">]</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;spaces&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">&#39; ±&#39;</span><span class="p">,</span> <span class="p">]</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">last</span> <span class="s s-Atom">one</span> <span class="s s-Atom">gets</span> <span class="s s-Atom">appended</span> <span class="s s-Atom">below</span><span class="p">.</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;aligns&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;&lt;&#39;</span><span class="p">]</span>  <span class="s s-Atom">#</span> <span class="mi">4</span> <span class="s s-Atom">header</span> <span class="s s-Atom">--</span> <span class="s s-Atom">matter</span> <span class="s s-Atom">gets</span> <span class="s s-Atom">decimal</span><span class="o">-</span><span class="s s-Atom">aligned</span><span class="p">.</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;optim&#39;</span><span class="p">]</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;keys&#39;</span><span class="p">]</span>    <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s2">&quot;tuned_coord&quot;</span><span class="p">]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;headers&#39;</span><span class="p">]</span> <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;optim&#39;</span><span class="p">]]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;frmts&#39;</span><span class="p">]</span>   <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">lambda</span> <span class="nn">x</span><span class="p">:</span> <span class="nf">tuple</span><span class="p">(</span><span class="s s-Atom">a</span> <span class="s s-Atom">for</span> <span class="s s-Atom">a</span> <span class="s s-Atom">in</span> <span class="s s-Atom">x</span><span class="p">)]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;spaces&#39;</span><span class="p">]</span>  <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">&#39; *&#39;</span><span class="p">]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;aligns&#39;</span><span class="p">]</span>  <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">&#39;&lt;&#39;</span><span class="p">]</span>

            <span class="s s-Atom">elif</span> <span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;mean&#39;</span><span class="p">]</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;keys&#39;</span><span class="p">]</span>    <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s2">&quot;nFail&quot;</span><span class="p">,</span> <span class="s2">&quot;nSuccess&quot;</span><span class="p">]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;headers&#39;</span><span class="p">]</span> <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">&#39;☠&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;✓&#39;</span><span class="p">]</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">use</span> <span class="s s-Atom">width</span><span class="o">-</span><span class="mi">1</span> <span class="s s-Atom">symbols</span><span class="p">!</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;frmts&#39;</span><span class="p">]</span>   <span class="s s-Atom">+=</span> <span class="p">[</span><span class="nv">None</span><span class="p">,</span> <span class="nv">None</span><span class="p">]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;spaces&#39;</span><span class="p">]</span>  <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">&#39; &#39;</span><span class="p">,</span> <span class="s s-Atom">&#39; &#39;</span><span class="p">]</span>

                <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;aligns&#39;</span><span class="p">]</span>  <span class="s s-Atom">+=</span> <span class="p">[</span><span class="s s-Atom">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;&gt;&#39;</span><span class="p">]</span>

            <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;spaces&#39;</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">&#39;&#39;</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">no</span> <span class="s s-Atom">space</span> <span class="s s-Atom">after</span> <span class="s s-Atom">last</span> <span class="s s-Atom">subcol</span>

            <span class="s s-Atom">template</span> <span class="o">=</span> <span class="s s-Atom">&#39;{}&#39;</span> <span class="o">+</span> <span class="s s-Atom">&#39;{}&#39;</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;spaces&#39;</span><span class="p">])</span>

            <span class="s s-Atom">#</span> <span class="nv">Transpose</span>

            <span class="s s-Atom">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">rows</span><span class="p">)]</span>

            <span class="s s-Atom">#</span> <span class="nv">Iterate</span> <span class="s s-Atom">over</span> <span class="s s-Atom">columns</span><span class="p">.</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">j</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">col_coord</span><span class="p">,</span> <span class="s s-Atom">column</span><span class="p">)</span> <span class="s s-Atom">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="s s-Atom">cc</span><span class="p">,</span> <span class="s s-Atom">columns</span><span class="p">))</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">#</span> <span class="nv">Tabulate</span> <span class="s s-Atom">columns</span>

                <span class="s s-Atom">if</span> <span class="nn">subcols</span><span class="p">:</span>

                    <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">unpack_uqs</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">,</span> <span class="s s-Atom">decimals</span><span class="p">,</span> <span class="s s-Atom">subc</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">])</span>

                    <span class="s s-Atom">#</span> <span class="nv">Tabulate</span> <span class="s s-Atom">subcolumns</span>

                    <span class="s s-Atom">subheaders</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="s s-Atom">for</span> <span class="s s-Atom">key</span><span class="p">,</span> <span class="s s-Atom">header</span><span class="p">,</span> <span class="s s-Atom">frmt</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="s s-Atom">align</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">subc</span><span class="p">.</span><span class="nf">values</span><span class="p">())</span><span class="s s-Atom">:</span>

                        <span class="s s-Atom">column</span><span class="p">[</span><span class="s s-Atom">key</span><span class="p">]</span> <span class="o">=</span> <span class="nf">tabulate_column</span><span class="p">(</span>

                            <span class="s s-Atom">column</span><span class="p">[</span><span class="s s-Atom">key</span><span class="p">],</span> <span class="s s-Atom">header</span><span class="p">,</span> <span class="s s-Atom">frmt</span><span class="o">=</span><span class="s s-Atom">frmt</span><span class="p">)[</span><span class="mi">1</span><span class="s s-Atom">:</span><span class="p">]</span>

                        <span class="nv">L</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s s-Atom">key</span><span class="p">])</span>

                        <span class="s s-Atom">if</span> <span class="s s-Atom">align</span> <span class="o">==</span> <span class="s s-Atom">&#39;&lt;&#39;:</span>

                            <span class="s s-Atom">subheaders</span> <span class="s s-Atom">+=</span> <span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="s s-Atom">header</span><span class="p">).</span><span class="nf">ljust</span><span class="p">(</span><span class="nv">L</span><span class="p">)]</span>

                        <span class="nn">else</span><span class="p">:</span>

                            <span class="s s-Atom">subheaders</span> <span class="s s-Atom">+=</span> <span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="s s-Atom">header</span><span class="p">).</span><span class="nf">rjust</span><span class="p">(</span><span class="nv">L</span><span class="p">)]</span>

                    <span class="s s-Atom">#</span> <span class="nv">Join</span> <span class="nn">subcolumns</span><span class="p">:</span>

                    <span class="s s-Atom">matter</span> <span class="o">=</span> <span class="p">[</span>

                        <span class="s s-Atom">template</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s s-Atom">row</span><span class="p">[</span><span class="s s-Atom">k</span><span class="p">]</span> <span class="s s-Atom">for</span> <span class="s s-Atom">k</span> <span class="s s-Atom">in</span> <span class="s s-Atom">subc</span><span class="p">[</span><span class="s s-Atom">&#39;keys&#39;</span><span class="p">]])</span>

                        <span class="s s-Atom">for</span> <span class="s s-Atom">row</span> <span class="s s-Atom">in</span> <span class="s s-Atom">column</span>

                    <span class="p">]</span>

                    <span class="s s-Atom">header</span> <span class="o">=</span> <span class="s s-Atom">template</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">subheaders</span><span class="p">)</span>

                <span class="nn">else</span><span class="p">:</span>

                    <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">unpack_uqs</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">,</span> <span class="s s-Atom">decimals</span><span class="p">)[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>

                    <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">tabulate_column</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">,</span> <span class="s s-Atom">statkey</span><span class="p">)</span>

                    <span class="s s-Atom">header</span><span class="p">,</span> <span class="s s-Atom">matter</span> <span class="o">=</span> <span class="s s-Atom">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s s-Atom">column</span><span class="p">[</span><span class="mi">1</span><span class="s s-Atom">:</span><span class="p">]</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">h2:</span>  <span class="s s-Atom">#</span> <span class="nv">Do</span> <span class="s s-Atom">super_header</span>

                    <span class="s s-Atom">if</span> <span class="nn">j</span><span class="p">:</span>

                        <span class="s s-Atom">super_header</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">col_coord</span><span class="p">)</span>

                    <span class="nn">else</span><span class="p">:</span>

                        <span class="s s-Atom">super_header</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="s s-Atom">col_coord</span><span class="p">)</span>

                    <span class="s s-Atom">width</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">header</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">+=</span> <span class="mi">1</span> <span class="s s-Atom">if</span> <span class="s s-Atom">using</span> <span class="s s-Atom">unicode</span> <span class="s s-Atom">chars</span> <span class="s s-Atom">like</span> <span class="s s-Atom">✔️</span>

                    <span class="s s-Atom">super_header</span> <span class="o">=</span> <span class="s s-Atom">super_header</span><span class="p">.</span><span class="nf">center</span><span class="p">(</span><span class="s s-Atom">width</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

                    <span class="s s-Atom">header</span> <span class="o">=</span> <span class="s s-Atom">super_header</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s s-Atom">header</span>

                <span class="s s-Atom">columns</span><span class="p">[</span><span class="s s-Atom">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">header</span><span class="p">]</span><span class="o">+</span><span class="s s-Atom">matter</span>

            <span class="s s-Atom">#</span> <span class="nv">Un</span><span class="o">-</span><span class="s s-Atom">transpose</span>

            <span class="s s-Atom">rows</span> <span class="o">=</span> <span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">columns</span><span class="p">)]</span>

            <span class="s s-Atom">return</span> <span class="s s-Atom">rows</span>

        <span class="s s-Atom">#</span> <span class="nv">Inform</span> <span class="s s-Atom">axes</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">axes</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s s-Atom">&#39;mean&#39;</span><span class="p">,</span> <span class="nv">None</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">f</span><span class="s2">&quot;Averages (in time and) over {axes[&#39;mean&#39;]}.&quot;</span><span class="p">)</span>

        <span class="nn">else</span><span class="p">:</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;Averages in time only&quot;</span>

                  <span class="s2">&quot; (=&gt; the 1σ estimates may be unreliable).&quot;</span><span class="p">)</span>

        <span class="s s-Atom">axes</span><span class="p">,</span> <span class="s s-Atom">tables</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">table_tree</span><span class="p">(</span><span class="s s-Atom">statkey</span><span class="p">,</span> <span class="s s-Atom">axes</span><span class="p">)</span>

        <span class="s s-Atom">for</span> <span class="s s-Atom">table_coord</span><span class="p">,</span> <span class="s s-Atom">table</span> <span class="s s-Atom">in</span> <span class="s s-Atom">tables</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>

            <span class="s s-Atom">#</span> <span class="nv">Get</span> <span class="s s-Atom">this</span> <span class="s s-Atom">table&#39;s column coords (cc). Use dict for sorted&amp;unique.</span>

<span class="s s-Atom">            # cc = xp_dict.ticks[axes[&quot;inner&quot;]] # May be larger than needed.</span>

<span class="s s-Atom">            # cc = table[0].keys()              # May be too small a set.</span>

<span class="s s-Atom">            cc = {c: None for row in table.values() for c in row}</span>

<span class="s s-Atom">            # Convert table (rows) into rows (lists) of equal length</span>

<span class="s s-Atom">            rows = [[row.get(c, None) for c in cc] for row in table.values()]</span>

<span class="s s-Atom">            if False:  # ****************** Simple (for debugging) table</span>

<span class="s s-Atom">                for i, (row_coord, row) in enumerate(zip(table, rows)):</span>

<span class="s s-Atom">                    row_key = &quot;, &quot;.join(str(v) for v in row_coord)</span>

<span class="s s-Atom">                    rows[i] = [row_key]         + row</span>

<span class="s s-Atom">                rows.insert(0, [f&quot;{table.axes}&quot;] + [repr(c) for c in cc])</span>

<span class="s s-Atom">            else:  # ********************** Elegant table.</span>

<span class="s s-Atom">                h2 = &quot;\n&quot; if len(cc) &gt; 1 else &quot;&quot;  # do column-super-header</span>

<span class="s s-Atom">                rows = align_subcols(rows, cc, subcols, h2)</span>

<span class="s s-Atom">                # Make and prepend left-side table</span>

<span class="s s-Atom">                # - It&#39;s</span> <span class="s s-Atom">prettier</span> <span class="s s-Atom">if</span> <span class="s s-Atom">row_keys</span> <span class="s s-Atom">don&#39;t have unnecessary cols.</span>

<span class="s s-Atom">                #   For example, the table of Climatology should not have an</span>

<span class="s s-Atom">                #   entire column repeatedly displaying &quot;infl=None&quot;.</span>

<span class="s s-Atom">                #   =&gt; split_attrs().</span>

<span class="s s-Atom">                # - Why didn&#39;t</span> <span class="s s-Atom">we</span> <span class="s s-Atom">do</span> <span class="s s-Atom">this</span> <span class="s s-Atom">for</span> <span class="s s-Atom">the</span> <span class="s s-Atom">column</span> <span class="s s-Atom">attrs?</span>

                <span class="s s-Atom">#</span>   <span class="nv">Coz</span> <span class="s s-Atom">there</span> <span class="s s-Atom">we</span> <span class="s s-Atom">have</span> <span class="s s-Atom">no</span> <span class="s s-Atom">ambition</span> <span class="s s-Atom">to</span> <span class="s s-Atom">split</span> <span class="s s-Atom">the</span> <span class="s s-Atom">attrs</span><span class="p">,</span>

                <span class="s s-Atom">#</span>   <span class="s s-Atom">which</span> <span class="s s-Atom">would</span> <span class="s s-Atom">also</span> <span class="s s-Atom">require</span> <span class="s s-Atom">excessive</span> <span class="nn">processing</span><span class="p">:</span>

                <span class="s s-Atom">#</span>   <span class="s s-Atom">nesting</span> <span class="s s-Atom">the</span> <span class="s s-Atom">table</span> <span class="s s-Atom">as</span> <span class="s s-Atom">cols</span><span class="p">,</span> <span class="s s-Atom">and</span> <span class="s s-Atom">then</span> <span class="nf">split_attrs</span><span class="p">()</span> <span class="s s-Atom">on</span> <span class="s s-Atom">cols</span><span class="p">.</span>

                <span class="s s-Atom">row_keys</span> <span class="o">=</span> <span class="nf">xpList</span><span class="p">(</span><span class="s s-Atom">table</span><span class="p">.</span><span class="nf">keys</span><span class="p">()).</span><span class="nf">split_attrs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="s s-Atom">row_keys</span> <span class="o">=</span> <span class="s s-Atom">pd</span><span class="p">.</span><span class="nv">DataFrame</span><span class="p">.</span><span class="nf">from_dict</span><span class="p">(</span>

                    <span class="s s-Atom">row_keys</span><span class="p">,</span> <span class="s s-Atom">dtype=</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">allow</span> <span class="s s-Atom">storing</span> <span class="nv">None</span>

                <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">row_keys</span><span class="p">.</span><span class="s s-Atom">columns</span><span class="p">)</span><span class="s s-Atom">:</span>

                    <span class="s s-Atom">#</span> <span class="nv">Header</span>

                    <span class="s s-Atom">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">h2</span><span class="o">+</span><span class="s s-Atom">k</span> <span class="s s-Atom">for</span> <span class="s s-Atom">k</span> <span class="s s-Atom">in</span> <span class="s s-Atom">row_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s s-Atom">h2+&#39;⑊&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s s-Atom">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="s s-Atom">#</span> <span class="nv">Matter</span>

                    <span class="s s-Atom">for</span> <span class="s s-Atom">row</span><span class="p">,</span> <span class="p">(</span><span class="s s-Atom">i</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="p">)</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="s s-Atom">rows</span><span class="p">[</span><span class="mi">1</span><span class="s s-Atom">:</span><span class="p">],</span> <span class="s s-Atom">row_keys</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">())</span><span class="s s-Atom">:</span>

                        <span class="s s-Atom">rows</span><span class="p">[</span><span class="s s-Atom">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="s s-Atom">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s s-Atom">&#39;|&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s s-Atom">row</span>

            <span class="s s-Atom">#</span> <span class="nv">Print</span>

            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">,</span> <span class="s s-Atom">end=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="s s-Atom">if</span> <span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">&#39;outer&#39;</span><span class="p">]</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">table_title</span> <span class="o">=</span> <span class="s2">&quot;Table for &quot;</span> <span class="o">+</span> <span class="nf">repr</span><span class="p">(</span><span class="s s-Atom">table_coord</span><span class="p">)</span>

                <span class="nf">print</span><span class="p">(</span><span class="nf">color_text</span><span class="p">(</span><span class="s s-Atom">table_title</span><span class="p">,</span> <span class="s s-Atom">colorama</span><span class="p">.</span><span class="nv">Back</span><span class="p">.</span><span class="nv">YELLOW</span><span class="p">))</span>

            <span class="s s-Atom">headers</span><span class="p">,</span> <span class="o">*</span><span class="s s-Atom">rows</span> <span class="o">=</span> <span class="s s-Atom">rows</span>

            <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">utils</span><span class="p">.</span><span class="nf">tab</span><span class="p">(</span><span class="s s-Atom">rows</span><span class="p">,</span> <span class="s s-Atom">headers</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="s s-Atom">&#39;␣&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39; &#39;</span><span class="p">))</span>

    <span class="s s-Atom">def</span> <span class="nf">plot</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">statkey=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="s s-Atom">axes</span><span class="o">=</span><span class="nv">AXES_ROLES</span><span class="p">,</span> <span class="s s-Atom">get_style</span><span class="o">=</span><span class="s s-Atom">default_styles</span><span class="p">,</span>

             <span class="s s-Atom">fignum</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">figsize</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">panels</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span>

             <span class="s s-Atom">title2</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">costfun</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">unique_labels</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Plot the avrgs of ``statkey`` as a function of ``axis[&quot;</span><span class="s s-Atom">inner</span><span class="s2">&quot;]``.</span>

<span class="s2">        Firs of all, though, mean and optimum computations are done for</span>

<span class="s2">        ``axis[&quot;</span><span class="s s-Atom">mean</span><span class="s2">&quot;]`` and ``axis[&quot;</span><span class="s s-Atom">optim</span><span class="s2">&quot;]``.</span>

<span class="s2">        The optimal parameters are plotted in panels below the main plot.</span>

<span class="s2">        This can be prevented by providing the figure axes in ``panels``.</span>

<span class="s2">        Optionally, the experiments can be grouped by ``axis[&quot;</span><span class="s s-Atom">outer</span><span class="s2">&quot;]``,</span>

<span class="s2">        producing a figure with columns of panels.&quot;&quot;&quot;</span>

        <span class="s s-Atom">def</span> <span class="nf">plot1</span><span class="p">(</span><span class="s s-Atom">panelcol</span><span class="p">,</span> <span class="s s-Atom">row</span><span class="p">,</span> <span class="s s-Atom">style</span><span class="p">)</span><span class="s s-Atom">:</span>

            <span class="s2">&quot;&quot;&quot;Plot a given line (row) in the main panel and the optim panels.</span>

<span class="s2">            Involves: Sort, insert None&#39;s, handle constant lines.&quot;&quot;&quot;</span>

            <span class="s s-Atom">#</span> <span class="nv">Make</span> <span class="s s-Atom">a</span> <span class="s s-Atom">full</span> <span class="nf">row</span> <span class="p">(</span><span class="s s-Atom">yy</span><span class="p">)</span> <span class="s s-Atom">of</span> <span class="s s-Atom">vals</span><span class="p">,</span> <span class="s s-Atom">whether</span> <span class="s s-Atom">is_constant</span> <span class="s s-Atom">or</span> <span class="o">not</span><span class="p">.</span>

            <span class="s s-Atom">#</span> <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">is_constant</span> <span class="o">=</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="s s-Atom">row</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="s s-Atom">and</span> <span class="nf">next</span><span class="p">(</span><span class="nf">iter</span><span class="p">(</span><span class="s s-Atom">row</span><span class="p">))</span><span class="o">==</span><span class="s s-Atom">row</span><span class="p">.</span><span class="nv">Coord</span><span class="p">(</span><span class="nv">None</span><span class="p">))</span>

            <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">is_constant</span> <span class="o">=</span> <span class="nf">all</span><span class="p">(</span><span class="s s-Atom">x</span> <span class="o">==</span> <span class="s s-Atom">row</span><span class="p">.</span><span class="nv">Coord</span><span class="p">(</span><span class="nv">None</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">row</span><span class="p">)</span>

            <span class="s s-Atom">yy</span> <span class="o">=</span> <span class="p">[</span><span class="s s-Atom">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="s s-Atom">if</span> <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">is_constant</span> <span class="s s-Atom">else</span> <span class="s s-Atom">y</span> <span class="s s-Atom">for</span> <span class="s s-Atom">y</span> <span class="s s-Atom">in</span> <span class="s s-Atom">row</span><span class="p">.</span><span class="nf">get_for</span><span class="p">(</span><span class="s s-Atom">xticks</span><span class="p">)]</span>

            <span class="s s-Atom">#</span> <span class="nv">Plot</span> <span class="s s-Atom">main</span>

            <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nf">getattr</span><span class="p">(</span><span class="s s-Atom">y</span><span class="p">,</span> <span class="s s-Atom">&#39;val&#39;</span><span class="p">,</span> <span class="nv">None</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">y</span> <span class="s s-Atom">in</span> <span class="s s-Atom">yy</span><span class="p">]</span>

            <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">handles</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">handles</span><span class="p">[</span><span class="s2">&quot;main_panel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">panelcol</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="s s-Atom">xticks</span><span class="p">,</span> <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">vals</span><span class="p">,</span> <span class="s s-Atom">**style</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="s s-Atom">#</span> <span class="nv">Plot</span> <span class="s s-Atom">tuning</span> <span class="s s-Atom">params</span>

            <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">tuned_coords</span> <span class="o">=</span> <span class="p">{}</span>  <span class="s s-Atom">#</span> <span class="nv">Store</span> <span class="s s-Atom">ordered</span><span class="p">,</span> <span class="s2">&quot;transposed&quot;</span> <span class="s s-Atom">argmins</span>

            <span class="s s-Atom">argmins</span> <span class="o">=</span> <span class="p">[</span><span class="nf">getattr</span><span class="p">(</span><span class="s s-Atom">y</span><span class="p">,</span> <span class="s s-Atom">&#39;tuned_coord&#39;</span><span class="p">,</span> <span class="nv">None</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">y</span> <span class="s s-Atom">in</span> <span class="s s-Atom">yy</span><span class="p">]</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">panel</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">],</span> <span class="s s-Atom">panelcol</span><span class="p">[</span><span class="mi">1</span><span class="s s-Atom">:</span><span class="p">])</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">yy</span> <span class="o">=</span> <span class="p">[</span><span class="nf">getattr</span><span class="p">(</span><span class="s s-Atom">coord</span><span class="p">,</span> <span class="s s-Atom">a</span><span class="p">,</span> <span class="nv">None</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">coord</span> <span class="s s-Atom">in</span> <span class="s s-Atom">argmins</span><span class="p">]</span>

                <span class="s s-Atom">row</span><span class="p">.</span><span class="s s-Atom">tuned_coords</span><span class="p">[</span><span class="s s-Atom">a</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">yy</span>

                <span class="s s-Atom">#</span> <span class="nv">Plotting</span> <span class="s s-Atom">all</span> <span class="nv">None</span><span class="s s-Atom">&#39;s sets axes units (like any plotting call)</span>

<span class="s s-Atom">                # which can cause trouble if the axes units were actually supposed</span>

<span class="s s-Atom">                # to be categorical (eg upd_a), but this is only revealed later.</span>

<span class="s s-Atom">                if not all(y == None for y in yy):</span>

<span class="s s-Atom">                    row.handles[a] = panel.plot(xticks, yy, **style)</span>

<span class="s s-Atom">        # Nest axes through table_tree()</span>

<span class="s s-Atom">        assert len(axes[&quot;inner&quot;]) == 1, &quot;You must chose the abscissa.&quot;</span>

<span class="s s-Atom">        axes, tables = self.table_tree(statkey, axes)</span>

<span class="s s-Atom">        xticks = self.tickz(axes[&quot;inner&quot;][0])</span>

<span class="s s-Atom">        # Figure panels</span>

<span class="s s-Atom">        if panels is None:</span>

<span class="s s-Atom">            nrows   = len(axes[&#39;optim&#39;] or ()) + 1</span>

<span class="s s-Atom">            ncols   = len(tables)</span>

<span class="s s-Atom">            maxW    = 12.7  # my mac screen</span>

<span class="s s-Atom">            figsize = figsize or (min(5*ncols, maxW), 7)</span>

<span class="s s-Atom">            gs      = dict(</span>

<span class="s s-Atom">                height_ratios=[6]+[1]*(nrows-1),</span>

<span class="s s-Atom">                hspace=0.05, wspace=0.05,</span>

<span class="s s-Atom">                # eyeballed:</span>

<span class="s s-Atom">                left=0.15/(1+np.log(ncols)),</span>

<span class="s s-Atom">                right=0.97, bottom=0.06, top=0.9)</span>

<span class="s s-Atom">            # Create</span>

<span class="s s-Atom">            _, panels = freshfig(num=fignum, figsize=figsize,</span>

<span class="s s-Atom">                                 nrows=nrows, sharex=True,</span>

<span class="s s-Atom">                                 ncols=ncols, sharey=&#39;row&#39;,</span>

<span class="s s-Atom">                                 gridspec_kw=gs)</span>

<span class="s s-Atom">            panels = np.ravel(panels).reshape((-1, ncols))</span>

<span class="s s-Atom">        else:</span>

<span class="s s-Atom">            panels = np.atleast_2d(panels)</span>

<span class="s s-Atom">        # Title</span>

<span class="s s-Atom">        fig = panels[0, 0].figure</span>

<span class="s s-Atom">        fig_title = &quot;Average wrt. time&quot;</span>

<span class="s s-Atom">        if axes[&quot;mean&quot;] is not None:</span>

<span class="s s-Atom">            fig_title += f&quot; and {axes[&#39;mean&#39;]}&quot;</span>

<span class="s s-Atom">        if title2 is not None:</span>

<span class="s s-Atom">            fig_title += &quot;\n&quot; + str(title2)</span>

<span class="s s-Atom">        fig.suptitle(fig_title)</span>

<span class="s s-Atom">        # Loop outer</span>

<span class="s s-Atom">        label_register = set()  # mv inside loop to get legend on each panel</span>

<span class="s s-Atom">        for table_panels, (table_coord, table) in zip(panels.T, tables.items()):</span>

<span class="s s-Atom">            table.panels = table_panels</span>

<span class="s s-Atom">            title = &#39;&#39; if axes[&quot;outer&quot;] is None else repr(table_coord)</span>

<span class="s s-Atom">            # Plot</span>

<span class="s s-Atom">            for coord, row in table.items():</span>

<span class="s s-Atom">                style = get_style(coord)</span>

<span class="s s-Atom">                # Rm duplicate labels (contrary to coords, labels can</span>

<span class="s s-Atom">                # be &quot;tampered&quot; with, and so can be duplicate)</span>

<span class="s s-Atom">                if unique_labels:</span>

<span class="s s-Atom">                    if style.get(&quot;label&quot;, None) in label_register:</span>

<span class="s s-Atom">                        del style[&quot;label&quot;]</span>

<span class="s s-Atom">                    else:</span>

<span class="s s-Atom">                        label_register.add(style[&quot;label&quot;])</span>

<span class="s s-Atom">                plot1(table.panels, row, style)</span>

<span class="s s-Atom">            # Beautify</span>

<span class="s s-Atom">            panel0 = table.panels[0]</span>

<span class="s s-Atom">            panel0.set_title(title)</span>

<span class="s s-Atom">            if panel0.is_first_col():</span>

<span class="s s-Atom">                panel0.set_ylabel(statkey)</span>

<span class="s s-Atom">            with utils.set_tmp(mpl_logger, &#39;level</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span><span class="s s-Atom">:</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">silence</span> <span class="s2">&quot;no label&quot;</span> <span class="s s-Atom">msg</span>

                <span class="s s-Atom">panel0</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>

            <span class="s s-Atom">table</span><span class="p">.</span><span class="s s-Atom">panels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="s s-Atom">#</span> <span class="nv">Tuning</span> <span class="nn">panels</span><span class="p">:</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">panel</span> <span class="s s-Atom">in</span> <span class="nf">zip</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">]</span> <span class="nf">or</span> <span class="p">(),</span> <span class="s s-Atom">table</span><span class="p">.</span><span class="s s-Atom">panels</span><span class="p">[</span><span class="mi">1</span><span class="s s-Atom">:</span><span class="p">])</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">if</span> <span class="s s-Atom">panel</span><span class="p">.</span><span class="nf">is_first_col</span><span class="p">()</span><span class="s s-Atom">:</span>

                    <span class="s s-Atom">panel</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="s s-Atom">f</span><span class="s2">&quot;Optim.\n{a}&quot;</span><span class="p">)</span>

        <span class="s s-Atom">tables</span><span class="p">.</span><span class="s s-Atom">fig</span> <span class="o">=</span> <span class="s s-Atom">fig</span>

        <span class="s s-Atom">tables</span><span class="p">.</span><span class="s s-Atom">xp_dict</span> <span class="o">=</span> <span class="s s-Atom">self</span>

        <span class="s s-Atom">tables</span><span class="p">.</span><span class="s s-Atom">axes_roles</span> <span class="o">=</span> <span class="s s-Atom">axes</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">tables</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>dapper.data_management.SparseSpace</li>
<li>builtins.dict</li>
</ul>
<h4 id="static-methods">Static methods</h4>
<h5 id="from_list">from_list</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span>
    <span class="n">xps</span>
<span class="p">)</span>
</code></pre></div>

<p>Init xpSpace from xpList.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="s s-Atom">@classmethod</span>

    <span class="s s-Atom">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="s s-Atom">cls</span><span class="p">,</span> <span class="s s-Atom">xps</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s2">&quot;&quot;&quot;Init xpSpace from xpList.&quot;&quot;&quot;</span>

        <span class="s s-Atom">def</span> <span class="nf">make_ticks</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">,</span> <span class="s s-Atom">ordering</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span>

                    <span class="nv">N</span>         <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">seed</span>      <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">infl</span>      <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">loc_rad</span>   <span class="o">=</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">rot</span>       <span class="o">=</span> <span class="s s-Atom">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="s s-Atom">da_method</span> <span class="o">=</span> <span class="s s-Atom">&#39;as_found&#39;</span><span class="p">,</span>

                    <span class="p">))</span><span class="s s-Atom">:</span>

            <span class="s2">&quot;&quot;&quot;Unique &amp; sort, for each axis (individually) in axes.&quot;&quot;&quot;</span>

            <span class="s s-Atom">for</span> <span class="s s-Atom">ax_name</span><span class="p">,</span> <span class="s s-Atom">arr</span> <span class="s s-Atom">in</span> <span class="s s-Atom">axes</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>

                <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="s s-Atom">arr</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="nf">unique</span> <span class="p">(</span><span class="s s-Atom">jumbles</span> <span class="s s-Atom">order</span><span class="p">)</span>

                <span class="s s-Atom">#</span> <span class="nv">Sort</span>

                <span class="s s-Atom">order</span> <span class="o">=</span> <span class="s s-Atom">ordering</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s s-Atom">ax_name</span><span class="p">,</span> <span class="s s-Atom">&#39;default&#39;</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span>

                <span class="s s-Atom">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="s s-Atom">order</span><span class="p">,</span> <span class="s s-Atom">&#39;__call__&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">eg</span><span class="p">.</span> <span class="s s-Atom">mylist</span><span class="p">.</span><span class="s s-Atom">index</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span><span class="s s-Atom">order</span><span class="p">)</span>

                <span class="s s-Atom">elif</span> <span class="s s-Atom">&#39;as_found&#39;</span> <span class="s s-Atom">in</span> <span class="nn">order</span><span class="p">:</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span><span class="s s-Atom">arr</span><span class="p">.</span><span class="s s-Atom">index</span><span class="p">)</span>

                <span class="nn">else</span><span class="p">:</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">default</span> <span class="s s-Atom">sorting</span><span class="p">,</span> <span class="s s-Atom">with</span> <span class="nv">None</span> <span class="s s-Atom">placed</span> <span class="s s-Atom">at</span> <span class="s s-Atom">the</span> <span class="s s-Atom">end</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="o">=</span> <span class="s s-Atom">lambda</span> <span class="nn">x</span><span class="p">:</span> <span class="p">(</span><span class="s s-Atom">x</span> <span class="o">is</span> <span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">x</span><span class="p">))</span>

                <span class="s s-Atom">if</span> <span class="nf">any</span><span class="p">(</span><span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">order</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="p">[</span><span class="s s-Atom">&#39;rev&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;inv&#39;</span><span class="p">])</span><span class="s s-Atom">:</span>

                    <span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="s s-Atom">ticks</span><span class="p">[</span><span class="s s-Atom">::-</span><span class="mi">1</span><span class="p">]</span>

                <span class="s s-Atom">axes</span><span class="p">[</span><span class="s s-Atom">ax_name</span><span class="p">]</span> <span class="o">=</span> <span class="s s-Atom">ticks</span>

        <span class="s s-Atom">#</span> <span class="nv">Define</span> <span class="s s-Atom">axes</span>

        <span class="s s-Atom">xp_list</span> <span class="o">=</span> <span class="nf">xpList</span><span class="p">(</span><span class="s s-Atom">xps</span><span class="p">)</span>

        <span class="s s-Atom">axes</span> <span class="o">=</span> <span class="s s-Atom">xp_list</span><span class="p">.</span><span class="nf">split_attrs</span><span class="p">(</span><span class="s s-Atom">nomerge</span><span class="o">=</span><span class="p">[</span><span class="s s-Atom">&#39;Const&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nf">make_ticks</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">)</span>

        <span class="s s-Atom">self</span> <span class="o">=</span> <span class="nf">cls</span><span class="p">(</span><span class="s s-Atom">axes</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span>

        <span class="s s-Atom">#</span> <span class="nv">Note</span><span class="s s-Atom">:</span> <span class="s s-Atom">this</span> <span class="nf">attr</span> <span class="p">(</span><span class="s s-Atom">ticks</span><span class="p">)</span> <span class="s s-Atom">will</span> <span class="o">not</span> <span class="s s-Atom">be</span> <span class="s s-Atom">propagated</span> <span class="s s-Atom">through</span> <span class="nf">nest</span><span class="p">().</span>

        <span class="s s-Atom">#</span> <span class="nv">That</span> <span class="o">is</span> <span class="s s-Atom">fine</span><span class="p">.</span> <span class="nv">Otherwise</span> <span class="s s-Atom">we</span> <span class="s s-Atom">should</span> <span class="s s-Atom">have</span> <span class="s s-Atom">to</span> <span class="s s-Atom">prune</span> <span class="s s-Atom">the</span> <span class="s s-Atom">ticks</span>

        <span class="s s-Atom">#</span> <span class="p">(</span><span class="s s-Atom">if</span> <span class="s s-Atom">they</span> <span class="s s-Atom">are</span> <span class="s s-Atom">to</span> <span class="s s-Atom">be</span> <span class="s s-Atom">useful</span><span class="p">),</span> <span class="s s-Atom">which</span> <span class="s s-Atom">we</span> <span class="s s-Atom">don</span><span class="err">&#39;</span><span class="s s-Atom">t</span> <span class="s s-Atom">want</span> <span class="s s-Atom">to</span> <span class="s s-Atom">do</span><span class="p">.</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">ticks</span> <span class="o">=</span> <span class="s s-Atom">axes</span>

        <span class="s s-Atom">#</span> <span class="nv">Fill</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="s s-Atom">self</span><span class="p">.</span><span class="k">__</span><span class="nf">getkey__</span><span class="p">(</span><span class="s s-Atom">xp</span><span class="p">)</span><span class="s s-Atom">:</span> <span class="s s-Atom">xp</span> <span class="s s-Atom">for</span> <span class="s s-Atom">xp</span> <span class="s s-Atom">in</span> <span class="s s-Atom">xps</span><span class="p">})</span>

        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span>
</code></pre></div>

</details>
<h4 id="instance-variables_1">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">axes</span>
</code></pre></div>

<h4 id="methods_1">Methods</h4>
<h5 id="add_axis_1">add_axis</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">add_axis</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axis</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">add_axis</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>

        <span class="k">self</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">axes</span><span class="o">+</span><span class="p">(</span><span class="n">axis</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="k">in</span> <span class="n">list</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="k">self</span><span class="p">[</span><span class="n">coord</span> <span class="o">+</span> <span class="p">(</span><span class="k">None</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">entry</span>
</code></pre></div>

</details>
<h5 id="clear_1">clear</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.clear() -&gt; None.  Remove all items from D.</p>
<h5 id="coords_1">coords</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">coords</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Get all <code>coord</code>s matching kwargs.</p>
<p>Unlike <code>__getitem__(kwargs)</code>,
- A list is returned, not a subspace.
- This list constains keys (coords), not values.
- The coords refer to the original space, not the subspace.</p>
<p>The last point is especially useful for label_xSection().</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get all ``coord``s matching kwargs.</span>

<span class="sd">        Unlike ``__getitem__(kwargs)``,</span>

<span class="sd">        - A list is returned, not a subspace.</span>

<span class="sd">        - This list constains keys (coords), not values.</span>

<span class="sd">        - The coords refer to the original space, not the subspace.</span>

<span class="sd">        The last point is especially useful for label_xSection().</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="n">embed</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span> <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">coord</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()}</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="o">**</span><span class="n">embed</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">kwargs</span><span class="p">]]</span>
</code></pre></div>

</details>
<h5 id="copy_1">copy</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.copy() -&gt; a shallow copy of D</p>
<h5 id="field">field</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">field</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statkey</span><span class="o">=</span><span class="s1">&#39;rmse.a&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p>Extract <code>statkey</code> for each item in <code>self</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">field</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Extract ``statkey`` for each item in ``self``.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="c1"># Init a new xpDict to hold field</span>

        <span class="n">avrgs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="n">found_anything</span> <span class="o">=</span> <span class="no">False</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">xp</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="o">:</span>

            <span class="n">val</span> <span class="o">=</span> <span class="n">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">.</span><span class="n">avrgs</span><span class="p">,</span> <span class="n">statkey</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>

            <span class="n">avrgs</span><span class="err">[</span><span class="n">coord</span><span class="err">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">found_anything</span> <span class="o">=</span> <span class="n">found_anything</span> <span class="k">or</span> <span class="p">(</span><span class="n">val</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">found_anything</span><span class="o">:</span>

            <span class="n">raise</span> <span class="n">AttributeError</span><span class="p">(</span>

                <span class="n">f</span><span class="s2">&quot;The stat. field &#39;{statkey}&#39; was not found&quot;</span>

                <span class="s2">&quot; among any of the xp&#39;s.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avrgs</span>
</code></pre></div>

</details>
<h5 id="fromkeys_1">fromkeys</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span>
    <span class="n">iterable</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Create a new dictionary with keys from iterable and values set to value.</p>
<h5 id="get_1">get</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Return the value for key if key is in the dictionary, else default.</p>
<h5 id="get_for_1">get_for</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_for</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ticks</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Almost <code>[self.get(Coord(x)) for x in ticks]</code>.</p>
<p>NB: using the "naive" thing: <code>[self[x] for x in ticks]</code>
would probably be a BUG coz x gets interpreted as indices
for the internal list.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_for</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">ticks</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Almost ``[self.get(Coord(x)) for x in ticks]``.</span>

<span class="ss">        NB: using the &quot;</span><span class="n">naive</span><span class="ss">&quot; thing: ``[self[x] for x in ticks]``</span>

<span class="ss">        would probably be a BUG coz x gets interpreted as indices</span>

<span class="ss">        for the internal list.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">singleton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">ticks</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;__iter__&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">coord</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">xyz</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">singleton</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">xyz</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">self.get(coord(x), default) for x in ticks</span><span class="o">]</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="intersect_axes_1">intersect_axes</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">intersect_axes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">attrs</span>
<span class="p">)</span>
</code></pre></div>

<p>Rm those a in attrs that are not in self.axes.</p>
<p>This allows errors in the axes allotment, for ease-of-use.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">intersect_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Rm those a in attrs that are not in self.axes.</span>

<span class="sd">        This allows errors in the axes allotment, for ease-of-use.&quot;&quot;&quot;</span>

        <span class="n">absent</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">absent</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="s2">&quot;Warning:&quot;</span><span class="p">,</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="s2">&quot;The requested attributes&quot;</span><span class="p">,</span>

                  <span class="n">color_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">absent</span><span class="p">),</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">),</span>

                  <span class="p">(</span><span class="s2">&quot;were not found among the&quot;</span>

                   <span class="s2">&quot; xpSpace axes (attrs. used as coordinates&quot;</span>

                   <span class="s2">&quot; for the set of experiments).&quot;</span>

                   <span class="s2">&quot; This may be no problem if the attr. is redundant&quot;</span>

                   <span class="s2">&quot; for the coord-sys.&quot;</span>

                   <span class="s2">&quot; However, if it is caused by confusion or mis-spelling,&quot;</span>

                   <span class="s2">&quot; then it is likely to cause mis-interpretation&quot;</span>

                   <span class="s2">&quot; of the shown results.&quot;</span><span class="p">))</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">absent</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attrs</span>
</code></pre></div>

</details>
<h5 id="items_1">items</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.items() -&gt; a set-like object providing a view on D's items</p>
<h5 id="keys_1">keys</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">keys</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.keys() -&gt; a set-like object providing a view on D's keys</p>
<h5 id="label_xsection_1">label_xSection</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">label_xSection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">label</span><span class="p">,</span>
    <span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span>
    <span class="o">**</span><span class="n">sub_coord</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert duplicate entries for the cross section</p>
<p>whose <code>coord</code>s match <code>sub_coord</code>,
adding the attr <code>Const=label</code> to their <code>coord</code>,
reflecting the "constance/constraint/fixation" this represents.</p>
<p>This distinguishes the entries in this fixed-affine subspace,
preventing them from being gobbled up in <code>nest()</code>.</p>
<p>If you wish, you can specify the <code>NoneAttrs</code>,
which are consequently set to None for the duplicated entries,
preventing them from getting plotted in tuning panels.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">label_xSection</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">NoneAttrs</span><span class="p">,</span> <span class="o">**</span><span class="n">sub_coord</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Insert duplicate entries for the cross section</span>

<span class="s2">        whose ``coord``s match ``sub_coord``,</span>

<span class="s2">        adding the attr ``Const=label`` to their ``coord``,</span>

<span class="s2">        reflecting the &quot;</span><span class="n">constance</span><span class="o">/</span><span class="k">constraint</span><span class="o">/</span><span class="n">fixation</span><span class="s2">&quot; this represents.</span>

<span class="s2">        This distinguishes the entries in this fixed-affine subspace,</span>

<span class="s2">        preventing them from being gobbled up in ``nest()``.</span>

<span class="s2">        If you wish, you can specify the ``NoneAttrs``,</span>

<span class="s2">        which are consequently set to None for the duplicated entries,</span>

<span class="s2">        preventing them from getting plotted in tuning panels.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;Const&quot;</span> <span class="k">not</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="o">:</span>

            <span class="n">self</span><span class="p">.</span><span class="n">add_axis</span><span class="p">(</span><span class="s1">&#39;Const&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">coords</span><span class="p">(</span><span class="o">**</span><span class="n">self</span><span class="p">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">sub_coord</span><span class="p">))</span><span class="o">:</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="n">copy</span><span class="p">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">self</span><span class="err">[</span><span class="n">coord</span><span class="err">]</span><span class="p">)</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">Const</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

            <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="p">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="err">{</span><span class="n">a</span><span class="o">:</span> <span class="k">None</span> <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="n">NoneAttrs</span><span class="err">}</span><span class="p">)</span>

            <span class="n">self</span><span class="err">[</span><span class="n">coord</span><span class="err">]</span> <span class="o">=</span> <span class="n">entry</span>
</code></pre></div>

</details>
<h5 id="mean">mean</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="err">``</span><span class="n">axes</span><span class="o">=</span><span class="p">()</span><span class="err">``</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="n">w</span><span class="o">/</span><span class="n">o</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">treatment</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="w"></span>

<span class="w">        </span><span class="n">nested</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">nest</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="nf">space</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">nested</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">def</span><span class="w"> </span><span class="n">getval</span><span class="p">(</span><span class="n">uq</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">uq</span><span class="p">.</span><span class="n">val</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">uq</span><span class="p">,</span><span class="w"> </span><span class="n">UncertainQtty</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">uq</span><span class="w"></span>

<span class="w">            </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">getval(uq) for uq in space.values()</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Don</span><span class="s1">&#39;t use nanmean! It would give false impressions.</span>

<span class="s1">            mu = np.mean(vals)</span>

<span class="s1">            with warnings.catch_warnings():</span>

<span class="s1">                warnings.simplefilter(&quot;ignore&quot;, category=RuntimeWarning)</span>

<span class="s1">                # Don&#39;</span><span class="n">t</span><span class="w"> </span><span class="k">print</span><span class="w"> </span><span class="n">warnings</span><span class="w"> </span><span class="n">caused</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">1.</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">nan</span><span class="err">&#39;</span><span class="n">s</span><span class="p">.</span><span class="w"></span>

<span class="w">                </span><span class="nf">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">var</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="w"> </span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">uq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UncertainQtty</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">var</span><span class="o">/</span><span class="n">N</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="n">uq</span><span class="p">.</span><span class="n">nTotal</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>

<span class="w">            </span><span class="n">uq</span><span class="p">.</span><span class="n">nFail</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">vals</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">uq</span><span class="p">.</span><span class="n">nSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">uq</span><span class="p">.</span><span class="n">nFail</span><span class="w"></span>

<span class="w">            </span><span class="n">nested</span><span class="o">[</span><span class="n">coord</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uq</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nested</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="nest_1">nest</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">nest</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">inner_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outer_axes</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Return a new xpSpace with axes <code>outer_axes</code>,</p>
<p>obtained by projecting along the <code>inner_axes</code>.
The entries of this <code>xpSpace</code> are themselves <code>xpSpace</code>s,
with axes <code>inner_axes</code>,
each one regrouping the entries with the same (projected) coordinate.</p>
<p>Note: is also called by <code>__getitem__(key)</code> if <code>key</code> is dict.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">nest</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inner_axes</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">outer_axes</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="o">:</span>

        <span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Return a new xpSpace with axes ``outer_axes``,</span>

<span class="s2">        obtained by projecting along the ``inner_axes``.</span>

<span class="s2">        The entries of this ``xpSpace`` are themselves ``xpSpace``s,</span>

<span class="s2">        with axes ``inner_axes``,</span>

<span class="s2">        each one regrouping the entries with the same (projected) coordinate.</span>

<span class="s2">        Note: is also called by ``__getitem__(key)`` if ``key`` is dict.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

        <span class="c1"># Default: a singleton outer space,</span>

        <span class="c1"># with everything contained in the inner (projection) space.</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="k">is</span> <span class="k">None</span> <span class="k">and</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">None</span><span class="o">:</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c1"># Validate axes</span>

        <span class="k">if</span> <span class="n">inner_axes</span> <span class="k">is</span> <span class="k">None</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">not</span> <span class="k">None</span>

            <span class="n">inner_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">outer_axes</span> <span class="k">is</span> <span class="k">None</span>

            <span class="n">outer_axes</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">inner_axes</span><span class="p">)</span>

        <span class="c1"># Fill spaces</span>

        <span class="n">outer_space</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">outer_axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="o">:</span>

            <span class="n">outer_coord</span> <span class="o">=</span> <span class="n">outer_space</span><span class="p">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="n">try</span><span class="o">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="n">outer_space</span><span class="err">[</span><span class="n">outer_coord</span><span class="err">]</span>

            <span class="k">except</span> <span class="n">KeyError</span><span class="o">:</span>

                <span class="n">inner_space</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">inner_axes</span><span class="p">)</span>

                <span class="n">outer_space</span><span class="err">[</span><span class="n">outer_coord</span><span class="err">]</span> <span class="o">=</span> <span class="n">inner_space</span>

            <span class="n">inner_space</span><span class="err">[</span><span class="n">inner_space</span><span class="p">.</span><span class="n">__getkey__</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="err">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">return</span> <span class="n">outer_space</span>
</code></pre></div>

</details>
<h5 id="plot">plot</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statkey</span><span class="o">=</span><span class="s1">&#39;rmse.a&#39;</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;outer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;inner&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="n">get_style</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">default_styles</span> <span class="n">at</span> <span class="mh">0x7f8a722ab790</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">fignum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">panels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">costfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unique_labels</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p>Plot the avrgs of <code>statkey</code> as a function of <code>axis["inner"]</code>.</p>
<p>Firs of all, though, mean and optimum computations are done for
<code>axis["mean"]</code> and <code>axis["optim"]</code>.</p>
<p>The optimal parameters are plotted in panels below the main plot.
This can be prevented by providing the figure axes in <code>panels</code>.</p>
<p>Optionally, the experiments can be grouped by <code>axis["outer"]</code>,
producing a figure with columns of panels.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s2">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">AXES_ROLES</span><span class="p">,</span> <span class="n">get_style</span><span class="o">=</span><span class="n">default_styles</span><span class="p">,</span>

             <span class="n">fignum</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">panels</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>

             <span class="n">title2</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">costfun</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">unique_labels</span><span class="o">=</span><span class="n">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Plot the avrgs of ``statkey`` as a function of ``axis[&quot;inner&quot;]``.</span>

<span class="sd">        Firs of all, though, mean and optimum computations are done for</span>

<span class="sd">        ``axis[&quot;mean&quot;]`` and ``axis[&quot;optim&quot;]``.</span>

<span class="sd">        The optimal parameters are plotted in panels below the main plot.</span>

<span class="sd">        This can be prevented by providing the figure axes in ``panels``.</span>

<span class="sd">        Optionally, the experiments can be grouped by ``axis[&quot;outer&quot;]``,</span>

<span class="sd">        producing a figure with columns of panels.&quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="n">plot1</span><span class="p">(</span><span class="n">panelcol</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Plot a given line (row) in the main panel and the optim panels.</span>

<span class="sd">            Involves: Sort, insert None&#39;s, handle constant lines.&quot;&quot;&quot;</span>

            <span class="c1"># Make a full row (yy) of vals, whether is_constant or not.</span>

            <span class="c1"># row.is_constant = (len(row)==1 and next(iter(row))==row.Coord(None))</span>

            <span class="n">row</span><span class="o">.</span><span class="n">is_constant</span> <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>

            <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">is_constant</span> <span class="k">else</span> <span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">get_for</span><span class="p">(</span><span class="n">xticks</span><span class="p">)]</span>

            <span class="c1"># Plot main</span>

            <span class="n">row</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">]</span>

            <span class="n">row</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">row</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="s2">&quot;main_panel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelcol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Plot tuning params</span>

            <span class="n">row</span><span class="o">.</span><span class="n">tuned_coords</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store ordered, &quot;transposed&quot; argmins</span>

            <span class="n">argmins</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;tuned_coord&#39;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">],</span> <span class="n">panelcol</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

                <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">argmins</span><span class="p">]</span>

                <span class="n">row</span><span class="o">.</span><span class="n">tuned_coords</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span>

                <span class="c1"># Plotting all None&#39;s sets axes units (like any plotting call)</span>

                <span class="c1"># which can cause trouble if the axes units were actually supposed</span>

                <span class="c1"># to be categorical (eg upd_a), but this is only revealed later.</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">all</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">None</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yy</span><span class="p">):</span>

                    <span class="n">row</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>

        <span class="c1"># Nest axes through table_tree()</span>

        <span class="nb">assert</span> <span class="n">len</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;You must chose the abscissa.&quot;</span>

        <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_tree</span><span class="p">(</span><span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="n">xticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickz</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Figure panels</span>

        <span class="k">if</span> <span class="n">panels</span> <span class="k">is</span> <span class="n">None</span><span class="p">:</span>

            <span class="n">nrows</span>   <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">ncols</span>   <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

            <span class="n">maxW</span>    <span class="o">=</span> <span class="mf">12.7</span>  <span class="c1"># my mac screen</span>

            <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">ncols</span><span class="p">,</span> <span class="n">maxW</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>

            <span class="n">gs</span>      <span class="o">=</span> <span class="n">dict</span><span class="p">(</span>

                <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>

                <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>

                <span class="c1"># eyeballed:</span>

                <span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ncols</span><span class="p">)),</span>

                <span class="n">right</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

            <span class="c1"># Create</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">panels</span> <span class="o">=</span> <span class="n">freshfig</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>

                                 <span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">True</span><span class="p">,</span>

                                 <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>

                                 <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gs</span><span class="p">)</span>

            <span class="n">panels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">panels</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">panels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">panels</span><span class="p">)</span>

        <span class="c1"># Title</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">fig_title</span> <span class="o">=</span> <span class="s2">&quot;Average wrt. time&quot;</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">:</span>

            <span class="n">fig_title</span> <span class="o">+=</span> <span class="n">f</span><span class="s2">&quot; and {axes[&#39;mean&#39;]}&quot;</span>

        <span class="k">if</span> <span class="n">title2</span> <span class="k">is</span> <span class="ow">not</span> <span class="n">None</span><span class="p">:</span>

            <span class="n">fig_title</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">title2</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">fig_title</span><span class="p">)</span>

        <span class="c1"># Loop outer</span>

        <span class="n">label_register</span> <span class="o">=</span> <span class="n">set</span><span class="p">()</span>  <span class="c1"># mv inside loop to get legend on each panel</span>

        <span class="k">for</span> <span class="n">table_panels</span><span class="p">,</span> <span class="p">(</span><span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span> <span class="ow">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">panels</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="n">table</span><span class="o">.</span><span class="n">panels</span> <span class="o">=</span> <span class="n">table_panels</span>

            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="s2">&quot;outer&quot;</span><span class="p">]</span> <span class="k">is</span> <span class="n">None</span> <span class="k">else</span> <span class="n">repr</span><span class="p">(</span><span class="n">table_coord</span><span class="p">)</span>

            <span class="c1"># Plot</span>

            <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">style</span> <span class="o">=</span> <span class="n">get_style</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

                <span class="c1"># Rm duplicate labels (contrary to coords, labels can</span>

                <span class="c1"># be &quot;tampered&quot; with, and so can be duplicate)</span>

                <span class="k">if</span> <span class="n">unique_labels</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">label_register</span><span class="p">:</span>

                        <span class="n">del</span> <span class="n">style</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">label_register</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">style</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>

                <span class="n">plot1</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>

            <span class="c1"># Beautify</span>

            <span class="n">panel0</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">panel0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">panel0</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>

                <span class="n">panel0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">statkey</span><span class="p">)</span>

            <span class="n">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">set_tmp</span><span class="p">(</span><span class="n">mpl_logger</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>  <span class="c1"># silence &quot;no label&quot; msg</span>

                <span class="n">panel0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Tuning panels:</span>

            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;optim&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(),</span> <span class="n">table</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

                <span class="k">if</span> <span class="n">panel</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>

                    <span class="n">panel</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Optim.</span><span class="se">\n</span><span class="s2">{a}&quot;</span><span class="p">)</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">xp_dict</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">tables</span><span class="o">.</span><span class="n">axes_roles</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">return</span> <span class="n">tables</span>
</code></pre></div>

</details>
<h5 id="pop_1">pop</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.pop(k[,d]) -&gt; v, remove specified key and return the corresponding value.
If key is not found, d is returned if given, otherwise KeyError is raised</p>
<h5 id="popitem_1">popitem</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove and return a (key, value) pair as a 2-tuple.</p>
<p>Pairs are returned in LIFO (last-in, first-out) order.
Raises KeyError if the dict is empty.</p>
<h5 id="print">print</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">print</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statkey</span><span class="o">=</span><span class="s1">&#39;rmse.a&#39;</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;outer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;inner&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="n">subcols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">decimals</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Print tables of results.</p>
<ul>
<li>
<p>statkey: The statistical field from the experiments to report.</p>
</li>
<li>
<p>subcols: If True, then subcolumns are added to indicate the
           1σ confidence interval, and potentially some other stuff.</p>
</li>
<li>
<p>axes: Allots (maps) each role to a set of axis of the xp_dict.
  Suggestion:</p>
<blockquote>
<blockquote>
<blockquote>
<p>dict(
   outer='da_method', inner='N', mean='seed',
   optim=('infl','loc_rad'))</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ul>
<p>Example: If <code>mean</code> is assigned to:</p>
<ul>
<li>
<p>("seed",): Experiments are averaged accross seeds,
               and the 1σ (sub)col is computed as sqrt(var(xps)/N),
               where xps is a set of experiments.</p>
</li>
<li>
<p>()       : Experiments are averaged across nothing
               (i.e. this is an edge case).</p>
</li>
<li>
<p>None     : Experiments are not averaged
               (i.e. the values are the same as above),
               and the 1σ (sub)col is computed from
               the time series of that single experiment.</p>
</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">print</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">statkey</span><span class="o">=</span><span class="s">&quot;rmse.a&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">AXES_ROLES</span><span class="p">,</span>

              <span class="n">subcols</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">None</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Print tables of results.</span>

        <span class="o">-</span> <span class="nl">statkey</span><span class="p">:</span> <span class="n">The</span> <span class="n">statistical</span> <span class="n">field</span> <span class="n">from</span> <span class="n">the</span> <span class="n">experiments</span> <span class="n">to</span> <span class="n">report</span><span class="p">.</span>

        <span class="o">-</span> <span class="nl">subcols</span><span class="p">:</span> <span class="n">If</span> <span class="n">True</span><span class="p">,</span> <span class="n">then</span> <span class="n">subcolumns</span> <span class="n">are</span> <span class="n">added</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span>

                   <span class="mi">1</span><span class="err">σ</span> <span class="n">confidence</span> <span class="n">interval</span><span class="p">,</span> <span class="n">and</span> <span class="n">potentially</span> <span class="n">some</span> <span class="n">other</span> <span class="n">stuff</span><span class="p">.</span>

        <span class="o">-</span> <span class="nl">axes</span><span class="p">:</span> <span class="n">Allots</span> <span class="p">(</span><span class="n">maps</span><span class="p">)</span> <span class="n">each</span> <span class="n">role</span> <span class="n">to</span> <span class="n">a</span> <span class="n">set</span> <span class="n">of</span> <span class="n">axis</span> <span class="n">of</span> <span class="n">the</span> <span class="n">xp_dict</span><span class="p">.</span>

          <span class="nl">Suggestion</span><span class="p">:</span>

          <span class="o">&gt;&gt;&gt;</span> <span class="n">dict</span><span class="p">(</span>

          <span class="o">&gt;&gt;&gt;</span>    <span class="n">outer</span><span class="o">=</span><span class="err">&#39;</span><span class="n">da_method</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="err">&#39;</span><span class="n">seed</span><span class="err">&#39;</span><span class="p">,</span>

          <span class="o">&gt;&gt;&gt;</span>    <span class="n">optim</span><span class="o">=</span><span class="p">(</span><span class="err">&#39;</span><span class="n">infl</span><span class="sc">&#39;,&#39;</span><span class="n">loc_rad</span><span class="err">&#39;</span><span class="p">))</span>

          <span class="nl">Example</span><span class="p">:</span> <span class="n">If</span> <span class="err">``</span><span class="n">mean</span><span class="err">``</span> <span class="n">is</span> <span class="n">assigned</span> <span class="nl">to</span><span class="p">:</span>

          <span class="o">-</span> <span class="p">(</span><span class="s">&quot;seed&quot;</span><span class="p">,)</span><span class="o">:</span> <span class="n">Experiments</span> <span class="n">are</span> <span class="n">averaged</span> <span class="n">accross</span> <span class="n">seeds</span><span class="p">,</span>

                       <span class="n">and</span> <span class="n">the</span> <span class="mi">1</span><span class="err">σ</span> <span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="n">col</span> <span class="n">is</span> <span class="n">computed</span> <span class="n">as</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">xps</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">),</span>

                       <span class="n">where</span> <span class="n">xps</span> <span class="n">is</span> <span class="n">a</span> <span class="n">set</span> <span class="n">of</span> <span class="n">experiments</span><span class="p">.</span>

          <span class="o">-</span> <span class="p">()</span>       <span class="o">:</span> <span class="n">Experiments</span> <span class="n">are</span> <span class="n">averaged</span> <span class="n">across</span> <span class="n">nothing</span>

                       <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span> <span class="n">this</span> <span class="n">is</span> <span class="n">an</span> <span class="n">edge</span> <span class="k">case</span><span class="p">).</span>

          <span class="o">-</span> <span class="nl">None</span>     <span class="p">:</span> <span class="n">Experiments</span> <span class="n">are</span> <span class="n">not</span> <span class="n">averaged</span>

                       <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span> <span class="n">the</span> <span class="n">values</span> <span class="n">are</span> <span class="n">the</span> <span class="n">same</span> <span class="n">as</span> <span class="n">above</span><span class="p">),</span>

                       <span class="n">and</span> <span class="n">the</span> <span class="mi">1</span><span class="err">σ</span> <span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="n">col</span> <span class="n">is</span> <span class="n">computed</span> <span class="n">from</span>

                       <span class="n">the</span> <span class="n">time</span> <span class="n">series</span> <span class="n">of</span> <span class="n">that</span> <span class="n">single</span> <span class="n">experiment</span><span class="p">.</span>

        <span class="s">&quot;&quot;&quot;</span>

        <span class="n">import</span> <span class="n">pandas</span> <span class="n">as</span> <span class="n">pd</span>

        <span class="n">def</span> <span class="n">align_subcols</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">subcols</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span><span class="o">:</span>

            <span class="s">&quot;&quot;&quot;Subcolumns: align, justify, join.&quot;&quot;&quot;</span>

            <span class="cp"># Define subcol formats</span>

            <span class="n">subc</span> <span class="o">=</span> <span class="n">dict</span><span class="p">()</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">keys</span><span class="err">&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s">&quot;val&quot;</span><span class="p">,</span> <span class="s">&quot;conf&quot;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">headers</span><span class="err">&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[</span><span class="n">statkey</span><span class="p">,</span> <span class="err">&#39;</span><span class="mi">1</span><span class="err">σ&#39;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">frmts</span><span class="err">&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">spaces</span><span class="err">&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="err">&#39;</span> <span class="err">±&#39;</span><span class="p">,</span> <span class="p">]</span>  <span class="err">#</span> <span class="n">last</span> <span class="n">one</span> <span class="n">gets</span> <span class="n">appended</span> <span class="n">below</span><span class="p">.</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">aligns</span><span class="err">&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span><span class="sc">&#39;&gt;&#39;</span><span class="p">,</span> <span class="sc">&#39;&lt;&#39;</span><span class="p">]</span>  <span class="err">#</span> <span class="mi">4</span> <span class="n">header</span> <span class="o">--</span> <span class="n">matter</span> <span class="n">gets</span> <span class="n">decimal</span><span class="o">-</span><span class="n">aligned</span><span class="p">.</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="err">&#39;</span><span class="n">optim</span><span class="err">&#39;</span><span class="p">]</span> <span class="n">is</span> <span class="n">not</span> <span class="nl">None</span><span class="p">:</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">keys</span><span class="err">&#39;</span><span class="p">]</span>    <span class="o">+=</span> <span class="p">[</span><span class="s">&quot;tuned_coord&quot;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">headers</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="err">&#39;</span><span class="n">optim</span><span class="err">&#39;</span><span class="p">]]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">frmts</span><span class="err">&#39;</span><span class="p">]</span>   <span class="o">+=</span> <span class="p">[</span><span class="n">lambda</span> <span class="nl">x</span><span class="p">:</span> <span class="n">tuple</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="n">x</span><span class="p">)]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">spaces</span><span class="err">&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="err">&#39;</span> <span class="o">*</span><span class="err">&#39;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">aligns</span><span class="err">&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="sc">&#39;&lt;&#39;</span><span class="p">]</span>

            <span class="n">elif</span> <span class="n">axes</span><span class="p">[</span><span class="err">&#39;</span><span class="n">mean</span><span class="err">&#39;</span><span class="p">]</span> <span class="n">is</span> <span class="n">not</span> <span class="nl">None</span><span class="p">:</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">keys</span><span class="err">&#39;</span><span class="p">]</span>    <span class="o">+=</span> <span class="p">[</span><span class="s">&quot;nFail&quot;</span><span class="p">,</span> <span class="s">&quot;nSuccess&quot;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">headers</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="sc">&#39;☠&#39;</span><span class="p">,</span> <span class="sc">&#39;✓&#39;</span><span class="p">]</span>  <span class="err">#</span> <span class="n">use</span> <span class="n">width</span><span class="mi">-1</span> <span class="n">symbols</span><span class="o">!</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">frmts</span><span class="err">&#39;</span><span class="p">]</span>   <span class="o">+=</span> <span class="p">[</span><span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">spaces</span><span class="err">&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">]</span>

                <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">aligns</span><span class="err">&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="p">[</span><span class="sc">&#39;&gt;&#39;</span><span class="p">,</span> <span class="sc">&#39;&gt;&#39;</span><span class="p">]</span>

            <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">spaces</span><span class="err">&#39;</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="err">&#39;&#39;</span><span class="p">)</span>  <span class="err">#</span> <span class="n">no</span> <span class="n">space</span> <span class="n">after</span> <span class="n">last</span> <span class="n">subcol</span>

            <span class="n">template</span> <span class="o">=</span> <span class="err">&#39;</span><span class="p">{}</span><span class="err">&#39;</span> <span class="o">+</span> <span class="err">&#39;</span><span class="p">{}</span><span class="err">&#39;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">spaces</span><span class="err">&#39;</span><span class="p">])</span>

            <span class="cp"># Transpose</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rows</span><span class="p">)]</span>

            <span class="cp"># Iterate over columns.</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">col_coord</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">zip</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">columns</span><span class="p">))</span><span class="o">:</span>

                <span class="cp"># Tabulate columns</span>

                <span class="k">if</span> <span class="nl">subcols</span><span class="p">:</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">unpack_uqs</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">subc</span><span class="p">[</span><span class="s">&quot;keys&quot;</span><span class="p">])</span>

                    <span class="cp"># Tabulate subcolumns</span>

                    <span class="n">subheaders</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">frmt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">align</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">subc</span><span class="p">.</span><span class="n">values</span><span class="p">())</span><span class="o">:</span>

                        <span class="n">column</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabulate_column</span><span class="p">(</span>

                            <span class="n">column</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">header</span><span class="p">,</span> <span class="n">frmt</span><span class="o">=</span><span class="n">frmt</span><span class="p">)[</span><span class="mi">1</span><span class="o">:</span><span class="p">]</span>

                        <span class="n">L</span> <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="mi">-1</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>

                            <span class="n">subheaders</span> <span class="o">+=</span> <span class="p">[</span><span class="n">str</span><span class="p">(</span><span class="n">header</span><span class="p">).</span><span class="n">ljust</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>

                        <span class="k">else</span><span class="o">:</span>

                            <span class="n">subheaders</span> <span class="o">+=</span> <span class="p">[</span><span class="n">str</span><span class="p">(</span><span class="n">header</span><span class="p">).</span><span class="n">rjust</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>

                    <span class="cp"># Join subcolumns:</span>

                    <span class="n">matter</span> <span class="o">=</span> <span class="p">[</span>

                        <span class="n">template</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">subc</span><span class="p">[</span><span class="err">&#39;</span><span class="n">keys</span><span class="err">&#39;</span><span class="p">]])</span>

                        <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="n">column</span>

                    <span class="p">]</span>

                    <span class="n">header</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">subheaders</span><span class="p">)</span>

                <span class="k">else</span><span class="o">:</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">unpack_uqs</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)[</span><span class="s">&quot;val&quot;</span><span class="p">]</span>

                    <span class="n">column</span> <span class="o">=</span> <span class="n">tabulate_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">statkey</span><span class="p">)</span>

                    <span class="n">header</span><span class="p">,</span> <span class="n">matter</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="p">]</span>

                <span class="k">if</span> <span class="nl">h2</span><span class="p">:</span>  <span class="err">#</span> <span class="n">Do</span> <span class="n">super_header</span>

                    <span class="k">if</span> <span class="nl">j</span><span class="p">:</span>

                        <span class="n">super_header</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">col_coord</span><span class="p">)</span>

                    <span class="k">else</span><span class="o">:</span>

                        <span class="n">super_header</span> <span class="o">=</span> <span class="n">repr</span><span class="p">(</span><span class="n">col_coord</span><span class="p">)</span>

                    <span class="n">width</span> <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>  <span class="err">#</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">using</span> <span class="n">unicode</span> <span class="n">chars</span> <span class="n">like</span> <span class="err">✔️</span>

                    <span class="n">super_header</span> <span class="o">=</span> <span class="n">super_header</span><span class="p">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>

                    <span class="n">header</span> <span class="o">=</span> <span class="n">super_header</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">header</span>

                <span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span><span class="o">+</span><span class="n">matter</span>

            <span class="cp"># Un-transpose</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">)]</span>

            <span class="k">return</span> <span class="n">rows</span>

        <span class="cp"># Inform axes[&quot;mean&quot;]</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="err">&#39;</span><span class="n">mean</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span><span class="o">:</span>

            <span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;Averages (in time and) over {axes[&#39;mean&#39;]}.&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">print</span><span class="p">(</span><span class="s">&quot;Averages in time only&quot;</span>

                  <span class="s">&quot; (=&gt; the 1σ estimates may be unreliable).&quot;</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">table_tree</span><span class="p">(</span><span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span> <span class="k">in</span> <span class="n">tables</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="o">:</span>

            <span class="cp"># Get this table&#39;s column coords (cc). Use dict for sorted&amp;unique.</span>

            <span class="cp"># cc = xp_dict.ticks[axes[&quot;inner&quot;]] # May be larger than needed.</span>

            <span class="cp"># cc = table[0].keys()              # May be too small a set.</span>

            <span class="n">cc</span> <span class="o">=</span> <span class="p">{</span><span class="nl">c</span><span class="p">:</span> <span class="n">None</span> <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="n">table</span><span class="p">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">row</span><span class="p">}</span>

            <span class="cp"># Convert table (rows) into rows (lists) of equal length</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">row</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">cc</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="n">table</span><span class="p">.</span><span class="n">values</span><span class="p">()]</span>

            <span class="k">if</span> <span class="nl">False</span><span class="p">:</span>  <span class="err">#</span> <span class="o">******************</span> <span class="n">Simple</span> <span class="p">(</span><span class="k">for</span> <span class="n">debugging</span><span class="p">)</span> <span class="n">table</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">row_coord</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">zip</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">rows</span><span class="p">))</span><span class="o">:</span>

                    <span class="n">row_key</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">row_coord</span><span class="p">)</span>

                    <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row_key</span><span class="p">]</span>         <span class="o">+</span> <span class="n">row</span>

                <span class="n">rows</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="s">&quot;{table.axes}&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">cc</span><span class="p">])</span>

            <span class="k">else</span><span class="o">:</span>  <span class="err">#</span> <span class="o">**********************</span> <span class="n">Elegant</span> <span class="n">table</span><span class="p">.</span>

                <span class="n">h2</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>  <span class="err">#</span> <span class="k">do</span> <span class="n">column</span><span class="o">-</span><span class="nb">super</span><span class="o">-</span><span class="n">header</span>

                <span class="n">rows</span> <span class="o">=</span> <span class="n">align_subcols</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">subcols</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>

                <span class="cp"># Make and prepend left-side table</span>

                <span class="cp"># - It&#39;s prettier if row_keys don&#39;t have unnecessary cols.</span>

                <span class="cp">#   For example, the table of Climatology should not have an</span>

                <span class="cp">#   entire column repeatedly displaying &quot;infl=None&quot;.</span>

                <span class="cp">#   =&gt; split_attrs().</span>

                <span class="cp"># - Why didn&#39;t we do this for the column attrs?</span>

                <span class="cp">#   Coz there we have no ambition to split the attrs,</span>

                <span class="cp">#   which would also require excessive processing:</span>

                <span class="cp">#   nesting the table as cols, and then split_attrs() on cols.</span>

                <span class="n">row_keys</span> <span class="o">=</span> <span class="n">xpList</span><span class="p">(</span><span class="n">table</span><span class="p">.</span><span class="n">keys</span><span class="p">()).</span><span class="n">split_attrs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">row_keys</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">.</span><span class="n">from_dict</span><span class="p">(</span>

                    <span class="n">row_keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;O&quot;</span><span class="p">)</span>  <span class="err">#</span> <span class="n">allow</span> <span class="n">storing</span> <span class="n">None</span>

                <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">row_keys</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span><span class="o">:</span>

                    <span class="cp"># Header</span>

                    <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h2</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">row_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">h2</span><span class="o">+</span><span class="sc">&#39;⑊&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="cp"># Matter</span>

                    <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="p">],</span> <span class="n">row_keys</span><span class="p">.</span><span class="n">iterrows</span><span class="p">())</span><span class="o">:</span>

                        <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sc">&#39;|&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span>

            <span class="cp"># Print</span>

            <span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="err">&#39;</span><span class="n">outer</span><span class="err">&#39;</span><span class="p">]</span><span class="o">:</span>

                <span class="n">table_title</span> <span class="o">=</span> <span class="s">&quot;Table for &quot;</span> <span class="o">+</span> <span class="n">repr</span><span class="p">(</span><span class="n">table_coord</span><span class="p">)</span>

                <span class="n">print</span><span class="p">(</span><span class="n">color_text</span><span class="p">(</span><span class="n">table_title</span><span class="p">,</span> <span class="n">colorama</span><span class="p">.</span><span class="n">Back</span><span class="p">.</span><span class="n">YELLOW</span><span class="p">))</span>

            <span class="n">headers</span><span class="p">,</span> <span class="o">*</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>

            <span class="n">print</span><span class="p">(</span><span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="sc">&#39;␣&#39;</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">))</span>
</code></pre></div>

</details>
<h5 id="setdefault_1">setdefault</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert key with a value of default if key is not in the dictionary.</p>
<p>Return the value for key if key is in the dictionary, else default.</p>
<h5 id="table_tree">table_tree</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">table_tree</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statkey</span><span class="p">,</span>
    <span class="n">axes</span>
<span class="p">)</span>
</code></pre></div>

<p>Hierarchical nest(): xp_dict&gt;outer&gt;inner&gt;mean&gt;optim.</p>
<p>as specified by <code>axes</code>. Returns this new xpSpace.</p>
<ul>
<li>
<p>print_1d / plot_1d (respectively) separate
  tables / panel(row)s for <code>axes['outer']</code>, and
  columns/ x-axis      for <code>axes['inner']</code>.</p>
</li>
<li>
<p>The <code>axes['mean']</code> and <code>axes['optim']</code> get eliminated
  by the mean()/tune() operations.</p>
</li>
</ul>
<p>Note: cannot support multiple statkeys
      because it's not (obviously) meaningful
      when optimizing over tuning_axes.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">table_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statkey</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Hierarchical nest(): xp_dict&gt;outer&gt;inner&gt;mean&gt;optim.</span>

<span class="sd">        as specified by ``axes``. Returns this new xpSpace.</span>

<span class="sd">        - print_1d / plot_1d (respectively) separate</span>

<span class="sd">          tables / panel(row)s for ``axes[&#39;outer&#39;]``, and</span>

<span class="sd">          columns/ x-axis      for ``axes[&#39;inner&#39;]``.</span>

<span class="sd">        - The ``axes[&#39;mean&#39;]`` and ``axes[&#39;optim&#39;]`` get eliminated</span>

<span class="sd">          by the mean()/tune() operations.</span>

<span class="sd">        Note: cannot support multiple statkeys</span>

<span class="sd">              because it&#39;s not (obviously) meaningful</span>

<span class="sd">              when optimizing over tuning_axes.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="n">def</span> <span class="n">mean_tune</span><span class="p">(</span><span class="n">xp_dict</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Take mean, then tune.</span>

<span class="sd">            Note: the SparseDict implementation should be sufficiently</span>

<span class="sd">            &quot;uncluttered&quot; that mean_tune() (or a few of its code lines)</span>

<span class="sd">            could be called anywhere above/between/below</span>

<span class="sd">            the ``nest()``ing of ``outer`` or ``inner``.</span>

<span class="sd">            These possibile call locations are commented in the code.&quot;&quot;&quot;</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">xp_dict</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">statkey</span><span class="p">)</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">uq_dict</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span>

            <span class="n">uq_dict</span> <span class="o">=</span> <span class="n">uq_dict</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;optim&#39;</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">uq_dict</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="n">mean_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Prefer calling mean_tune() [also see its docstring]</span>

        <span class="c1"># before doing outer/inner nesting. This is because then the axes of</span>

        <span class="c1"># a row (xpSpace) should not include mean&amp;optim, and thus:</span>

        <span class="c1">#  - Column header/coords may be had directly as row.keys(),</span>

        <span class="c1">#    without extraction by __getkey__() from (e.g.) row[0].</span>

        <span class="c1">#  - Don&#39;t need to propagate mean&amp;optim axes down to the row level.</span>

        <span class="c1">#    which would require defining rows by the nesting:</span>

        <span class="c1">#    rows = table.nest(outer_axes=dict_tools.complement(table.axes,</span>

        <span class="c1">#        *(axes[&#39;inner&#39;] or ()),</span>

        <span class="c1">#        *(axes[&#39;mean&#39;]  or ()),</span>

        <span class="c1">#        *(axes[&#39;optim&#39;] or ()) ))</span>

        <span class="c1">#  - Each level of the output from table_tree</span>

        <span class="c1">#    is a smaller (and more manageable) dict.</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">outer_axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;outer&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">table_coord</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># table = mean_tune(table)</span>

            <span class="c1"># Should not be used (nesting as rows is more natural,</span>

            <span class="c1"># and is required for getting distinct/row_keys).</span>

            <span class="c1"># cols = table.nest(outer_axes=axes[&#39;inner&#39;])</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">inner_axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="s1">&#39;inner&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">())</span>

            <span class="c1"># Overwrite table by its nesting as rows</span>

            <span class="n">tables</span><span class="p">[</span><span class="n">table_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">rows</span>

            <span class="c1"># for row_coord, row in rows.items():</span>

            <span class="c1"># rows[row_coord] = mean_tune(row)</span>

        <span class="k">return</span> <span class="n">axes</span><span class="p">,</span> <span class="n">tables</span>
</code></pre></div>

</details>
<h5 id="tickz">tickz</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tickz</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axis_name</span>
<span class="p">)</span>
</code></pre></div>

<p>Axis ticks without None</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">tickz</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axis_name</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Axis ticks without None&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">x for x in self.ticks[axis_name</span><span class="o">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">]</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="tune">tune</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">costfun</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Get (compile/tabulate) a stat field optimised wrt. tuning params.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">tune</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">costfun</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Get (compile/tabulate) a stat field optimised wrt. tuning params.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">cost</span><span class="o">-</span><span class="k">function</span><span class="w"></span>

<span class="w">        </span><span class="n">costfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">costfun</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;increasing&#39;</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;increas&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">costfun</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">costfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="s1">&#39;decreas&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">costfun</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">costfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">assert</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">costfun</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__call__&#39;</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">custom</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="err">``</span><span class="n">axes</span><span class="o">=</span><span class="p">()</span><span class="err">``</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="n">w</span><span class="o">/</span><span class="n">o</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">treatment</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="w"></span>

<span class="w">        </span><span class="n">nested</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">nest</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="nf">space</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">nested</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">coord</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="nf">space</span><span class="w"></span>

<span class="w">            </span><span class="nf">MIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">inner_coord</span><span class="p">,</span><span class="w"> </span><span class="n">uq</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="nf">space</span><span class="p">.</span><span class="n">items</span><span class="p">())</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">costfun</span><span class="p">(</span><span class="n">uq</span><span class="p">.</span><span class="n">val</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">MIN</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="nf">MIN</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span><span class="w"></span>

<span class="w">                    </span><span class="n">uq_opt</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">uq</span><span class="w"></span>

<span class="w">                    </span><span class="n">uq_opt</span><span class="p">.</span><span class="n">tuned_coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inner_coord</span><span class="w"></span>

<span class="w">            </span><span class="n">nested</span><span class="o">[</span><span class="n">coord</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uq_opt</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nested</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="update_1">update</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Update using custom <strong>setitem</strong>().</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Update using custom __setitem__().&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2588648</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">2390997</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">).</span><span class="n">items</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="validate_axes">validate_axes</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_axes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">axes</span>
<span class="p">)</span>
</code></pre></div>

<p>Validate axes.</p>
<p>Note: This does not convert None to (),
      allowing None to remain special.
      Use <code>axis or ()</code> wherever tuples are required.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">validate_axes</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Validate axes.</span>

<span class="ss">        Note: This does not convert None to (),</span>

<span class="ss">              allowing None to remain special.</span>

<span class="ss">              Use ``axis or ()`` wherever tuples are required.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="ss">&quot;inv&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">set</span><span class="p">(</span><span class="n">AXES_ROLES</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">assert</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">AXES_ROLES</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;Invalid role {role!r}&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">axes</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="k">role</span><span class="p">,</span><span class="w"> </span><span class="n">AXES_ROLES</span><span class="o">[</span><span class="n">role</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">aa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">pass</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Purposely</span><span class="w"> </span><span class="n">special</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">iterable</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;__iter__&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">aa</span><span class="p">,)</span><span class="w"></span>

<span class="w">                </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">intersect_axes</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">axis</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">aa</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="k">unique</span><span class="w"></span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">axis</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">roles</span><span class="p">:</span><span class="w"></span>

<span class="w">                        </span><span class="n">raise</span><span class="w"> </span><span class="n">TypeError</span><span class="p">(</span><span class="w"></span>

<span class="w">                            </span><span class="n">f</span><span class="ss">&quot;An axis (here {axis!r}) cannot be assigned to 2&quot;</span><span class="w"></span>

<span class="w">                            </span><span class="n">f</span><span class="ss">&quot; roles (here {role!r} and {roles[axis]!r}).&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                        </span><span class="n">roles</span><span class="o">[</span><span class="n">axis</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">role</span><span class="w"></span>

<span class="w">            </span><span class="n">axes</span><span class="o">[</span><span class="n">role</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">axes</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="values_1">values</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">values</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>D.values() -&gt; an object providing a view on D's values</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../admin/" title="Admin" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Admin
              </span>
            </div>
          </a>
        
        
          <a href="../dict_tools/" title="Dict Tools" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dict Tools
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>